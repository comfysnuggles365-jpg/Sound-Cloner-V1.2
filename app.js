

// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// GENRE DATA — HIP-HOP
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// GENRE DATA — POP
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// GENRE DATA — R&B
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// GENRE DATA — COUNTRY
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// GENRE DATA — ROCK
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// GENRE DATA — ELECTRONIC
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// GENRE DATA — INDIE
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// GENRE DATA — LATIN
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// GENRE DATA — K-POP
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// GENRE DATA — GOSPEL / SPIRITUAL
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// GENRE DATA — JAZZ / BLUES
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// GENRE DATA — METAL
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// GENRE DATA — REGGAE / AFROBEATS
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// GENRE DATA — FOLK / ACOUSTIC
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// GENRE DATA — PUNK
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// GENRE DATA — PHONK / DARK TRAP
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// GENRE DATA — UK DRILL / GRIME
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// GENRES REGISTRY — all genres assembled
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// ============================================================

// ============================================================
// GENRE BLUEPRINTS DATABASE
// ============================================================
const GENRE_BPS = {
  "Hip-Hop": [
    {name:"Classic Boom-Bap",desc:"90s New York underground",prompt:"88 BPM classic boom-bap, dusty vinyl soul samples chopped and looped, hard punching kick-snare with live feel, deep clean bass guitar, raw unprocessed MC delivery, jazz chord sample loops, New York underground atmosphere, SP-1200 sampler grit and compression"},
    {name:"Trap Banger",desc:"Modern Atlanta trap production",prompt:"140 BPM modern trap, heavy 808 sub bass with long pitch slides, rapid hi-hat triplets cutting to sudden silence, dark minor key synth pads, stadium-reverb snare, layered Auto-Tune harmonies, cinematic string drops, atmospheric tension"},
    {name:"Lo-Fi Hip-Hop",desc:"Chill study beats aesthetic",prompt:"75 BPM lo-fi hip-hop, warm vinyl crackle and tape hiss, dusty jazz piano loops, brushed snare with swing, deep clean bass, ambient coffee shop atmosphere, chopped soul vocals as texture, slow laid-back groove"},
    {name:"G-Funk",desc:"90s West Coast California",prompt:"92 BPM West Coast G-Funk, slow-rolling synthesizer bass with portamento, high-pitched P-Funk synth melody, laid-back swing drum groove, whining synth lead, smooth California sunshine vibe, West Coast G-Funk energy"},
    {name:"Cloud Rap",desc:"Atmospheric dreamy trap",prompt:"83 BPM cloud rap, hazy reverb-drenched production, dreamy pitched samples, minimal 808 bass, soft hi-hats, ethereal atmospheric texture, detached introspective delivery, spacious empty mix"},
    {name:"Drill Trap",desc:"Chicago drill meets Atlanta trap",prompt:"142 BPM Chicago drill trap hybrid, eerie minor key piano, heavy 808 bass, mechanical hi-hat patterns, cold emotionless delivery, dark sinister atmosphere, sparse menacing production"},
    {name:"Conscious Hip-Hop",desc:"Socially aware lyricism",prompt:"90 BPM conscious hip-hop, warm live instrumentation, jazz and soul sample foundation, natural vocal delivery, politically aware lyrical content, bass guitar groove, sophisticated chord progressions"},
    {name:"Melodic Rap",desc:"Sung hooks over trap beats",prompt:"86 BPM melodic trap, Auto-Tune vocal singing over modern trap production, emotional hooks, 808 bass with pitch slides, lush synth pads, blend of rapping and singing, vulnerable emotive energy"},
    {name:"Phonk",desc:"Memphis underground slowed sound",prompt:"130 BPM Memphis phonk, slowed pitched-down vocal samples, distorted cowbell percussion, dark 808 bass, eerie haunted atmosphere, lo-fi underground tape aesthetic, slurred production texture"},
  ],
  "Pop": [
    {name:"Radio Pop Anthem",desc:"Max Martin school hit construction",prompt:"116 BPM polished radio pop, four-on-the-floor kick, bright synthesizer pads, post-chorus hook drop, powerful chorus belt, emotional pre-chorus build, immaculate production, universal emotional theme"},
    {name:"Dark Pop",desc:"dark minimalist bedroom pop aesthetic",prompt:"72 BPM dark minimalist pop, ASMR close-mic vocal whispering, sparse bass and finger snaps, sub-bass frequency emphasis, sinister emotional undercurrent, whisper vocal over minimal production, claustrophobic intimacy"},
    {name:"Synth-Pop 80s Revival",desc:"New Wave and retrowave aesthetic",prompt:"118 BPM 80s synth-pop revival, vintage Prophet synthesizer pads, gated reverb snare, pulsing bass synth, falsetto vocal, nocturnal neon atmosphere, Italo disco influence, four-on-the-floor dance energy"},
    {name:"Bedroom Pop",desc:"Intimate DIY home recording feel",prompt:"88 BPM bedroom pop, lo-fi home recording aesthetic, close-mic intimate vocal, simple guitar or keyboard, soft drum machine, warm tape saturation, vulnerable confessional lyrics, DIY charm"},
    {name:"Electropop",desc:"Dance-driven bright electronic pop",prompt:"122 BPM electropop, bright arpeggiated synthesizers, punchy four-on-the-floor kick, layered vocal harmonies, euphoric chorus, dance-floor energy, polished electronic production, catchy hook construction"},
    {name:"Nu-Disco Pop",desc:"Retro disco meets modern pop",prompt:"118 BPM nu-disco pop, funky bass guitar groove, disco cowbell, four-on-the-floor kick, bright strings and horns, euphoric confident vocal, Studio 54 atmosphere meets modern polish"},
    {name:"Dream Pop",desc:"Hazy atmospheric pop textures",prompt:"84 BPM dream pop, heavily reverbed guitar washes, lush layered vocals buried in reverb, slow-attack synth pads, hazy atmospheric production, ethereal emotional distance, shoegaze pop influence"},
    {name:"Indie Pop",desc:"Quirky guitar-driven pop",prompt:"104 BPM indie pop, jangly clean guitar, warm melodic bass, punchy indie drum feel, clever wordplay lyrics, bright catchy hooks, DIY aesthetic with professional polish, jangly New York indie pop energy"},
    {name:"Alt-Pop Anthem",desc:"Alternative edge meets pop hooks",prompt:"108 BPM alternative pop, distorted guitar layers under polished pop production, powerful emotional vocal, loud-quiet-loud dynamic, anthemic chorus, dark lyrical themes wrapped in catchy melody"},
  ],
  "R&B": [
    {name:"Neo-Soul",desc:"Neo-soul warm organic feel",prompt:"82 BPM neo-soul, warm Rhodes piano, hip-hop influenced live-feel drumming, organic bass, natural studio imperfection, social consciousness themes, sensual groove with spiritual undertone"},
    {name:"Quiet Storm",desc:"Late night romantic R&B",prompt:"68 BPM quiet storm slow jam, lush orchestral string pads, smooth saxophone, soft kick and snare, silky vocal with melismatic runs, candlelit romance atmosphere, close-mic vocal intimacy"},
    {name:"Trap Soul",desc:"Sung-rap trap soul hybrid",prompt:"80 BPM trap-soul, minimal trap percussion under warm R&B harmony, sung-rap vocal hybrid, intimate conversational delivery, dark vulnerable mood, late night bedroom atmosphere"},
    {name:"Alternative R&B",desc:"Experimental modern soul",prompt:"78 BPM alternative R&B, organic guitar textures, live-feel production, intimate vocal with jazz inflection, unconventional song structure, introspective honest lyricism, emotional vulnerability"},
    {name:"Classic Soul-R&B",desc:"70s smooth Motown influence",prompt:"96 BPM classic R&B, walking bass guitar, tambourine on 2 and 4, lush string arrangement, tight horn stabs, bright polished production, smooth tenor vocal, call-and-response energy"},
    {name:"Contemporary R&B",desc:"Modern radio-ready R&B",prompt:"92 BPM contemporary R&B, clean trap-influenced production, smooth vocal delivery with falsetto, crisp snare and hi-hats, warm synth pads, romantic themes, polished commercial sound"},
    {name:"Afro R&B",desc:"Afrobeats meets modern soul",prompt:"100 BPM Afro R&B, afrobeats percussion under smooth R&B vocal, tropical synth textures, bouncy rhythmic groove, warm romantic themes, Lagos meets Los Angeles production fusion"},
    {name:"R&B Ballad",desc:"Devastating slow emotional delivery",prompt:"60 BPM R&B ballad, solo piano introduction, orchestral string swell, powerful mezzo-soprano build to full belt, melismatic gospel vocal runs, devastating heartbreak or devotion theme, sparse production"},
    {name:"Funk R&B",desc:"Groovy bass-forward soul",prompt:"105 BPM funk-influenced R&B, slap bass guitar groove, wah-wah rhythm guitar, tight punchy drums, horn section punches, confident swaggering vocal, joyful celebratory energy"},
  ],
  "Electronic": [
    {name:"Festival EDM",desc:"Mainstage euphoric drop energy",prompt:"128 BPM progressive house EDM, massive supersaw lead synth, tension-building pre-drop, explosive four-bar drop, sidechain pumping pads, crowd euphoria designed, stadium festival energy"},
    {name:"Deep House",desc:"Underground dancefloor sophistication",prompt:"122 BPM deep house, warm bassline groove, shuffled percussion, soulful vocal chop, hypnotic 8-minute arrangement, Chicago and Detroit club warmth, sophisticated minimal elegance"},
    {name:"Techno",desc:"Berlin industrial club pulse",prompt:"142 BPM minimal techno, industrial kick pulse, metallic percussion, hypnotic repetition with subtle layering, Berlin Berghain warehouse atmosphere, no vocals, functional dancefloor design"},
    {name:"Ambient Electronic",desc:"Generative ambient synthesizer school",prompt:"55 BPM ambient electronic, slowly evolving synthesizer pads, generative melody patterns, no percussion, vast spatial reverb, meditative healing atmosphere, minutes-long harmonic movement"},
    {name:"UK Garage",desc:"London 2-step and bass culture",prompt:"130 BPM UK garage and 2-step, shuffled off-beat hi-hat swing, reese bass sub, pitched vocal chops, London nocturnal atmosphere, half-time feel bass drops, Burial adjacent"},
    {name:"Drum and Bass",desc:"170 BPM amen break energy",prompt:"174 BPM drum and bass, chopped amen break or Think break, rolling bassline, sub-bass pressure, high-energy jungle influence, atmospheric pads contrasting with rhythmic intensity"},
    {name:"Future Bass",desc:"Emotional pitched vocal chops",prompt:"150 BPM future bass, wide reverb-soaked production, pitched-up vocal chops over massive synth chords, emotional melodic drop, supersized sound design, festival-ready euphoric energy"},
    {name:"Trip-Hop",desc:"Bristol dark cinematic downtempo",prompt:"82 BPM trip-hop, cinematic orchestral samples, turntable scratch textures, dark minor atmosphere, haunted noir vocal, James Bond film score influence, slow heavy groove"},
    {name:"Lo-Fi Electronic",desc:"Warm tape-saturated beats",prompt:"90 BPM lo-fi electronic, tape saturation warmth, vinyl crackle texture, simple melodic loop, soft kick and snare, nostalgic hazy atmosphere, nostalgic analog warmth"},
    {name:"Hyperpop",desc:"Maximalist digital chaos",prompt:"160 BPM hyperpop, extreme pitch-shifted vocals, blown-out 808 distortion, maximalist chaotic production, digital artifacting as aesthetic, rave energy meets pop structure, PC Music label sound"},
    {name:"House Classic",desc:"Chicago 4/4 soulful house",prompt:"126 BPM classic house, four-on-the-floor kick, Chicago soul vocal sample, piano chords on off-beat, warm bassline, worship-the-dancefloor energy, Chicago deep house originator aesthetic"},
    {name:"Synthwave",desc:"80s retro-future neon aesthetic",prompt:"108 BPM synthwave, vintage arpeggiated synthesizer, gated reverb snare, cinematic retro-future atmosphere, driving bass pulse, neon highway imagery, Kavinsky and Perturbator energy"},
  ],
  "Rock": [
    {name:"Arena Rock",desc:"Stadium singalong production",prompt:"128 BPM arena rock, massive wall-of-guitar chorus, four-on-the-floor kick, anthemic gang vocal, inspirational lyric themes, arena rock production scale, enormous reverb snare"},
    {name:"Psychedelic Rock",desc:"60s-70s mind expansion",prompt:"95 BPM psychedelic rock, fuzz guitar, organ, backwards tape effects, non-linear song structure, consciousness-expanding lyric themes, Technicolor studio production, psychedelic guitar and studio experimentation energy"},
    {name:"Shoegaze",desc:"Shoegaze walls of guitar sound",prompt:"105 BPM shoegaze, wall of heavily processed guitar creating texture not melody, buried vocal under reverb, motorik drum pattern, tremolo and pitch modulation, beautiful melodic noise, oceanic sound"},
    {name:"Indie Rock",desc:"Jangly guitar-driven indie rock",prompt:"112 BPM indie rock, jangly clean guitar interlock, melodic bass, punchy snare, clever literary lyrics, dynamic verse-chorus contrast, college radio energy, British-American indie rock aesthetic"},
    {name:"Post-Punk Revival",desc:"Angular dark guitar energy",prompt:"118 BPM post-punk revival, angular sharp guitar riff, driving bass as co-lead instrument, minimal production, dark atmospheric tension, detached cool vocal delivery, post-punk angular guitar energy"},
    {name:"Grunge",desc:"Seattle loud-quiet-loud dynamic",prompt:"110 BPM grunge, loud-quiet-loud dynamic structure, overdriven Fender guitar, heavy distorted chorus, vulnerable verse delivery erupting to screaming chorus, Nirvana and Soundgarden energy"},
    {name:"Desert Rock",desc:"heavy desert rock groove",prompt:"106 BPM desert rock, heavy fuzzy guitar groove, thunderous bass, hypnotic repetitive riff, heavy desert rock groove energy, Palm Desert California heat, dry punishing production"},
    {name:"Math Rock",desc:"Odd time signatures and precision",prompt:"Variable tempo math rock, odd time signatures shifting between 7/8 and 5/4, intricate guitar interlock, technical precision, minimal or no vocals, post-rock math rock cerebral influence, cerebral energy"},
  ],
  "Country": [
    {name:"Classic Nashville",desc:"Timeless honky-tonk tradition",prompt:"96 BPM classic Nashville country, pedal steel guitar weeping, Telecaster twang, acoustic guitar strumming, fiddle solo, working-class storytelling, traditional verse-chorus structure, radio Nashville polish"},
    {name:"Outlaw Country",desc:"Raw Americana and singer-songwriter",prompt:"92 BPM outlaw country, raw unproduced acoustic recording, Americana imagery, authentic storytelling, classic outlaw country influence, genuine roughness as artistic statement"},
    {name:"Country Pop Crossover",desc:"Modern mainstream country-pop",prompt:"104 BPM contemporary country-pop, acoustic guitar and banjo over modern production, warm gravelly vocal, emotional storytelling, arena-scale chorus, modern country-pop arena energy"},
    {name:"Appalachian Folk-Country",desc:"Mountain raw acoustic roots",prompt:"88 BPM Appalachian country and folk, acoustic fiddle and guitar interplay, raw unpolished voice with mountain authenticity, raw Appalachian country energy, Eastern Kentucky coal country imagery, sparse production"},
    {name:"Cosmic Country",desc:"Psychedelic Americana fusion",prompt:"86 BPM cosmic country, dreamy pedal steel and acoustic guitar, soft warm production, cosmic country golden hour aesthetic, introspective philosophical lyrics, gentle optimistic energy"},
    {name:"Texas Red Dirt",desc:"Texas and Oklahoma roots music",prompt:"98 BPM Texas red dirt country, electric and acoustic guitar blend, powerful fiery vocal delivery, Texas barroom energy, Texas red dirt country influence, authentic working-class perspective"},
    {name:"Bluegrass",desc:"High lonesome acoustic virtuosity",prompt:"135 BPM bluegrass, acoustic banjo rolls, mandolin chop, fiddle melody, upright bass, tight five-part vocal harmony, high lonesome sound, Appalachian storytelling tradition"},
    {name:"Country Ballad",desc:"Emotional slow country tearjerker",prompt:"72 BPM country ballad, solo acoustic guitar and piano, pedal steel swells, raw heartfelt vocal delivery, devastating personal storytelling, minimal production letting emotion breathe"},
  ],
  "Latin": [
    {name:"Reggaeton",desc:"Dembow Caribbean energy",prompt:"98 BPM reggaeton, standard dembow percussion pattern, trap 808 bass, Spanish lyricism, Puerto Rican and Colombian urban energy, dancehall influence, summer heat sensuality"},
    {name:"Bachata",desc:"Dominican romance and heartbreak",prompt:"125 BPM bachata, nylon string guitar melody, syncopated rhythm guitar, bongo and güira percussion, passionate tenor vocal, Dominican heartbreak romanticism, intimate dance music"},
    {name:"Salsa",desc:"Big band Afro-Cuban celebration",prompt:"105 BPM salsa, full brass section, conga and timbale percussion, Cuban son rhythm, call-and-response between vocalist and brass, celebration and community themes, New York Latin pride"},
    {name:"Latin Trap",desc:"Trap beats with Spanish flow",prompt:"138 BPM Latin trap, heavy 808 bass, trap hi-hats, Spanish rap flow, urban Latin street narrative, Latin trap urban street energy, bilingual code-switching, dark trap atmosphere"},
    {name:"Flamenco Fusion",desc:"Traditional flamenco meets modern",prompt:"95 BPM flamenco fusion, nylon string guitar rasgueado, percussive palmas clapping, passionate vocal with flamenco ornament, modern production underneath, Rosalía experimental influence"},
    {name:"Cumbia Electronic",desc:"Colombian cumbia meets club beats",prompt:"110 BPM cumbia electronic, traditional cumbia rhythm transformed with electronic production, accordion sample textures, danceable groove, Latin American party energy, tropical club atmosphere"},
    {name:"Bolero",desc:"Slow romantic Latin ballad",prompt:"72 BPM bolero, lush orchestral strings, classical guitar, warm resonant baritone or tenor, deeply romantic devotional lyrics, Latin American nostalgia, intimate candlelit atmosphere"},
    {name:"Afrolatino",desc:"Afrobeats meets Caribbean Latin",prompt:"100 BPM Afrolatino, West African percussion meets Latin rhythm, Spanish and English bilingual, tropical production, Ozuna and Afrobeats crossover energy, global summer sound"},
  ],
  "Metal": [
    {name:"Thrash Metal",desc:"Aggressive fast precision",prompt:"185 BPM thrash metal, palm-muted galloping guitar riff, double-kick bass drum, aggressive shouted vocal, political lyric content, Bay Area metal aesthetic, relentless forward momentum"},
    {name:"Doom Metal",desc:"Slow crushing darkness",prompt:"55 BPM doom metal, crushingly slow down-tuned guitar riff, thunderous bass, sparse drumming, haunted baritone vocal, occult imagery, maximum heaviness through slowness, classic heavy metal doom foundation"},
    {name:"Progressive Metal",desc:"Tool and Dream Theater complexity",prompt:"90 BPM progressive metal, odd time signatures rotating through 7/8 and 5/4, technically demanding guitar work, philosophical lyric complexity, long form compositions, dynamic contrast"},
    {name:"Death Metal",desc:"Extreme technical aggression",prompt:"190 BPM death metal, blast beats, heavily down-tuned guitar, guttural growled vocal, complex technical riffing, dark imagery, extreme precision playing, extreme technical death metal influence"},
    {name:"Black Metal",desc:"Atmospheric Nordic darkness",prompt:"160 BPM black metal, tremolo-picked guitar creating icy texture, blast beats, shrieked high vocal, cold Norwegian atmosphere, lo-fi raw production aesthetic, winter and darkness themes"},
    {name:"Nu-Metal",desc:"Late 90s rap-metal crossover",prompt:"110 BPM nu-metal, detuned seven-string guitar groove, rap verse and sung chorus hybrid, heavy aggressive drop, DJ scratch, angst-driven lyrical themes, late 90s nu-metal rap-rock influence"},
    {name:"Metalcore",desc:"Hardcore punk meets metal",prompt:"155 BPM metalcore, breakdown riff, screamed verse transitioning to clean sung chorus, double-kick drumming, aggressive hardcore energy meeting melodic hooks, metalcore melodic hardcore energy"},
    {name:"Stoner Rock",desc:"Fuzzy slow heavy groove",prompt:"82 BPM stoner rock, massive fuzz guitar tone, slow heavy groove, warm analog production, psychedelic texture, desert rock stoner metal influence, desert rock energy, weed-soaked heavy riffing"},
  ],
  "Jazz": [
    {name:"Bebop",desc:"Classic bebop jazz virtuosity",prompt:"220 BPM bebop jazz, saxophone or trumpet rapid chromatic runs over complex chord changes, rhythm section comping, 32-bar form, improvisation as primary expression, New York 1940s sophistication"},
    {name:"Modal Jazz",desc:"Miles Davis Kind of Blue",prompt:"78 BPM modal jazz, scales as basis rather than chords, sparse trumpet or saxophone, piano comping with space, laid-back groove, meditative introspective atmosphere, Kind of Blue aesthetic"},
    {name:"Nu-Jazz Fusion",desc:"Kamasi Washington contemporary",prompt:"96 BPM contemporary jazz fusion, massive ensemble arrangements, hip-hop production values, spiritual cosmic themes, saxophone as lead voice, Los Angeles jazz collective energy"},
    {name:"Jazz Ballad",desc:"Tender slow jazz standard",prompt:"55 BPM jazz ballad, solo piano introduction, brushed snare, upright bass walking, lyrical saxophone or trumpet, emotional melodic development, Great American Songbook tradition"},
    {name:"Hard Bop",desc:"Post-bop soulful drive",prompt:"155 BPM hard bop, driving four-four swing, soulful blues influence in jazz, aggressive trumpet and saxophone interaction, hard bop soulful drive energy"},
    {name:"Acid Jazz",desc:"Funk groove meets jazz harmony",prompt:"100 BPM acid jazz, funky drum groove, organ, electric guitar, jazz harmonic sophistication over funk rhythm, funk-jazz dancefloor consciousness energy, dancefloor jazz consciousness"},
    {name:"Free Jazz",desc:"Avant-garde free jazz collective",prompt:"Freeform free jazz, collective improvisation, no fixed tempo or key center, saxophone saxophone trumpet and bass interacting spontaneously, free jazz avant-garde collective influence, pure expression"},
  ],
  "Indie": [
    {name:"Bedroom Pop",desc:"Lo-fi intimate DIY",prompt:"82 BPM bedroom pop, lo-fi recording aesthetic, close-mic vocal intimacy, simple guitar or keyboard, quiet vulnerable delivery, home studio imperfection as charm, intimate bedroom pop DIY energy"},
    {name:"Chamber Pop",desc:"Orchestral indie sophistication",prompt:"84 BPM chamber pop, string quartet arrangement, piano, understated vocal, literary lyric complexity, quiet emotional devastation, orchestral indie baroque folk aesthetic, baroque folk grandeur"},
    {name:"Shoegaze-Indie",desc:"Dreamy walls of guitar",prompt:"98 BPM indie shoegaze, reverb-drenched guitar texture, buried ethereal vocal, motorik groove, shoegaze reverb-drenched dreamlike influence, dreamlike hazy atmosphere"},
    {name:"Freak Folk",desc:"Eccentric acoustic experimentation",prompt:"78 BPM freak folk, unusual acoustic instrumentation, unconventional song structure, eccentric lo-fi recording, freak folk eccentric acoustic energy, strange tunings and time feels"},
    {name:"Emo Revival",desc:"Raw emotional indie confessional",prompt:"118 BPM emo revival, clean and distorted guitar dynamic, raw emotional vocal delivery, confessional deeply personal lyrics, midwest emo influence, midwest emo Midwest Pen Pals energy"},
    {name:"Art Folk",desc:"Literary sophisticated acoustic",prompt:"80 BPM art folk, acoustic guitar finger-picking, literary complex lyrics, multi-tracked vocal harmonies, subtle orchestration, art folk orchestral pastoral influence, pastoral beauty"},
    {name:"Post-Rock",desc:"Instrumental cinematic build",prompt:"95 BPM post-rock, slow instrumental build from sparse guitar to massive wall of sound, no vocals, layered guitar crescendo, post-rock cinematic crescendo influence"},
    {name:"Jangle Pop",desc:"Bright Rickenbacker guitar pop",prompt:"115 BPM jangle pop, bright clean Rickenbacker or 12-string guitar, melodic bass, upbeat drumming, catchy hooks, jangle pop Rickenbacker guitar influence, optimistic bittersweet energy"},
  ],
  "Soul": [
    {name:"Classic Soul",desc:"Southern soul gospel fire",prompt:"95 BPM classic soul, warm Hammond organ, tight horn section, live drum feel, powerful raw vocal with gospel runs, emotional authenticity, Southern soul analog warmth, gritty analog warmth"},
    {name:"Motown",desc:"Detroit soul precision and polish",prompt:"120 BPM Motown soul, walking bass guitar, tambourine on 2 and 4, lush string arrangement, bright pop production, call-and-response vocals, Detroit precision and joy, Motown Detroit precision and joy"},
    {name:"Neo-Soul Modern",desc:"alternative R&B introspective sensibility",prompt:"78 BPM modern neo-soul, warm layered guitar textures, live-feel production, vulnerable intimate vocal, jazz harmony influence, introspective emotional depth, Los Angeles warmth"},
    {name:"Psychedelic Soul",desc:"psychedelic soul-funk boundary-pushing experimentation",prompt:"100 BPM psychedelic soul-funk, dense layered production, syncopated polyrhythm, multi-tracked vocal harmonies, social commentary, raw funk guitar, boundary-pushing studio experimentation"},
    {name:"Southern Soul",desc:"Deep South blues-inflected soul",prompt:"88 BPM Southern soul, slow-burning blues influence, organ and piano blend, horns, raw powerful baritone or alto, Southern soul intimate emotional authenticity, intimate emotional authenticity"},
    {name:"Philadelphia Soul",desc:"TSOP lush orchestral production",prompt:"105 BPM Philadelphia soul, lush orchestral string arrangement, smooth polished production, MFSB and PIR Records energy, elegant sophisticated vocal, sweeping emotional romantic themes"},
  ],
  "Afrobeats": [
    {name:"Afropop",desc:"Nigerian mainstream celebration",prompt:"100 BPM Afropop, Lagos energy, syncopated Afrobeats percussion, love and celebration themes, tropical synthesizer production, English and Yoruba bilingual, global crossover accessibility"},
    {name:"Amapiano",desc:"South African log drum piano",prompt:"112 BPM amapiano, characteristic log drum 808 bass pattern, shuffled Afro house percussion, piano loops, Johannesburg township culture, communal dance celebration"},
    {name:"Afroswing",desc:"UK Afrobeats diaspora fusion",prompt:"105 BPM Afroswing, UK drill rhythms under Afrobeats melodic sensibility, smooth vocal, London-Lagos cultural fusion, dancehall influence, romantic themes with swagger"},
    {name:"Highlife",desc:"Ghanaian brass and guitar tradition",prompt:"115 BPM highlife, acoustic and electric guitar interplay, brass section, upbeat polyrhythmic percussion, Ghanaian celebration, communal joy, West African melodic warmth"},
    {name:"Afro-Fusion",desc:"Genre-blending modern afrobeats",prompt:"98 BPM afro-fusion, blending afrobeats with reggae R&B and hip-hop, eclectic production palette, smooth powerful vocal, global cultural synthesis, Lagos to London to Los Angeles"},
    {name:"Afrobeats Drill",desc:"West African meets UK drill",prompt:"140 BPM Afro drill, West African melodic influence over UK drill production, percussive afrobeats elements, bilingual lyrical style, London-Lagos energy fusion, bass-heavy club atmosphere"},
  ],
  "Folk": [
    {name:"Singer-Songwriter",desc:"timeless folk singer-songwriter tradition",prompt:"72 BPM folk singer-songwriter, solo acoustic guitar fingerpicking, close-mic vocal with room sound, honest confessional lyrics, minimal production, timeless emotional directness"},
    {name:"Indie Folk",desc:"indie folk lush multi-part vocal harmony",prompt:"82 BPM indie folk, layered acoustic guitar, lush multi-part vocal harmony, atmospheric production, seasonal imagery, dense orchestral texture building from sparse opening"},
    {name:"Celtic Folk",desc:"Traditional Irish and Scottish roots",prompt:"124 BPM Celtic folk, acoustic fiddle lead, bouzouki rhythm, penny whistle, bodhran percussion, traditional dance energy, Irish pub warmth, storytelling tradition"},
    {name:"Americana",desc:"Roots music at the intersection",prompt:"88 BPM Americana, pedal steel guitar, acoustic and electric guitar blend, brushed snare, walking bass, literary storytelling, wide-open landscape imagery, honest working-class voice"},
    {name:"Folk Rock",desc:"Dylan goes electric energy",prompt:"100 BPM folk rock, electric and acoustic guitar blend, full band arrangement, lyrical poetic content, classic folk rock electric jangle energy, jangly Rickenbacker tone, protest and beauty"},
    {name:"Pastoral Folk",desc:"Gentle nature-imagery acoustic",prompt:"70 BPM pastoral folk, fingerpicked acoustic guitar, soft flute or recorder, gentle brush drums, nature and seasons imagery, British folk influence, pastoral British folk warmth"},
    {name:"Vermont Folk-Pop",desc:"earnest folk-pop emotional geography",prompt:"100 BPM folk-pop, acoustic guitar with full band, earnest honest baritone, geographic specificity in lyrics, emotional coming-of-age themes, Stick Season autumn imagery, powerful singalong chorus"},
  ],
  "Reggae": [
    {name:"Roots Reggae",desc:"conscious roots reggae vibration",prompt:"78 BPM roots reggae, classic one-drop drum pattern, heavy bass on the one, offbeat guitar skank, organ bubble, spiritual consciousness themes, Rastafari philosophy, Jamaican warmth"},
    {name:"Dancehall",desc:"Kingston bashment energy",prompt:"100 BPM dancehall, riddim-driven production, digital drum pattern, skanking rhythm guitar, Jamaican patois vocal, celebration and romance, high energy party atmosphere"},
    {name:"Dub",desc:"dub studio as instrument philosophy",prompt:"74 BPM dub reggae, heavy bass frequencies, echo and reverb as instruments, selective instrumental drop-outs, studio effects creating space, cavernous room sound, hypnotic groove"},
    {name:"Modern Reggae",desc:"Contemporary conscious sound",prompt:"85 BPM contemporary reggae, modern production with roots foundation, conscious lyrics over clean digital production, modern reggae revival conscious energy, acoustic and digital hybrid"},
    {name:"Reggae-Rap",desc:"Reggae hip-hop conscious crossover",prompt:"92 BPM reggae hip-hop crossover, reggae rhythm with hip-hop production elements, rapid deejay flow over one-drop pattern, conscious socially aware lyrics, reggae hip-hop crossover conscious energy"},
  ],
  "Blues": [
    {name:"Delta Blues",desc:"Delta blues raw acoustic roots",prompt:"80 BPM delta blues, slide guitar on acoustic resonator, raw solo vocal, minimal accompaniment, Southern Gothic imagery, human suffering and resilience, dusty road atmosphere"},
    {name:"Chicago Electric Blues",desc:"Chicago electric blues amplified power",prompt:"100 BPM Chicago electric blues, overdriven harmonica, electric slide guitar, tight rhythm section, 12-bar structure, urban power and swagger, Chess Records grit"},
    {name:"Blues Rock",desc:"Hendrix and Stevie Ray guitar god",prompt:"110 BPM blues rock, extended guitar soloing with pentatonic runs, hard rock rhythm section, soulful vocal, guitar as primary emotional voice, concert-hall live energy"},
    {name:"Soul Blues",desc:"Soul blues sophisticated elegance",prompt:"88 BPM soul blues, clean jazz-influenced guitar, full band arrangement with horns, sophisticated vocal phrasing, adult contemporary emotional depth, sophisticated soul blues guitar conversation"},
    {name:"Modern Blues",desc:"modern blues contemporary feel",prompt:"106 BPM modern blues, Gibson semi-hollow guitar tone, contemporary production values, political and personal themes, guitar virtuosity meets hip-hop influence, Austin Texas energy"},
    {name:"Slow Blues",desc:"Late night 12-bar devastation",prompt:"58 BPM slow blues, aching minor key 12-bar form, spare bass and drums, weeping guitar phrases, confessional heartbreak vocal, late night whiskey bar atmosphere, maximum emotional weight"},
  ],
  "Punk": [
    {name:"Classic Punk",desc:"Ramones and Sex Pistols raw energy",prompt:"185 BPM classic punk rock, down-strummed power chords, simple 4/4 drumming, shouted group vocals, lo-fi recording, anti-establishment attitude, two-minute song format, raw aggression"},
    {name:"Post-Punk",desc:"post-punk dark atmospheric sophistication",prompt:"115 BPM post-punk, angular guitar with chorus or flanging, driving bass as melody instrument, minimal drumming, detached baritone vocal, dark atmospheric production, industrial Northern England mood"},
    {name:"Pop-Punk",desc:"pop-punk arena energy",prompt:"168 BPM pop-punk, distorted power chord guitar, anthemic vocal melody, tight precise drumming, emotional teenage themes, radio polish on raw energy, arena-scale chorus"},
    {name:"Hardcore Punk",desc:"Maximum aggression minimum time",prompt:"200 BPM hardcore punk, blast beats, shouted vocal, down-tuned guitars, 90-second songs, maximum aggression, DIY underground ethic, cathartic energy release, mosh pit energy"},
    {name:"Skate Punk",desc:"Fast melodic SoCal punk",prompt:"175 BPM skate punk, fast melodic guitar, horn or trumpet accents, tight drumming, SoCal melodic skate punk energy, Southern California skate culture, satirical political lyrics, three-chord melody"},
    {name:"Emo Punk",desc:"Emotional post-hardcore feeling",prompt:"140 BPM emo, clean verse exploding to distorted chorus, raw emotional vocal, confessional personal lyrics, guitar interplay, emo punk confessional cathartic energy, cathartic release"},
  ],
  "Ambient": [
    {name:"Pure Ambient",desc:"generative ambient atmosphere",prompt:"No fixed BPM pure ambient, slowly evolving synthesizer pads, generative harmonic movement, no rhythmic pulse, infinite sustain, meditation and contemplation atmosphere, space between sounds as music"},
    {name:"Dark Ambient",desc:"Atmospheric tension and dread",prompt:"50 BPM dark ambient, low drone frequencies, dissonant texture layers, industrial sound design elements, unsettling atmosphere, cinematic tension without resolution, darkness as texture"},
    {name:"Ambient Electronic",desc:"nostalgic warm ambient electronic",prompt:"65 BPM warm ambient electronic, vintage synthesizer tones, tape saturation warmth, subtle rhythmic pulse, nostalgic hazy atmosphere, childhood memory imagery, washed-out analog sound"},
    {name:"Nature Ambient",desc:"Field recording and synthesis",prompt:"No tempo nature ambient, processed field recordings of rain and forest, synthesizer harmonics, binaural audio design, healing frequency content, restorative calm atmosphere"},
    {name:"Neo-Classical Ambient",desc:"Ólafur Arnalds piano and strings",prompt:"72 BPM neo-classical ambient, generative piano phrases over string pad, emotional cinematic sweep, Icelandic restraint and beauty, STRATUS generative system aesthetic, delicate and devastating"},
    {name:"Tape Loop Ambient",desc:"Basinski disintegration aesthetic",prompt:"Slow decaying tape loop ambient, analog tape deterioration texture, slowly dissolving melodic fragments, loss and memory as theme, meditative decay, nostalgic dissolution over long duration"},
  ],
  "Gospel": [
    {name:"Traditional Gospel",desc:"traditional gospel church fire",prompt:"92 BPM traditional gospel, Hammond organ with Leslie speaker, powerful choir, hand claps on 2 and 4, testifying vocal, spiritual themes of redemption, Black church tradition, joyful noise"},
    {name:"Contemporary Gospel",desc:"contemporary gospel crossover production",prompt:"115 BPM contemporary gospel, hip-hop influenced production, massive choir arrangement, driving rhythm section, inspirational lyric themes, crossover pop appeal, celebration and victory"},
    {name:"Worship Ballad",desc:"Hillsong intimate surrender",prompt:"68 BPM modern worship ballad, piano-led arrangement, soaring vocal build, string swells, intimate devotional lyric, congregational sing-along melody, emotional spiritual surrender"},
    {name:"Gospel Soul",desc:"classic gospel soul sacred feeling",prompt:"85 BPM gospel soul, piano and organ blend, small ensemble feel, deeply expressive vocal, spiritual and secular emotion merged, authentic feeling above all production"},
    {name:"Urban Gospel",desc:"Urban multicultural worship collective",prompt:"90 BPM urban contemporary gospel, diverse multicultural worship collective, rotating lead vocals, hip-hop and R&B influenced production, multicultural urban worship collective energy, joyful inclusive praise"},
  ],
  "K-Pop": [
    {name:"K-Pop Banger",desc:"K-pop idol group stadium energy",prompt:"130 BPM K-pop, polished multi-layered production, hook-driven vocal melody, English and Korean bilingual, choreography-ready beat, emotional pre-chorus build to explosive chorus, idol group energy"},
    {name:"K-Pop Ballad",desc:"Emotional vocal showcase",prompt:"70 BPM K-pop ballad, piano and orchestral strings, crystal clear vocal production, emotional storytelling, longing and hope themes, high-note climax moment, tearful catharsis"},
    {name:"K-Pop Hip-Hop",desc:"self-produced K-pop hip-hop intensity",prompt:"140 BPM K-pop hip-hop, trap production with K-pop melodic sensibility, rap verse and sung chorus hybrid, intense powerful delivery, 3RACHA production aesthetic, hype group energy, layered harmonies"},
    {name:"Synth K-Pop",desc:"K-pop retro-futurist synthesizer aesthetic",prompt:"118 BPM synth-pop K-pop, vintage synthesizer aesthetic with modern polish, funky bass, clean falsetto vocal, retro-futurist visual imagery, sophisticated melodic composition"},
    {name:"Y2K K-Pop",desc:"Y2K effortless K-pop revival",prompt:"108 BPM Y2K influenced K-pop, early 2000s production aesthetic, minimalist authentic styling, understated cool vocal, retro-fresh sound design, Y2K-influenced effortless K-pop aesthetic, effortless infectious melody"},
    {name:"Dark K-Pop Concept",desc:"Dark conceptual K-pop concept",prompt:"128 BPM dark K-pop concept, dramatic orchestral intro, powerful girl group energy, dark conceptual K-pop universe aesthetic, intense visual storytelling, massive drop, empowered fierce concept"},
  ],
  "Drill": [
    {name:"UK Drill",desc:"London cold streets and sliding bass",prompt:"140 BPM UK drill, dark minor key orchestral sample, cold mechanical hi-hat pattern, sliding 808 bass notes, hard snare, street-level lyric realism, London estates atmosphere, menacing energy"},
    {name:"Chicago Drill",desc:"Chicago drill street narrative origin",prompt:"145 BPM Chicago drill, sparse eerie production, heavy 808 bass, rapid hi-hats with triplet patterns, cold emotionless delivery, South Side Chicago street narrative, dark minor keys"},
    {name:"Melodic Drill",desc:"NY melodic drill deep hook",prompt:"140 BPM melodic drill, deep booming 808, dark melodic hook over drill percussion, gravelly baritone vocal style, Brooklyn NY energy, ominous string samples"},
    {name:"Afro Drill",desc:"UK-Africa Afro drill fusion",prompt:"142 BPM Afro drill, West African melodic influence over UK drill production, percussive afrobeats elements, bilingual lyrical style, London-Lagos energy fusion, bass-heavy club atmosphere"},
    {name:"NY Drill",desc:"Brooklyn Brooklyn NY drill energy",prompt:"142 BPM New York drill, New York drill production style, hard snare, dark minor melody, Brooklyn street narrative, rapid-fire flow, dark atmospheric production"},
  ],
  "Phonk": [
    {name:"Memphis Phonk",desc:"Memphis underground ghostly phonk revival",prompt:"130 BPM Memphis phonk, slowed and pitched-down hip-hop vocal samples, distorted 808 bass, cowbell percussion, eerie haunted atmosphere, slurred lo-fi aesthetic, underground tape culture"},
    {name:"Drift Phonk",desc:"Aggressive racing car energy",prompt:"140 BPM drift phonk, aggressive distorted 808, energetic cowbell and hat patterns, high-intensity momentum, car culture aesthetic, adrenaline-fueled forward drive, dark aggressive synths"},
    {name:"Dark Phonk",desc:"Cold underground midnight sound",prompt:"120 BPM dark phonk, slowed reverb vocal, cold minor key atmosphere, heavy sub bass, atmospheric horror elements, underground DIY production, isolated midnight mood"},
    {name:"Phonk House",desc:"Brazilian dance energy crossover",prompt:"135 BPM phonk house, four-on-the-floor kick with phonk percussion overlay, Brazilian baile funk influence, aggressive bass, dancefloor energy with dark underground aesthetic"},
    {name:"Lofi Phonk",desc:"Chill dark phonk tape warmth",prompt:"110 BPM lo-fi phonk, tape-saturated warm production, gentle cowbell groove, slowed soul vocal sample, chill but dark atmosphere, study-beats meets underground phonk, nostalgic warmth"},
  ],
};

// Sort blueprints alphabetically within each genre
Object.keys(GENRE_BPS).forEach(g => {
  GENRE_BPS[g].sort((a, b) => a.name.localeCompare(b.name));
});



// ============================================================

// ============================================================
// ============================================================
// GENRE COLORS
// ============================================================
const GENRE_COLORS = {
  'Hip-Hop': '#ff6b35',
  'Pop': '#ff4d6d',
  'R&B': '#c77dff',
  'Electronic': '#00d4ff',
  'Rock': '#f72585',
  'Metal': '#ff2020',
  'Country': '#ffd166',
  'Latin': '#06d6a0',
  'K-Pop': '#ff9ef5',
  'Indie': '#a8dadc',
  'Jazz': '#f9c74f',
  'Blues': '#4361ee',
  'Soul': '#fb8500',
  'Reggae': '#52b788',
  'Funk': '#e9c46a',
  'Punk': '#ef233c',
  'Folk': '#95d5b2',
  'Afrobeats': '#2dc653',
  'Ambient': '#90e0ef',
  'Classic Rock': '#e76f51',
  'Alternative': '#9b2226',
  'Gospel': '#f4a261',
  'Drill': '#c1121f',
};

const GENRE_COLORS_BP = {
  'Hip-Hop':'#ff4d6d','Pop':'#ffd700','R&B':'#c77dff','Electronic':'#00f5d4',
  'Rock':'#ff6b35','Country':'#d4a843','Latin':'#ff6b9d','Metal':'#cc3333',
  'Jazz':'#4fc3f7','Indie':'#aed581','Soul':'#ffb347','Afrobeats':'#69d14f',
  'Folk':'#a5d6a7','Reggae':'#1fbc1f','Blues':'#5b9bd5','Punk':'#ff1744',
  'Ambient':'#80cbc4','Gospel':'#ffe082','K-Pop':'#f48fb1','Drill':'#78909c','Phonk':'#b39ddb',
};

// ============================================================
// ARTIST DATABASE — 259 artists
// ============================================================
const ARTISTS = [
{name:"Drake",genre:"Hip-Hop",bpm:"70-95",mood:["melodic","introspective","confident"],
blueprint:"80 BPM OVO Sound trap, minimal warm piano or Rhodes loops, soft 808 bass with gentle pitch rides, hi-hats alternating straight 8ths and triplet rolls, sung-rap hybrid with tasteful Auto-Tune warmth, lush background falsetto harmonies, spacious production with intentional empty pockets, reverb-heavy atmospheric mix, bittersweet tone balancing braggadocio and vulnerability, Toronto polished pop-rap accessibility"},

{name:"Kendrick Lamar",genre:"Hip-Hop",bpm:"75-105",mood:["intense","literary","West Coast"],
blueprint:"90 BPM jazz-infused West Coast hip-hop, live double bass and brushed snare samples, saxophone stabs and muted trumpet, complex polyrhythmic drum programming, completely dry close-mic vocal with intentional dynamic contrast between whisper and shout, dense multisyllabic internal rhymes, shifting narrative perspectives, spiritual confrontation and political charge, Compton storytelling tradition"},

{name:"Travis Scott",genre:"Hip-Hop",bpm:"130-145",mood:["psychedelic","euphoric","Houston"],
blueprint:"138 BPM hypnotic Houston trap, massive cavernous 808 bass with long melodic pitch slides, rapid hi-hat triplet cascades cutting suddenly to silence, dense layered Auto-Tune vocals with heavy reverb and delay, stadium-scale snare reverb, psychedelic pitched choir samples, cinematic orchestral swells, hazy euphoric texture, crowd chant moments, ASTROWORLD festival energy"},

{name:"Post Malone",genre:"Hip-Hop",bpm:"80-100",mood:["melancholy","anthemic","rock-influenced"],
blueprint:"88 BPM melodic pop-trap hybrid, distorted rock electric guitar riffs over trap 808 bass, heavy Auto-Tune emotional wobble on chorus, sing-song rap over minor-key progressions, punchy compressed snare, thick layered background vocal stack, quiet verse building to explosive guitar-driven chorus, heartbroken introspective lyrics, radio-polished production"},

{name:"Future",genre:"Hip-Hop",bpm:"65-80",mood:["dark","hypnotic","nihilistic"],
blueprint:"72 BPM Atlanta trap, deeply resonant detuned 808 bass with long decay, sparse hi-hat pattern with sudden triplet bursts, heavy melodic Auto-Tune applied to near-spoken narcotic delivery, minor-key ambient synth washes, ominous padded chord stabs, emotionally detached performance, dense ad-lib layers cascading in stereo, Freebandz dark narcotic atmosphere"},

{name:"Lil Baby",genre:"Hip-Hop",bpm:"80-96",mood:["street","emotional","melodic"],
blueprint:"88 BPM Atlanta melodic trap, punchy 808 bass with mid-length pitch decay, stuttering hi-hats with triplet flourishes, melodic sung-rap with light Auto-Tune, piano loop or orchestral string sample flips, emotionally charged narrative about street life and rising above, strong hook built around simple repeated melodic phrase, Quality Control vibrant commercial production"},

{name:"J. Cole",genre:"Hip-Hop",bpm:"82-96",mood:["introspective","lyrical","soulful"],
blueprint:"87 BPM soulful boom-bap hip-hop, warm dusty piano loops and jazz chord samples, live-feel kick and snare with boom-bap swing, deep clean bass guitar, zero Auto-Tune raw natural voice, rapid multisyllabic flows with internal rhyme complexity, emotionally honest confessional storytelling, extended metaphors, Dreamville introspective mood balancing street realism and personal growth"},

{name:"Cardi B",genre:"Hip-Hop",bpm:"92-108",mood:["fierce","playful","Bronx"],
blueprint:"98 BPM New York trap, hard-hitting 808 and punchy snare, bouncy hi-hat pattern, dominant confident Bronx delivery with Dominican accent inflections, rapid-fire aggressive bars in verses, infectious melodic sing-song hooks, bass-forward bold mix, drill production influence with glossy Atlantic Records finish, unapologetic personality, club-ready groove"},

{name:"Nicki Minaj",genre:"Hip-Hop",bpm:"85-108",mood:["fierce","theatrical","versatile"],
blueprint:"96 BPM pop-trap hybrid, bright synth leads over hard bass, crisp snare-clap combos, multiple distinct vocal character voices and accent shifts mid-verse, high-pitched alter ego delivery contrasted with deep chest-voice bars, dense punchline-heavy internal rhymes, bold theatrical hook construction, production spanning hard trap to dancehall-pop, commanding Trinidad energy"},

{name:"Tyler the Creator",genre:"Hip-Hop",bpm:"72-96",mood:["eccentric","artistic","Los Angeles"],
blueprint:"84 BPM neo-soul influenced hip-hop, lush warm jazz-extended chord progressions, vintage Wurlitzer and Moog bass, live drumkit feel with dusty sampling, melodic sung hooks blending seamlessly into rapped verses, intimate unpolished vocal quality, unconventional non-linear song structures, vibrant cinematic horn and string arrangements, themes shifting from absurdism to vulnerability, Golf Wang aesthetic"},

{name:"Playboi Carti",genre:"Hip-Hop",bpm:"138-155",mood:["hypnotic","aggressive","minimalist"],
blueprint:"148 BPM high-BPM trap, distorted 808 bass punching in sync with kick drum, blazing hi-hat triplets and rolls, baby-pitched melodic hooks built from two or three repeated words, deliberately minimal and repetitive lyric content, dark gothic orchestral strings, mosh-pit energy, Pierre Bourne psychedelic drops and abrupt edits, Whole Lotta Red vampiric aesthetic, hypnotic repetition as the point"},

{name:"Gunna",genre:"Hip-Hop",bpm:"76-90",mood:["luxurious","melodic","Atlanta"],
blueprint:"82 BPM drip-era Atlanta trap, lush melodic Auto-Tune over warm synth pads, long sustaining 808 bass with flutter, delicate hi-hat skitters, luxury fashion and designer wealth narrative, smooth languid slurred delivery, flute loops and string background, immaculate YSL production polish, effortless cool energy"},

{name:"Roddy Ricch",genre:"Hip-Hop",bpm:"78-92",mood:["emotional","melodic","Compton"],
blueprint:"85 BPM West Coast melodic trap, singing-rapping hybrid with strong emotional Auto-Tune runs and note bends, warm orchestral string pads, resonant 808 bass with descending pitch slides, Compton street narrative contrasted with radio pop accessibility, heartfelt vulnerable hooks, crisp trap percussion, West Coast melodic trap sound"},

{name:"21 Savage",genre:"Hip-Hop",bpm:"70-86",mood:["cold","menacing","Atlanta"],
blueprint:"76 BPM minimal Atlanta trap, deeply resonant low 808 bass, sparse percussion with delayed hard snare and simple hi-hat, completely emotionless deadpan delivery with subtle British London accent undertone, cold calculated street narrative, minimal vocal processing, dark minor-key synth atmospherics, threatening calm restraint, cold calculating Atlanta trap energy"},

{name:"Metro Boomin",genre:"Hip-Hop",bpm:"128-145",mood:["cinematic","dark","orchestral"],
blueprint:"138 BPM cinematic orchestral trap production, gothic violin strings and haunted choir pad layers, explosive 808 bass drops, hard punishing snare with long reverb tail, signature Metro producer tag ad-lib, dramatic orchestral build before beat drops and switches, dark superhero villain cinematic atmosphere, Heroes and Villains scope, dense layered production depth"},

{name:"Nas",genre:"Hip-Hop",bpm:"82-96",mood:["poetic","classic","New York"],
blueprint:"88 BPM classic East Coast boom-bap, warm vinyl-crackle soul sample loops, punchy live-drummer kick and snare, deep clean bass guitar, raw powerful baritone with zero pitch correction, dense Queensbridge street poetry with complex rhyme schemes, vivid cinematic storytelling, DJ Premier and Large Professor production aesthetics, jazz sample chops, Illmatic timeless weight"},

{name:"Jay-Z",genre:"Hip-Hop",bpm:"84-100",mood:["confident","mogul","Brooklyn"],
blueprint:"92 BPM East Coast boom-bap evolved into luxury production, soul sample flips and orchestral interpolations, clean walking bass, spacious sophisticated production, laid-back confident baritone with complex internal rhyme webs and extended metaphors, business empire narrative fused with street authenticity, Just Blaze and Timbaland production aesthetic, Blueprint Roc-A-Fella swagger"},

{name:"Kanye West",genre:"Hip-Hop",bpm:"72-96",mood:["maximalist","genre-defying","Chicago"],
blueprint:"85 BPM maximalist hip-hop, pitched-up soul sample chops and vocal flips, live orchestral string arrangements, gospel choir integration, massive 808 bass, experimental beat switches mid-song, stream-of-consciousness lyricism between grandiosity and vulnerability, huge sonic scale, Chicago spiritual and street duality, Late Registration and Graduation lush production"},

{name:"Eminem",genre:"Hip-Hop",bpm:"95-118",mood:["technical","intense","Detroit"],
blueprint:"105 BPM Detroit boom-bap, aggressive compressed bass, hard rock guitar sample integration, machine-gun rapid-fire syllabic delivery at the extreme edge of rhythmic precision, intricate multisyllabic rhyme schemes sustained over 16 bars, dark horrorcore atmosphere with dark humor, technical lyrical acrobatics as primary artistic statement, minimal Auto-Tune raw voice, intense emotional catharsis"},

{name:"Tupac",genre:"Hip-Hop",bpm:"84-97",mood:["passionate","activist","Los Angeles"],
blueprint:"90 BPM West Coast G-funk influenced hip-hop, warm synthesizer bass with slow portamento LFO, funky laid-back drum groove with live hi-hat swing, soul and R&B vocal sample interpolations, passionate earnest delivery with natural charisma, activist street poetry blending righteous anger with hope, political and social consciousness, emotional directness, cinematic narrative storytelling"},

{name:"Biggie",genre:"Hip-Hop",bpm:"80-96",mood:["commanding","vivid","Brooklyn"],
blueprint:"88 BPM classic New York boom-bap, deep chopped soul grooves and jazz sample flips, hard punching kick and snare, dark jazz chord progressions, massive effortless baritone voice with natural cadence shifts and perfect breath control, vivid cinematically detailed street narratives, wit and dark humor woven throughout, Ready to Die and Life After Death cinematic scope"},

{name:"Lil Uzi Vert",genre:"Hip-Hop",bpm:"130-152",mood:["hypnotic","alien","Philadelphia"],
blueprint:"140 BPM Philadelphia melodic trap, airy synth arpeggios and plucked guitar samples, thunderous 808 bass with long sustain, rapid hi-hat with sudden silence gaps, high-pitched Auto-Tune singing-rapping hybrid, pop-punk and emo guitar influence, anime and rock culture aesthetics, XO TOUR Llif3 emotional vulnerability, Eternal Atake psychedelic energy"},

{name:"Young Thug",genre:"Hip-Hop",bpm:"72-96",mood:["melodic","eccentric","Atlanta"],
blueprint:"82 BPM Atlanta trap, bouncy melodic 808 bass with pitch variation, complex hi-hat rolls, completely unique melodic vocal delivery treating voice as instrument with pitch bends and warbles, genre-blending from trap to pop to rock, abstract surrealist wordplay, So Much Fun lavish energy, Young Stoner Life aesthetic, pioneered modern melodic rap vocal approach"},

{name:"Lil Wayne",genre:"Hip-Hop",bpm:"85-105",mood:["lyrical","eccentric","New Orleans"],
blueprint:"95 BPM New Orleans bounce-influenced hip-hop, thick synth bass and drum machine pattern, nasal raspy vocal delivery with constant internal rhyme and punchline density, abstract metaphor-heavy lyricism with wordplay, rock guitar influence, distinctive phrasing and syllable stretching, Cash Money swagger, Tha Carter III creative peak"},

{name:"Megan Thee Stallion",genre:"Hip-Hop",bpm:"90-108",mood:["fierce","Houston","confident"],
blueprint:"100 BPM Houston hip-hop, bouncy trap beat with twerking-ready groove, hard 808 and crisp snare, Hot Girl summer energy, confident aggressive delivery, body-positive feminist lyrics, rapid-fire Houston flow with Southern slang, hyped female empowerment hooks, Good News production polish, animated ad-libs"},

{name:"Jack Harlow",genre:"Hip-Hop",bpm:"84-100",mood:["smooth","Louisville","charismatic"],
blueprint:"92 BPM Louisville Kentucky hip-hop, boom-bap influenced samples with modern trap production, melodic hooks with charming confident delivery, clean mid-tempo beat, Come Home the Kids Miss You sound, charismatic laid-back flow with pop crossover appeal, soulful sample flips, social narrative lyricism"},

{name:"Polo G",genre:"Hip-Hop",bpm:"80-96",mood:["emotional","Chicago","melodic"],
blueprint:"88 BPM Chicago melodic trap, piano melodies over trap 808 and hi-hats, emotional sung hooks with strong Auto-Tune runs, street narrative mixing vulnerability with aggression, Die a Legend sound, Chicago South Side perspective, guitar samples in production, introspective youth experience lyricism"},

{name:"Rod Wave",genre:"Hip-Hop",bpm:"70-88",mood:["emotional","soulful","Florida"],
blueprint:"78 BPM Florida melodic rap, emotional gospel-inflected singing over soft trap production, SoulFly sound, warm piano melodies, soft 808 and muted hi-hats, heavy emotive Auto-Tune on powerful vocal runs, stadium-ready emotional chorus, vulnerable heartbreak and street struggle themes"},

{name:"Ski Mask The Slump God",genre:"Hip-Hop",bpm:"130-148",mood:["energetic","chaotic","Florida"],
blueprint:"140 BPM Florida high-energy trap, chaotic hard-hitting 808, aggressive fast-switching flow with cartoon sound effect references, rapid-fire punchlines and pop culture references, distorted screaming drops, Catch Me Outside explosive energy, anime-influenced imagery, boisterous personality over face-melting production"},

{name:"A$AP Rocky",genre:"Hip-Hop",bpm:"72-96",mood:["fashion-forward","atmospheric","New York"],
blueprint:"84 BPM New York atmospheric trap, dreamy cloud rap texture with chopped pitched samples, smooth 808 bass, laid-back effortlessly cool delivery, TESTING experimental range from psych-rock to trap, fashion and high-culture lyricism, A$AP Mob Harlem energy, LSD Praise the Lord anthemic quality, aesthetic and visual consciousness"},

{name:"Big Sean",genre:"Hip-Hop",bpm:"88-105",mood:["energetic","Detroit","confident"],
blueprint:"96 BPM Detroit trap-pop hybrid, energetic punchy 808 and snare, fast-talking confident flow with frequent ad-libs, I Decided Detroit storytelling, Finally Famous G.O.O.D. Music energy, melodic hooks with strong pop appeal, rapid-fire verse delivery, ambitious motivational themes"},

{name:"Logic",genre:"Hip-Hop",bpm:"90-108",mood:["technical","Maryland","uplifting"],
blueprint:"98 BPM Maryland boom-bap influenced hip-hop, technical rapid-fire flows with lyrical complexity, Rattpack positive energy, Under Pressure soul sample production, 1-800-273-8255 radio crossover anthemic production, jazz chord progressions, inspirational mental health themes"},

{name:"Denzel Curry",genre:"Hip-Hop",bpm:"95-118",mood:["aggressive","eclectic","Florida"],
blueprint:"108 BPM Florida aggressive hip-hop, hard-hitting drums and distorted bass, intense screaming delivery transitioning to melodic singing, TA1300 experimental range, Carol City Florida imagery, Unlocked jazz-influenced beats, punk and metal energy fused with hip-hop, social consciousness and personal trauma themes"},

{name:"Outkast",genre:"Hip-Hop",bpm:"90-106",mood:["innovative","Southern","genre-defying"],
blueprint:"98 BPM Atlanta Southern hip-hop, live instrumentation fused with electronic production, Aquemini organic soul and funk samples, Speakerboxxx Love Below genre-spanning from hip-hop to jazz to psychedelia, Andre 3000 eccentric theatrical delivery contrasted with Big Boi rapid street flow, ATLiens futuristic Southern aesthetic, Dungeon Family collective sound"},

{name:"Snoop Dogg",genre:"Hip-Hop",bpm:"92-105",mood:["smooth","West Coast","G-Funk"],
blueprint:"96 BPM West Coast G-Funk, slow-rolling synthesizer bass with portamento slide, high-pitched P-Funk melody line, laid-back LBC Long Beach drum groove, Doggystyle Dr. Dre production, smooth effortless gliding delivery, gangster narrative with playful humor, gin and juice laid-back California vibe"},

{name:"MF DOOM",genre:"Hip-Hop",bpm:"82-96",mood:["abstract","underground","complex"],
blueprint:"88 BPM underground New York hip-hop, dusty obscure sample flips from cartoons and jazz, boom-bap drum programming, dense abstract rhyme schemes with superhero villain persona, Madvillainy Madlib collaboration beats, layered complex internal rhymes over intricate sample loops, deadpan delivery behind the metal mask, comic book mythology lyricism"},

{name:"Wu-Tang Clan",genre:"Hip-Hop",bpm:"85-100",mood:["gritty","Staten Island","cinematic"],
blueprint:"92 BPM Staten Island boom-bap, RZA-produced soul and kung-fu film sample chops, raw grimy drum programming, nine-member collective with distinct vocal personalities, Enter the Wu-Tang cinematic martial arts imagery, dense storytelling, street philosophy and Eastern wisdom blend, Shaolin mythology, chess and street knowledge lyricism"},

{name:"Taylor Swift",genre:"Pop",bpm:"90-120",mood:["storytelling","confessional","cinematic"],
blueprint:"100 BPM singer-songwriter pop, acoustic guitar and piano foundation evolving to full band production, intimate confessional diary-entry lyricism, vivid narrative storytelling with Easter egg details, Folklore and Evermore indie-folk atmospheric arrangements, 1989 synth-pop production, Midnights dark pop electronics, Aaron Dessner and Jack Antonoff production aesthetics, emotional bridge payoff"},

{name:"Olivia Rodrigo",genre:"Pop",bpm:"90-155",mood:["raw","emotional","pop-punk"],
blueprint:"130 BPM pop-punk inspired production, SOUR distorted electric guitar power chords, emotional teenage heartbreak lyricism, GUTS album louder more complex arrangements, punchy drums with attitude, piano-led ballad moments contrasted with angry punk energy, raw unpolished vocal authenticity, Gen Z generational heartbreak voice"},

{name:"Billie Eilish",genre:"Pop",bpm:"70-110",mood:["dark","intimate","minimalist"],
blueprint:"78 BPM dark minimalist pop, extreme close-mic ASMR vocal whispering, sparse bass and finger snaps, WHEN WE ALL FALL ASLEEP WHERE DO WE GO production by Finneas, sub-bass frequency emphasis, sinister emotional undercurrent, minimal production allowing vocal texture to dominate, claustrophobic atmospheric production"},

{name:"Dua Lipa",genre:"Pop",bpm:"110-126",mood:["disco","confident","dance-pop"],
blueprint:"118 BPM nu-disco and dance-pop, Future Nostalgia Bee Gees and ABBA influence, four-on-the-floor kick with disco cowbell, funky bass guitar groove, bright sparkling synths and string sections, powerful confident vocal with range showcasing, Levitating infectious optimism, retro-future production aesthetic, Studio 54 elegance meets modern polish"},

{name:"The Weeknd",genre:"Pop",bpm:"90-110",mood:["dark","cinematic","80s-influenced"],
blueprint:"100 BPM dark R&B pop, Blinding Lights retro-80s synths, four-on-the-floor with gated reverb snare, After Hours cinematic noir atmosphere, falsetto emotional delivery over lush production, dark romantic themes about love addiction and self-destruction, synth arpeggios and pad textures, Abel Tesfaye trilogy raw aesthetic to polished Starboy production"},

{name:"Harry Styles",genre:"Pop",bpm:"100-126",mood:["retro","rock-influenced","charismatic"],
blueprint:"110 BPM classic rock-influenced indie pop, Harry's House Joni Mitchell and Fleetwood Mac influence, Watermelon Sugar funky bass and rhythmic guitar, As It Was pulsing synth-pop, layered harmonies and backing vocals, vintage analog tape saturation, joyful confident delivery, fashion-forward artistic identity, Fine Line wide sonic palette"},

{name:"Ariana Grande",genre:"Pop",bpm:"90-130",mood:["powerful","R&B-influenced","vocal"],
blueprint:"110 BPM R&B-influenced pop, four-octave soprano range with melismatic vocal runs, thank u next production polish, 7 rings trap-pop hybrid beat, positions smooth trap-influenced production, Max Martin and Tommy Brown production aesthetics, thick vocal harmony stacks, emotional vulnerability in slow songs contrasted with confident power vocals"},

{name:"Justin Bieber",genre:"Pop",bpm:"85-120",mood:["smooth","R&B-pop","emotional"],
blueprint:"95 BPM R&B-influenced pop, Justice album 70s soul influence, Peaches warm texture, smooth vocal delivery with falsetto, Changes trap-influenced R&B production, dance-pop crossover accessibility, Purpose Where Are U Now Jack U electronic collaboration, confessional relationship themes"},

{name:"Ed Sheeran",genre:"Pop",bpm:"80-130",mood:["acoustic","storytelling","loop-based"],
blueprint:"95 BPM singer-songwriter pop, loop pedal acoustic guitar layering technique live, Shape of You tropical pop marimba groove, Perfect orchestral romantic ballad, Bad Habits vampire imagery synth-pop, emotional confessional lyricism, warm intimate voice, wide sonic range"},

{name:"Doja Cat",genre:"Pop",bpm:"90-120",mood:["versatile","playful","genre-blending"],
blueprint:"105 BPM genre-blending pop, Say So Nu-Disco funky bass, Planet Her futuristic R&B-pop, viral TikTok energy, confident sexuality and humor in lyrics, trap-pop creativity, internet culture absurdism to Grammy-winning polish, infectious melodic hooks"},

{name:"Lizzo",genre:"Pop",bpm:"95-125",mood:["empowering","soul","joyful"],
blueprint:"110 BPM soul-influenced pop, Truth Hurts flute sample, Juice 70s funk groove, About Damn Time disco funk revival production, powerful gospel-influenced vocal belting, body-positive empowerment themes, Special album full band soul production, flute performance as signature instrument, joyful celebratory energy"},

{name:"Charlie Puth",genre:"Pop",bpm:"90-116",mood:["melodic","production-focused","romantic"],
blueprint:"100 BPM production-forward pop, Attention guitar-funk groove, Light Switch bass-drop pop moment, precise vocal pitch and harmonic sensitivity, music theory-focused production with circle-of-fifths movement, self-produced intimate studio aesthetic"},

{name:"Sabrina Carpenter",genre:"Pop",bpm:"88-120",mood:["witty","confident","retro-pop"],
blueprint:"100 BPM retro-influenced pop, Short n Sweet bubblegum and early 2000s production, Espresso effortlessly cool bossa-nova influenced pop, Please Please Please romantic tension, clever witty lyrics with double meanings, airy soprano vocal with breathy texture, Jack Antonoff production collaboration"},

{name:"Beyoncé",genre:"Pop",bpm:"85-125",mood:["powerful","artistic","genre-spanning"],
blueprint:"105 BPM genre-spanning pop, Lemonade political Southern Gothic soul, RENAISSANCE club and ballroom house, Crazy in Love big brass horn energy, visual album cinematic scope, powerful mezzo-soprano vocal control, Halo orchestral ballad production, intricate choreography-designed rhythms"},

{name:"Michael Jackson",genre:"Pop",bpm:"95-118",mood:["iconic","funk-pop","timeless"],
blueprint:"108 BPM funk-pop, Thriller Quincy Jones orchestral production, Billie Jean memorable isolated bass groove, Beat It Eddie Van Halen guitar solo, Off The Wall disco-funk groove, Dangerous Teddy Riley New Jack Swing influence, intricate vocal layering and beatboxing, timeless production spanning disco through new jack swing"},

{name:"Adele",genre:"Pop",bpm:"65-95",mood:["powerful","orchestral","emotional"],
blueprint:"75 BPM orchestral soul-pop, Someone Like You solo piano and string arrangement, Rolling in the Deep bluesy guitar groove, Hello cinematic Greg Kurstin production, Easy On Me stripped piano vulnerability, mezzo-soprano powerhouse vocal with devastating emotional control, British soulfulness, Paul Epworth production collaboration"},

{name:"Bruno Mars",genre:"Pop",bpm:"95-125",mood:["funk","retro","versatile"],
blueprint:"108 BPM funk and soul-influenced pop, 24K Magic 80s electro-funk production, Uptown Funk Mark Ronson vintage funk horn section, Treasure 70s pop-funk bass groove, When I Was Your Man solo piano heartbreak, Silk Sonic Leave the Door Open 70s soul duet with Anderson .Paak, crisp live drum feel, honeyed falsetto and chest voice range"},

{name:"Selena Gomez",genre:"Pop",bpm:"88-115",mood:["dreamy","R&B-influenced","introspective"],
blueprint:"96 BPM synth-pop and R&B-influenced pop, Rare album production warmth, Lose You to Love Me devastating piano ballad, Feel Me atmospheric synth texture, breezy light soprano delivery with emotional intimacy, mental health awareness themes"},

{name:"Rihanna",genre:"Pop",bpm:"88-122",mood:["global","R&B-pop","iconic"],
blueprint:"100 BPM R&B-pop and dancehall, Umbrella production with Timbaland, We Found Love Calvin Harris euphoric electronic production, Work Afro-Caribbean dancehall groove, Diamonds Sia-written orchestral synth-pop, Barbadian Caribbean rhythmic influence, powerful raspy vocal over polished pop production"},

{name:"Katy Perry",genre:"Pop",bpm:"115-130",mood:["anthemic","colorful","bubblegum"],
blueprint:"120 BPM Max Martin-produced pop anthems, Teenage Dream bright synth chords and four-on-the-floor, Roar empowerment stomp, Dark Horse trap-influenced pop, Firework orchestral build-to-drop, primary-color bubblegum aesthetic, powerful belting vocal, sugary infectious melodic hooks"},

{name:"Lady Gaga",genre:"Pop",bpm:"116-132",mood:["theatrical","dance-pop","art-pop"],
blueprint:"124 BPM art-pop and electropop, Bad Romance RedOne production with complex chord changes, Born This Way Springsteen-influenced rock-pop, Joanne stripped acoustic country-pop era, Chromatica dance-pop Bloodpop collaboration, mezzo-soprano theatrical operatic range, Little Monsters performance artist identity"},

{name:"Sam Smith",genre:"Pop",bpm:"68-108",mood:["emotional","ballad","soulful"],
blueprint:"80 BPM orchestral soul-pop, In the Lonely Hour piano and string arrangements, Stay With Me gospel choir build, Unholy Kim Petras dark pop collaboration, countertenor vocal range with emotional vulnerability, confessional heartbreak and longing themes"},

{name:"Shawn Mendes",genre:"Pop",bpm:"88-115",mood:["acoustic","romantic","vulnerable"],
blueprint:"96 BPM acoustic guitar-pop, Stitches guitar-driven emotional ballad, There's Nothing Holdin' Me Back Pharrell production upbeat groove, In My Blood raw emotional rock-pop, acoustic fingerpicking as songwriting foundation, warm tenor vocal with honest vulnerability"},

{name:"Halsey",genre:"Pop",bpm:"90-125",mood:["alternative-pop","dark","emotional"],
blueprint:"105 BPM alternative pop, Badlands concept album atmospheric electronic production, Without Me dark R&B-pop, If I Can't Have Love I Want Power Trent Reznor Nine Inch Nails industrial collaboration, emotional turmoil and mental health themes, loud-quiet-loud dynamic"},

{name:"Camila Cabello",genre:"Pop",bpm:"88-118",mood:["Latin-influenced","romantic","powerful"],
blueprint:"100 BPM Latin-pop crossover, Havana Pharrell Williams production with Cuban music sample, Señorita shimmering intimate pop duet, Don't Go Yet Celia Cruz tribute, Romance album Latin influence, powerful belting soprano vocal, Cuban-American heritage in production and lyricism"},

{name:"Demi Lovato",genre:"Pop",bpm:"90-118",mood:["powerful","rock-influenced","emotional"],
blueprint:"100 BPM pop-rock, Confident rock guitar-driven empowerment, Cool for the Summer dark pop, Sorry Not Sorry funk-influenced pop, Stone Cold devastating piano ballad, powerful mezzo-soprano rock vocal, confessional mental health and addiction themes"},

{name:"Surfaces",genre:"Pop",bpm:"85-105",mood:["feel-good","indie-pop","sunny"],
blueprint:"92 BPM feel-good indie pop, Sunday Best positive affirmations acoustic production, Wave acoustic guitar and tropical influences, warm optimistic lyrics about joy and gratitude, gentle tenor delivery, lo-fi aesthetic with professional polish, sun-soaked Californian sound"},

{name:"Conan Gray",genre:"Pop",bpm:"90-118",mood:["indie-pop","emotional","storytelling"],
blueprint:"100 BPM indie pop, Kid Krow bedroom pop production with Max Martin influence, Heather devastating nostalgic storytelling, Maniac quirky storytelling, Found Heaven album more ambitious production scale, confessional lyricism about unrequited love and youth"},

{name:"SZA",genre:"R&B",bpm:"72-100",mood:["vulnerable","alternative R&B","introspective"],
blueprint:"84 BPM alternative R&B, Ctrl organic guitar textures and live-feel production, SOS album more polished commercial scope, Kill Bill revenge fantasy with guitar-pop edge, Good Days dreamy lo-fi atmospheric production, warm intimate vocal with jazz inflection, honest exploration of insecurity and desire"},

{name:"Frank Ocean",genre:"R&B",bpm:"65-96",mood:["introspective","experimental","literary"],
blueprint:"78 BPM experimental R&B, Channel Orange lush live instrumentation, Blonde largely stripped-back production, Thinking Bout You delicate piano and falsetto, Pyramids epic nine-minute suite, Nights beat-switch moment, literary stream-of-consciousness lyricism, self-produced intimacy and studio perfectionism"},

{name:"H.E.R.",genre:"R&B",bpm:"68-96",mood:["soulful","guitar-led","introspective"],
blueprint:"80 BPM neo-soul influenced R&B, I Used to Know Her guitar-led intimate production, Focus slow-burn R&B groove, powerful mezzo-soprano with melismatic gospel runs, Raphael Saadiq production collaboration, social justice themes, I Can't Breathe activism"},

{name:"Bryson Tiller",genre:"R&B",bpm:"74-92",mood:["trap-soul","intimate","Louisville"],
blueprint:"82 BPM trap-soul, minimal trap percussion under warm R&B harmony, Exchange slow-burn intimate guitar ballad, sung-rap vocal hybrid with intimate conversational delivery, dark vulnerable late-night mood, self-recorded bedroom aesthetic, Louisville Kentucky come-up story"},

{name:"Summer Walker",genre:"R&B",bpm:"68-90",mood:["raw","sultry","Atlanta"],
blueprint:"76 BPM contemporary R&B, Over It debut massive commercial success, Still Over It devastatingly honest breakup album, No Love dark intimate production, raspy sultry vocal delivery, Atlanta R&B scene, ultra-personal unfiltered diary-entry lyricism, London On Da Track production collaboration"},

{name:"Jhene Aiko",genre:"R&B",bpm:"60-85",mood:["ethereal","healing","spiritual"],
blueprint:"70 BPM alternative R&B, Chilombo crystal bowl meditation sound design, None of Your Concern Big Sean collaboration, Magic Hour spiritual love themes, Trip psychedelic concept album, wispy ethereal vocal float, Buddhist and healing spirituality, LA beach city atmosphere"},

{name:"Daniel Caesar",genre:"R&B",bpm:"68-92",mood:["soulful","spiritual","Toronto"],
blueprint:"78 BPM neo-soul, Freudian guitar-led debut album, Best Part H.E.R. collaboration, Church organic warmth, Toronto worship recording aesthetic, gospel choir influence, warm guitar and piano instrumentation, spiritual love and devotion themes, buttery warm vocal texture"},

{name:"Brent Faiyaz",genre:"R&B",bpm:"68-88",mood:["melancholy","underground","sensual"],
blueprint:"76 BPM alternative R&B, Wasteland cinematic dark R&B production, Sonder collective creative partnership, Wasting Time Drake collaboration, narcissistic toxic love narrative self-awareness, sultry baritone vocal with distinctive gritty rasp, dark bedroom production aesthetic, DMV area Maryland sound"},

{name:"Alicia Keys",genre:"R&B",bpm:"70-100",mood:["piano-led","powerful","New York"],
blueprint:"85 BPM neo-soul piano-pop, If I Ain't Got You soulful jazz chord piano ballad, Fallin gospel-influenced emotional progression, Girl on Fire empowerment anthem, Empire State of Mind Jay-Z New York anthem, powerful mezzo-soprano with gospel Baptist church training, classically trained piano technique"},

{name:"Usher",genre:"R&B",bpm:"88-115",mood:["smooth","R&B-pop","Atlanta"],
blueprint:"96 BPM contemporary R&B-pop, Confessions Lil Jon crunk-R&B, Yeah club anthem, Burn mid-tempo heartbreak ballad, crisp choreography-designed rhythmic grooves, silky tenor vocal with falsetto, Atlanta come-up story, dance performance integral to sound identity"},

{name:"Chris Brown",genre:"R&B",bpm:"88-115",mood:["dance-pop","smooth","versatile"],
blueprint:"100 BPM contemporary R&B-dance, With You romantic mid-tempo ballad, No Guidance Drake collaboration Afrobeats influence, smooth tenor vocal over trap-R&B production, choreography-integrated groove rhythms"},

{name:"Kehlani",genre:"R&B",bpm:"72-95",mood:["emotional","Oakland","alternative R&B"],
blueprint:"82 BPM alternative R&B, It Was Good Until It Wasn't mature complex emotions, Blue Water Road spiritual second album, Oakland Bay Area energy, powerful vulnerable soprano with raspy chest notes, LGBTQ+ identity, SAIL concept album growth"},

{name:"Lucky Daye",genre:"R&B",bpm:"72-96",mood:["neo-soul","polished","New Orleans"],
blueprint:"82 BPM neo-soul and traditional R&B, Table for Two debut Neo-soul orchestration, Candydrip lush Neptunes-influenced production, four-octave tenor range, Grammy-winning production polish, New Orleans musicality in phrasing, classic neo-soul warm analog R&B influence"},

{name:"Jazmine Sullivan",genre:"R&B",bpm:"68-92",mood:["powerful","soulful","Philadelphia"],
blueprint:"78 BPM neo-soul, Heaux Tales short story concept album, Pick Up Your Feelings empowerment, Bust Your Windows early hit, powerful mezzo-soprano with gospel-trained vocal runs, Philadelphia soul tradition, honest unapologetic female perspective"},

{name:"6LACK",genre:"R&B",bpm:"65-88",mood:["melancholy","dark R&B","Atlanta"],
blueprint:"74 BPM dark R&B, FREE 6LACK debut atmospheric intimacy, East Atlanta Love Letter vulnerability, airy falsetto with dark trap production underneath, Atlanta moody emotional narrative, minimal sparse production with emotional weight"},

{name:"Khalid",genre:"R&B",bpm:"75-100",mood:["youthful","atmospheric","El Paso"],
blueprint:"86 BPM alternative R&B-pop, American Teen coming-of-age debut, Location breakthrough single dreamy synth-pop production, warm youthful baritone with emotional accessibility, El Paso Texas suburban teen perspective, social anxiety and connection themes"},

{name:"Victoria Monét",genre:"R&B",bpm:"80-108",mood:["funk","confident","Sacramento"],
blueprint:"95 BPM funk-influenced R&B, On My Mama empowerment anthem funk groove, Alright celebratory groove, Smoke Grammy debut recognition, smooth confident mezzo-soprano vocal, co-writing credits for Ariana Grande, funk bass and disco influence, sensual confident themes"},

{name:"Teyana Taylor",genre:"R&B",bpm:"80-105",mood:["raw","Harlem","vintage soul"],
blueprint:"90 BPM raw soulful R&B, KTSE Kanye West produced EP, vintage soul production, Rose in Harlem heartfelt dedication, Harlem New York identity, raspy powerful alto vocal, vintage soul and neo-soul influence"},

{name:"Giveon",genre:"R&B",bpm:"60-82",mood:["deep baritone","heartbreak","Long Beach"],
blueprint:"70 BPM soulful R&B, HEARTBREAK ANNIVERSARY devastating breakup ballad, Peaches Justin Bieber collaboration, deep resonant bass-baritone vocal reminiscent of Lou Rawls and Barry White, Long Beach California soul tradition, orchestral string production, emotional devastation as primary artistic statement"},

{name:"Omar Apollo",genre:"R&B",bpm:"70-98",mood:["indie R&B","Mexican-American","introspective"],
blueprint:"82 BPM indie R&B, Ivory debut album genre-spanning from soul to rock, Evergreen heartbreak indie pop, warm tenor vocal, guitar player songwriter, alternative R&B with rock and pop influence, introspective gay identity themes"},

{name:"Snoh Aalegra",genre:"R&B",bpm:"68-88",mood:["neo-soul","Swedish","intimate"],
blueprint:"76 BPM neo-soul influenced R&B, FEELS debut Swedish soul, UGH THOSE FEELS AGAIN mature second album, I Want You Around smooth groove, Swedish-Iranian heritage, smooth warm contralto vocal, Minneapolis Sound funk influence meets Swedish soul"},

{name:"Daft Punk",genre:"Electronic",bpm:"95-128",mood:["disco","futuristic","French"],
blueprint:"118 BPM French house and electro, Around the World hypnotic repetitive filter-house groove, One More Time euphoric vocal house anthem, Get Lucky Nile Rodgers disco guitar collaboration, Random Access Memories live musician sessions blending disco and electronic, vocoder robot voice as artistic signature, Discovery album peak dancefloor bliss"},

{name:"Flume",genre:"Electronic",bpm:"130-145",mood:["future bass","Australian","emotional"],
blueprint:"138 BPM future bass and electronic, Never Be Like You Kai collaboration, Skin album broken beat experimentation, Hi This Is Flume mixtape glitchy exploration, pitched-up vocal chops over wide reverb-soaked synths, Melbourne Australia electronic scene, emotional contrast between harsh digital and warm melodic elements"},

{name:"Four Tet",genre:"Electronic",bpm:"120-140",mood:["folktronica","ambient-dance","cerebral"],
blueprint:"130 BPM folktronica and electronic, Rounds classic organic acoustic sample manipulation, There Is Love in You techno-influenced club direction, acoustic instrument deconstruction through electronics, cerebral emotional warmth, live improvised DJ sets"},

{name:"Skrillex",genre:"Electronic",bpm:"135-175",mood:["dubstep","aggressive","Los Angeles"],
blueprint:"150 BPM American dubstep, Scary Monsters and Nice Sprites debut EP, Bangarang wobble bass drop, massive distorted wobble bass drops, hard-hitting percussion, high-energy festival production, OWSLA label identity, aggressive face-melting bass music"},

{name:"Bonobo",genre:"Electronic",bpm:"80-115",mood:["downtempo","organic","cinematic"],
blueprint:"95 BPM downtempo electronic, Black Sands debut cinematic jazz-electronic, Migration world music electronic fusion, Simon Green multi-instrumentalist, live band touring aesthetic, jazz piano and strings woven through electronic beats, organic human musicality"},

{name:"Moderat",genre:"Electronic",bpm:"115-135",mood:["melancholy","Berlin","techno-pop"],
blueprint:"125 BPM Berlin electronic and dark synth-pop, Bad Kingdom haunting vocal-electronic, More Love melancholy techno-pop, Apparat and Modeselektor collaboration, German Berlin electronic scene, emotional cold synthesizer production"},

{name:"Jamie xx",genre:"Electronic",bpm:"118-135",mood:["UK bass","melancholy","London"],
blueprint:"126 BPM UK bass and house, In Colour solo debut album, Loud Places melancholy club euphoria, Gosh UK rave sample euphoria, Oliver Sim Romy xx The xx collaborations, emotional dance music, UK rave and jungle influence, melancholy within joyful club setting"},

{name:"Calvin Harris",genre:"Electronic",bpm:"120-130",mood:["stadium EDM","Scottish","pop-crossover"],
blueprint:"124 BPM stadium EDM and dance-pop, Summer euphoric drop, Feel So Close piano house crossover, This Is What You Came For Rihanna collaboration, 18 Months massive commercial success, Funk Wav Bounces Vol 1 retro groove album, massive festival production scale"},

{name:"The Chainsmokers",genre:"Electronic",bpm:"120-130",mood:["pop EDM","emotional","mainstream"],
blueprint:"124 BPM pop EDM crossover, Closer Halsey collaboration stadium pop, Don't Let Me Down Daya build-and-drop, Something Just Like This Coldplay collaboration, Paris romantic EDM ballad, emotional relationship themes over massive drops"},

{name:"Marshmello",genre:"Electronic",bpm:"120-135",mood:["future bass","melodic","masked"],
blueprint:"128 BPM future bass and melodic electronic, Alone debut melodic EDM, Happier Bastille collaboration emotional, Friends Anne-Marie pop collaboration, white marshmallow helmet masked identity, joyful optimistic melodic production aesthetic"},

{name:"Diplo",genre:"Electronic",bpm:"100-135",mood:["global bass","Major Lazer","eclectic"],
blueprint:"118 BPM global bass and world music electronic, Major Lazer Lean On massive global hit, Cold Water Justin Bieber collaboration, baile funk and dancehall global influences, Mad Decent label eclectic approach, global music tourism aesthetic"},

{name:"Fisher",genre:"Electronic",bpm:"125-135",mood:["peak-time techno","Australian","party"],
blueprint:"130 BPM peak-time house and techno, Losing It debut massive Beatport hit, Australian accent vocal sample signature, high-energy warehouse club production, punchy four-on-the-floor kick, bass-driven functional dancefloor design"},

{name:"Fred Again",genre:"Electronic",bpm:"125-140",mood:["emotional","UK rave","collage"],
blueprint:"132 BPM UK bass and emotional rave music, Actual Life series field recording vocal samples, UK rave culture documentation, found vocal sample collage technique, UK rave live performance energy, emotional euphoria aesthetic, generative ambient mentorship"},

{name:"Disclosure",genre:"Electronic",bpm:"120-128",mood:["UK garage","house","smooth"],
blueprint:"124 BPM UK garage and deep house, Latch Sam Smith collaboration debut breakthrough, Settle debut album UK house, Guy and Howard Lawrence brothers, UK garage and house revival, smooth filtered house aesthetic"},

{name:"Kaytranada",genre:"Electronic",bpm:"88-120",mood:["future funk","Montreal","bass"],
blueprint:"100 BPM future funk and electronic soul, 99.9% debut Polaris Prize winner, Haitian-Canadian Montreal electronic scene, funky bass-driven production, R&B and electronic fusion, dancefloor soul"},

{name:"Burial",genre:"Electronic",bpm:"130-140",mood:["UK garage","dark","anonymous"],
blueprint:"135 BPM UK garage and grime, Untrue debut masterpiece, Archangel melancholy vocal sample, South London night bus atmosphere, anonymous identity concealment, crackle vinyl texture as production choice, fragmented R&B vocal samples, nocturnal London street sound"},

{name:"Tame Impala",genre:"Rock",bpm:"92-118",mood:["psychedelic","dreamy","Australian"],
blueprint:"104 BPM psychedelic rock and synth-pop, Currents album major synth pivot from guitar-rock, Innerspeaker hazy guitar-psych debut, Let It Happen eight-minute electronic journey, The Less I Know the Better funky bass groove, Kevin Parker self-produced, thick reverb and chorus guitar textures, vintage synthesizer pads, introspective isolation themes"},

{name:"Cage the Elephant",genre:"Rock",bpm:"105-130",mood:["indie rock","energetic","Kentucky"],
blueprint:"118 BPM indie rock, Shake Me Down debut breakthrough, Ain't No Rest for the Wicked, Cigarette Daydreams emotional indie, Matt Shultz theatrical frontman energy, Bowling Green Kentucky background, raw energetic guitar riffs"},

{name:"Coldplay",genre:"Rock",bpm:"88-120",mood:["anthemic","atmospheric","British"],
blueprint:"100 BPM anthemic British rock, Yellow debut gentle guitar picking, The Scientist piano ballad, Fix You organ-to-stadium moment, Viva la Vida orchestral baroque pop string production, A Sky Full of Stars Avicii collaboration, Music of the Spheres electronic experimentation, Chris Martin piano-centered songwriting"},

{name:"The 1975",genre:"Rock",bpm:"90-120",mood:["indie pop-rock","British","self-referential"],
blueprint:"105 BPM British indie pop-rock, The 1975 debut synth-driven, I Love It When You Sleep album, A Brief Inquiry into Online Relationships experimental concept, Somebody Else lonely synth-pop, Matty Healy theatrical frontman persona, Manchester UK scene, ironic postmodern self-aware lyricism"},

{name:"Imagine Dragons",genre:"Rock",bpm:"90-120",mood:["arena rock","anthemic","Las Vegas"],
blueprint:"108 BPM arena rock and pop-rock, Radioactive debut stomp anthem, Demons emotional piano-rock, Believer percussion-forward, Dan Reynolds powerful baritone rock vocal, Las Vegas Nevada stadium rock, big production drums and synth layers"},

{name:"Twenty One Pilots",genre:"Rock",bpm:"95-140",mood:["genre-blending","emotional","Ohio"],
blueprint:"115 BPM genre-blending alternative, Stressed Out nostalgic ukulele-rap-pop, Ride carefree reggae-pop, Heathens Suicide Squad collaboration, Tyler Joseph and Josh Dun duo, Columbus Ohio background, rap verses and melodic sung choruses, emotional mental health themes"},

{name:"Foo Fighters",genre:"Rock",bpm:"110-140",mood:["grunge-influenced","anthemic","stadium"],
blueprint:"124 BPM post-grunge rock, Best of You stadium anthem power chords, Everlong emotional alternative rock guitar, The Pretender pounding drums and powerful riff, Dave Grohl post-Nirvana project, massive stadium rock production, emotional peak performance"},

{name:"Arctic Monkeys",genre:"Rock",bpm:"100-145",mood:["British indie","storytelling","Sheffield"],
blueprint:"118 BPM Sheffield indie rock, Whatever People Say I Am debut fastest-selling UK album, Do I Wanna Know slow blues-rock riff, 505 romantic closer, Alex Turner literary wordsmith frontman, AM album late-night groove, Tranquility Base Hotel Casino art-rock evolution"},

{name:"Nirvana",genre:"Rock",bpm:"95-145",mood:["grunge","raw","Seattle"],
blueprint:"120 BPM Seattle grunge, Smells Like Teen Spirit loud-quiet-loud dynamic, Come as You Are clean verse to distorted chorus, Heart-Shaped Box dark heavy riff, Nevermind Butch Vig production polish over raw punk energy, Unplugged in New York acoustic devastation, Kurt Cobain songwriting genius, distorted Fender Mustang through Big Muff"},

{name:"Red Hot Chili Peppers",genre:"Rock",bpm:"100-130",mood:["funk-rock","Los Angeles","energetic"],
blueprint:"112 BPM funk-rock, Under the Bridge melancholy acoustic verse to orchestral chorus, Californication acoustic pop-rock, Give It Away slap bass funk aggression, Flea slap bass signature, John Frusciante guitar melodic lead, Anthony Kiedis rap-singing vocals, Los Angeles California lifestyle and tragedy themes"},

{name:"Jack White",genre:"Rock",bpm:"90-130",mood:["blues-rock","raw","Detroit"],
blueprint:"108 BPM blues-rock, Seven Nation Army iconic two-note bass riff with octave pedal, White Stripes red white black aesthetic, Meg White minimalist drumming, Detroit music history reverence, analog recording philosophy, raw blues-influenced guitar heroics"},

{name:"The Strokes",genre:"Rock",bpm:"115-145",mood:["New York indie","cool","garage rock"],
blueprint:"128 BPM New York garage rock revival, Is This It debut album raw coolness, Last Nite overdriven guitar interlock, Julian Casablancas detached cool vocal, Albert Hammond Jr and Nick Valensi guitar interlock, Manhattan New York scene, intentional lo-fi production aesthetic"},

{name:"Queens of the Stone Age",genre:"Rock",bpm:"110-145",mood:["desert rock","heavy","Josh Homme"],
blueprint:"128 BPM desert rock and heavy rock, No One Knows Dave Grohl drumming, Go with the Flow hypnotic riff, Songs for the Deaf concept album, Josh Homme baritone rock voice and guitar, Palm Desert California scene, heavy groove over melody"},

{name:"Muse",genre:"Rock",bpm:"95-145",mood:["space rock","orchestral","Teignmouth"],
blueprint:"118 BPM progressive space rock, Supermassive Black Hole funky rock radio, Knights of Cydonia spaghetti western epic, Uprising dystopian synth-rock anthem, Matt Bellamy virtuoso guitar and piano, Devon Teignmouth UK origins, orchestral over-the-top production"},

{name:"The Black Keys",genre:"Rock",bpm:"90-120",mood:["blues-rock","Ohio","raw"],
blueprint:"106 BPM blues-rock duo, Lonely Boy hard-driving groove, Tighten Up El Camino breakthrough, Gold on the Ceiling fuzzed guitar stomp, Dan Auerbach slide guitar and vocals, Patrick Carney drumming, Akron Ohio industrial blues, raw two-piece power"},

{name:"Paramore",genre:"Rock",bpm:"115-155",mood:["pop-punk","alternative","Nashville"],
blueprint:"135 BPM pop-punk and alternative rock, Misery Business debut high-energy riff, Still Into You feel-good indie pop pivot, Hayley Williams powerful soprano punk vocal, Franklin Tennessee background, After Laughter New Wave synth-pop evolution, This Is Why post-punk revival"},

{name:"Led Zeppelin",genre:"Classic Rock",bpm:"80-135",mood:["heavy rock","blues","epic"],
blueprint:"110 BPM British heavy rock and blues-rock, Whole Lotta Love heavy riff with theremin break, Stairway to Heaven acoustic to electric epic build, Kashmir middle-eastern influenced riff, Jimmy Page layered guitar production, Robert Plant wailing blues tenor, John Bonham thunderous live drumming, John Paul Jones versatile bass and keys"},

{name:"Pink Floyd",genre:"Classic Rock",bpm:"60-120",mood:["progressive","atmospheric","psychedelic"],
blueprint:"90 BPM progressive rock and psychedelia, Dark Side of the Moon concept album sonic journey, Wish You Were Here acoustic melancholy, Comfortably Numb David Gilmour guitar solo peak, Roger Waters conceptual bass and songwriting, Syd Barrett early psychedelia, emotional alienation themes, Animals and Animals experimental eras"},

{name:"The Beatles",genre:"Classic Rock",bpm:"100-160",mood:["melodic","innovative","British Invasion"],
blueprint:"130 BPM British Invasion pop and rock, Love Me Do early Merseybeat energy, A Day in the Life Sgt Pepper avant-garde, Come Together bluesy swagger, Yesterday acoustic melancholy Paul McCartney, Lennon-McCartney songwriting partnership peak, George Martin production collaboration, psychedelic Revolver era"},

{name:"The Rolling Stones",genre:"Classic Rock",bpm:"100-140",mood:["blues rock","swagger","British"],
blueprint:"115 BPM British blues rock, Gimme Shelter dark apocalyptic groove, Satisfaction fuzz guitar iconic riff, Sympathy for the Devil samba percussion, Keith Richards open G guitar tuning style, Mick Jagger theatrical frontman energy, Charlie Watts jazz-influenced drumming, Exile on Main St roots blues recording"},

{name:"Bob Dylan",genre:"Classic Rock",bpm:"75-120",mood:["folk rock","protest","literary"],
blueprint:"95 BPM folk and rock, Blowin in the Wind acoustic protest, Like a Rolling Stone electric pivot, Mr Tambourine Man poetic imagery, Highway 61 Revisited electric rock, Nobel Prize literature wordsmith, nasal stream-of-consciousness vocal delivery"},

{name:"Elton John",genre:"Classic Rock",bpm:"88-130",mood:["piano rock","flamboyant","British"],
blueprint:"106 BPM piano-driven rock and pop, Crocodile Rock early boogie piano rock, Tiny Dancer Bernie Taupin lyrical collaboration, Rocket Man piano ballad space imagery, Your Song intimate debut, Saturday Night's Alright Fighting glam rock energy, spectacular theatrical stage presence"},

{name:"Tom Petty",genre:"Classic Rock",bpm:"100-130",mood:["heartland rock","jangly","American"],
blueprint:"112 BPM American heartland rock, Free Fallin acoustic Southern California, American Girl jangly Rickenbacker guitar, Learning to Fly uplifting rock anthem, I Won't Back Down defiant folk-rock, Traveling Wilburys supergroup collaboration, working-class American storytelling"},

{name:"The Who",genre:"Classic Rock",bpm:"110-155",mood:["hard rock","theatrical","British"],
blueprint:"130 BPM British hard rock and mod, My Generation youth anthem, Baba O Riley synthesizer intro anthem, Pinball Wizard Tommy rock opera, Pete Townshend windmill power chords, Keith Moon explosive chaotic drumming, Roger Daltrey leather fringed showmanship, rock opera theatrical ambition"},

{name:"Fleetwood Mac",genre:"Classic Rock",bpm:"88-118",mood:["soft rock","drama","California"],
blueprint:"100 BPM California soft rock and pop-rock, Go Your Own Way Lindsey Buckingham guitar crunch, The Chain iconic bass descending break, Dreams Stevie Nicks ethereal vocal, Gold Dust Woman cocaine and witchcraft imagery, Rumours Buckingham-Nicks romantic drama, Christine McVie keyboard pop"},

{name:"Queen",genre:"Classic Rock",bpm:"100-145",mood:["operatic","epic","theatrical"],
blueprint:"120 BPM operatic rock, Bohemian Rhapsody six-minute operatic suite, We Will Rock You percussive stomp anthem, Don't Stop Me Now euphoric piano rock, Freddie Mercury four-octave tenor showman, Brian May Red Special guitar, multi-layered vocal harmonies, News of the World arena rock peak"},

{name:"David Bowie",genre:"Classic Rock",bpm:"88-130",mood:["glam rock","art rock","chameleon"],
blueprint:"108 BPM glam rock to art rock to soul, Ziggy Stardust alien glam rock character, Heroes Berlin krautrock Berlin-era ambient art rock production, Let's Dance disco funk guitar, Space Oddity acoustic folk to orchestral, Blackstar jazz-influenced final album, constant character and genre evolution"},

{name:"Bruce Springsteen",genre:"Classic Rock",bpm:"95-130",mood:["heartland rock","storytelling","New Jersey"],
blueprint:"110 BPM heartland rock and Americana, Born to Run Phil Spector wall-of-sound ambition, Born in the USA anthemic drums and synth, Nebraska acoustic lo-fi storytelling, E Street Band horn section and piano, Clarence Clemons saxophone, Asbury Park New Jersey working-class mythology"},

{name:"Morgan Wallen",genre:"Country",bpm:"88-116",mood:["country-pop","stadium","Tennessee"],
blueprint:"100 BPM contemporary country-pop, Dangerous The Double Album massive commercial success, Wasted on You emotional ballad, Last Night cross-genre pop moment, One Thing at a Time album depth, Tennessee roots, warm gravelly vocal, banjo and acoustic guitar over modern production"},

{name:"Luke Combs",genre:"Country",bpm:"90-114",mood:["traditional country","blue-collar","North Carolina"],
blueprint:"100 BPM traditional-leaning country, Beautiful Crazy chart-topping ballad, When It Rains It Pours drinking country humor, Beer Never Broke My Heart honky-tonk party, Fast Car Tracy Chapman cover crossover, Asheville North Carolina roots, working-class relatable perspective, warm approachable baritone, live band production with steel guitar and fiddle"},

{name:"Zach Bryan",genre:"Country",bpm:"82-115",mood:["Americana","raw","Oklahoma"],
blueprint:"96 BPM Americana and folk-influenced country, American Heartbreak debut major album, Something in the Orange golden hour heartbreak, I Remember Everything Kacey Musgraves collaboration, Oklahoma Navy veteran roots, raw unpolished lo-fi recording aesthetic, simple acoustic guitar honesty, heartfelt honest storytelling"},

{name:"Lainey Wilson",genre:"Country",bpm:"88-114",mood:["bell bottom country","Louisiana","retro"],
blueprint:"100 BPM bell bottom country and classic country influence, Things a Man Oughta Know breakthrough, Heart Like a Truck empowerment, Watermelon Moonshine nostalgic imagery, Louisiana small town roots, wide-leg bell bottom fashion identity, powerful raspy alto vocal, classic 70s country influence"},

{name:"Chris Stapleton",genre:"Country",bpm:"78-108",mood:["country-blues","raw","Kentucky"],
blueprint:"90 BPM country-blues and soul, Tennessee Whiskey George Jones cover remake, Broken Halos gospel country, Starting Over redemption album, Either Way devastating heartbreak, Kentucky roots, massive powerful baritone with gritty soul influence, SteelDrivers bluegrass band background"},

{name:"Kacey Musgraves",genre:"Country",bpm:"78-112",mood:["cosmic country","pop-influenced","Texas"],
blueprint:"92 BPM cosmic country and pop-country, Golden Hour intimate pop-country peak, Rainbow coming-out emotional, Follow Your Arrow progressive outlaw country, Star-Crossed divorce concept album, Austin Texas roots, LGBTQ+ inclusive themes in country, soft warm soprano, country-pop genre barrier dissolution"},

{name:"Tyler Childers",genre:"Country",bpm:"82-108",mood:["Appalachian","outlaw","Kentucky"],
blueprint:"92 BPM Appalachian country and folk, Purgatory debut David Ferguson Sturgill Simpson production, Feathered Indians debut intimate fiddle and guitar, Eastern Kentucky Lawrence County roots, raw unpolished voice with mountain authenticity, outlaw country tradition, land and labor working-class lyricism"},

{name:"Willie Nelson",genre:"Country",bpm:"80-115",mood:["outlaw country","jazz-influenced","Texas"],
blueprint:"95 BPM outlaw country and jazz-influenced, On the Road Again eternal touring anthem, Blue Eyes Crying in the Rain tender ballad, Always on My Mind love regret, Trigger worn nylon-string guitar iconic tone, Nashville outlaw movement founder, jazz phrasing in country vocal"},

{name:"Garth Brooks",genre:"Country",bpm:"95-120",mood:["stadium country","theatrical","Oklahoma"],
blueprint:"108 BPM arena country, Friends in Low Places sing-along anthem, The Dance career-making video, Thunder Rolls dark narrative, Stillwater Oklahoma roots, theatrical live shows, KISS and Bob Seger rock influence on country production"},

{name:"Dolly Parton",genre:"Country",bpm:"88-120",mood:["classic Nashville","iconic","Tennessee"],
blueprint:"100 BPM classic Nashville country, Jolene jealousy narrative guitar picking, I Will Always Love You original, 9 to 5 working women anthem banjo and sass, Coat of Many Colors poverty memoir, Tennessee mountain home roots, high lonesome soprano with Appalachian twang"},

{name:"Johnny Cash",genre:"Country",bpm:"85-115",mood:["outlaw","darkness","Arkansas"],
blueprint:"96 BPM outlaw country and rockabilly, Ring of Fire mariachi horns June Carter collaboration, Man in Black social protest, Hurt Nine Inch Nails cover devastating final statement, Folsom Prison Blues prison narrative, I Walk the Line devotion, dark baritone boom-chicka-boom rhythm guitar"},

{name:"Miranda Lambert",genre:"Country",bpm:"90-118",mood:["Texas red dirt","fierce","authentic"],
blueprint:"102 BPM Texas red dirt country, Kerosene debut raw aggression, The House That Built Me devastating memoir, Mama's Broken Heart revenge, Gunpowder and Lead ferocity, Lindale Texas roots, powerful fiery delivery, Pistol Annies supergroup"},

{name:"Zac Brown Band",genre:"Country",bpm:"88-118",mood:["country-rock","Southern","Georgia"],
blueprint:"100 BPM Southern country rock, Chicken Fried debut classic, Colder Weather sweeping ballad, Toes beach country crossover, Atlanta Georgia background, tight acoustic instrumental virtuosity, wide genre exploration from bluegrass to reggae"},

{name:"Luke Bryan",genre:"Country",bpm:"95-122",mood:["country-pop","party","Georgia"],
blueprint:"108 BPM country-pop, Country Girl Shake It For Me tailgate party, Do I Make You Wanna country-pop radio crossover, Play It Again smooth summer country, Leesburg Georgia farm roots, party country aesthetic"},

{name:"Bon Iver",genre:"Indie",bpm:"60-108",mood:["folk","experimental","Wisconsin"],
blueprint:"82 BPM folk and experimental, For Emma Forever Ago cabin isolation debut, Skinny Love falsetto vulnerability, Holocene cinematic beauty, 22 A Million deconstructed electronic experimentation, Justin Vernon auto-tuned falsetto to raw range, Eau Claire Wisconsin home recording, orchestral arrangements with lo-fi aesthetic"},

{name:"Mitski",genre:"Indie",bpm:"85-140",mood:["indie rock","intense","Japanese-American"],
blueprint:"108 BPM indie rock and art pop, Puberty 2 distorted guitar emotional rawness, Nobody disco-pop isolation, Be the Cowboy character portraits, Working for the Knife career burnout, Japanese-American bicultural experience, powerful vocal dynamics from whisper to full scream, minimalist to maximalist arrangements"},

{name:"boygenius",genre:"Indie",bpm:"80-128",mood:["indie folk","supergroup","raw"],
blueprint:"100 BPM indie folk supergroup, The Record debut album, True Blue Rolling Stones-influenced rock, Not Strong Enough melodic sadness, Emily I'm Sorry tender acoustic, Phoebe Bridgers Lucy Dacus Julien Baker trio, rawness and emotional honesty, harmonies between three distinct voices"},

{name:"Clairo",genre:"Indie",bpm:"78-108",mood:["bedroom pop","intimate","Boston"],
blueprint:"90 BPM bedroom pop and indie pop, Pretty Girl lo-fi YouTube bedroom video breakthrough, Immunity Rostam Batmanglij produced maturity, Sling Paul McCartney pastoral soft pop, soft breathy intimate soprano, lo-fi recording aesthetic, Massachusetts Boston roots"},

{name:"The National",genre:"Indie",bpm:"82-118",mood:["art rock","literary","Cincinnati"],
blueprint:"96 BPM art rock and chamber pop, Bloodbuzz Ohio driving guitar and horn, About Today devastating closing track, I Need My Girl quiet devastation, First Two Pages of Frankenstein late career triumph, Matt Berninger baritone literary vocals, Aaron and Bryce Dessner guitar arrangements"},

{name:"Weyes Blood",genre:"Indie",bpm:"62-96",mood:["baroque pop","cinematic","California"],
blueprint:"80 BPM baroque pop and art folk, Titanic Rising cinema and climate anxiety, Before the Goodbye melancholy beauty, And in the Darkness Hearts Aglow second part, Natalie Mering mezzo-soprano operatic voice, 70s Carole King and Karen Carpenter influence, cinematic orchestral string production"},

{name:"Sufjan Stevens",genre:"Indie",bpm:"65-108",mood:["chamber folk","orchestral","literary"],
blueprint:"85 BPM chamber folk and orchestral pop, Illinois concept album state mythology, Chicago anthemic closer, Carrie and Lowell grief memoir sparse acoustic, The Age of Adz electronic maximalism, multi-instrumentalist orchestration, Christian faith themes"},

{name:"Fleet Foxes",genre:"Indie",bpm:"72-108",mood:["baroque folk","harmonies","Seattle"],
blueprint:"88 BPM baroque folk, lush multi-part vocal harmonies over acoustic guitar, Seattle Washington roots, Appalachian folk and Renaissance choral influence, dense vocal round arrangements, pastoral baroque folk"},

{name:"Mac DeMarco",genre:"Indie",bpm:"80-112",mood:["jangle pop","lo-fi","Canadian"],
blueprint:"96 BPM jangle pop and slacker rock, Salad Days tape-saturated jangle, Ode to Viceroy cigarette homage, Chamber of Reflection meditative slowed, Edmonton Alberta Canadian roots, cigarette and goofy humor persona, four-track recording bedroom aesthetic"},

{name:"Soccer Mommy",genre:"Indie",bpm:"88-118",mood:["indie rock","confessional","Nashville"],
blueprint:"100 BPM indie rock and bedroom pop, Clean debut album vulnerable intimacy, Color Theory illness and depression themes, Sometimes Forever shoegaze influence, Sophie Allison confessional lyricism, Nashville Tennessee background, guitar-driven indie with emotional rawness"},

{name:"Big Thief",genre:"Indie",bpm:"80-115",mood:["folk rock","raw","Brooklyn"],
blueprint:"95 BPM folk rock and indie, Masterpiece debut raw acoustic, U.F.O.F. delicate ethereal, Two Hands raw power, Dragon New Warm Mountain I Believe In You double album range, Adrianne Lenker primary songwriter and vocalist, Buck Meek guitar interplay, rural countryside imagery"},

{name:"Alvvays",genre:"Indie",bpm:"105-140",mood:["shoegaze","dream-pop","Toronto"],
blueprint:"120 BPM dream-pop and indie pop, Alvvays debut Marry Me in the Bathroom jangly, Blue Rev aggressive shoegaze breakthrough, Molly Rankin Toronto Canadian roots, bright melodic guitar hooks under layers of reverb and chorus, Beach Boys harmonic sensibility through shoegaze filter"},

{name:"Hozier",genre:"Indie",bpm:"80-120",mood:["blues-influenced","Irish","spiritual"],
blueprint:"96 BPM blues-influenced indie rock, Take Me to Church debut hymn, Work Song Delta blues influence, Cherry Wine acoustic folk ballad, Unreal Unearth Dante's Inferno concept album, Wicklow Ireland roots, gravelly powerful baritone with soul gospel influence"},

{name:"Vance Joy",genre:"Indie",bpm:"88-118",mood:["indie-folk-pop","Australian","acoustic"],
blueprint:"100 BPM indie folk pop, Riptide breakthrough ukulele and acoustic, Lay It on Me tender guitar pop, Fire and the Flood acoustic emotion, James Keogh Melbourne Australia, warm approachable tenor, ukulele as signature instrument"},

{name:"Vampire Weekend",genre:"Indie",bpm:"105-135",mood:["baroque pop","prep","New York"],
blueprint:"118 BPM indie pop and baroque pop, A-Punk speed and energy, Oxford Comma pretension satire, Harmony Hall Father of the Bride comeback, Columbia University prep aesthetic, Afrobeats rhythm influence from Paul Simon Graceland, Cape Cod Kwassa Kwassa African guitar, Ezra Koenig intellectual lyricist"},

{name:"Phoebe Bridgers",genre:"Folk",bpm:"72-108",mood:["indie folk","dark","Los Angeles"],
blueprint:"85 BPM indie folk and chamber pop, Funeral sparse devastation, Motion Sickness distorted guitar breakup, Garden Song dreamy morning, Punisher album peak, Los Angeles California roots, soft haunting soprano delivery, death and depression themes wrapped in beauty"},

{name:"Iron & Wine",genre:"Folk",bpm:"68-95",mood:["folk","intimate","South Carolina"],
blueprint:"80 BPM indie folk, Our Endless Numbered Days lush development, Naked As We Came tender death meditation, Flightless Bird American wedding staple, Sam Beam hushed close-mic vocal texture, Biblical imagery and Southern Gothic, whispered intimacy as performance style"},

{name:"Gregory Alan Isakov",genre:"Folk",bpm:"75-105",mood:["folk","Colorado","celestial"],
blueprint:"88 BPM folk and Americana, The Stable Song night sky imagery, Big Black Car wanderlust, South Africa Johannesburg born Boulder Colorado adopted home, warm gentle baritone, astronomy and nature imagery, Colorado mountain community"},

{name:"Caamp",genre:"Folk",bpm:"78-108",mood:["folk","Ohio","heartfelt"],
blueprint:"90 BPM folk and Americana, Peach Fuzz gentle warmth, By and By honest simplicity, Tailspin quiet beauty, Taylor Meier and Evan Westfall duo, Athens Ohio University Town roots, warm accessible honest baritone, simple unadorned acoustic guitar, Midwest earnest sensibility"},

{name:"Noah Kahan",genre:"Folk",bpm:"88-120",mood:["folk-pop","Vermont","emotional"],
blueprint:"100 BPM folk-pop, Stick Season Vermont autumn melancholy, Northern Attitude Canada cold metaphor, Dial Drunk Post Malone collaboration, Peacham Vermont rural roots, warm earnest baritone with New England geography specificity, rural isolation and growth themes"},

{name:"Joni Mitchell",genre:"Folk",bpm:"72-110",mood:["folk","artistic","Canadian"],
blueprint:"88 BPM folk and jazz-influenced, Big Yellow Taxi environmental, Both Sides Now philosophical wonder, A Case of You tender devotion, Blue album intimate confessional masterpiece, Fort Macleod Alberta Canada roots, open guitar tunings dozens unique, jazz harmony sophistication in folk, court and spark LA pop peak"},

{name:"Bad Bunny",genre:"Latin",bpm:"80-130",mood:["reggaeton","trap latino","Puerto Rico"],
blueprint:"96 BPM reggaeton and Latin trap, YHLQMDLG iconic dembow-trap album, Callaita trap romantic, Tití Me Preguntó dancehall influence, Un Verano Sin Ti reggaeton and surf rock fusion, nasal baritone trap delivery, Puerto Rican cultural pride, genre-bending from reggaeton to bolero to punk"},

{name:"J Balvin",genre:"Latin",bpm:"92-110",mood:["reggaeton","global","Colombia"],
blueprint:"100 BPM reggaeton, Mi Gente global anthem Willy William sample, Rojo album color-themed, Medellín Colombia roots, melodic sing-song reggaeton flow, crossover with electronic music, visual album artistry"},

{name:"Daddy Yankee",genre:"Latin",bpm:"95-115",mood:["reggaeton","pioneer","Puerto Rico"],
blueprint:"105 BPM reggaeton founding father, Gasolina 2004 debut global breakout, Despacito Luis Fonsi remix record-breaking, Barrio Fino debut album, San Juan Puerto Rico Santurce origins, King of Reggaeton legendary status, dembow rhythm pioneer"},

{name:"Ozuna",genre:"Latin",bpm:"88-108",mood:["smooth reggaeton","trap latino","Puerto Rico"],
blueprint:"96 BPM reggaeton and Latin trap, ODISEA debut record-breaking streams, Taki Taki DJ Snake collaboration, smooth romantic reggaeton vocal, melodic sensitive flow, social media streaming record holder"},

{name:"Karol G",genre:"Latin",bpm:"90-115",mood:["reggaeton","empowerment","Colombia"],
blueprint:"100 BPM reggaeton and Latin pop, Bichota empowerment anthem, Provenza emotional maturity, Tusa Nicki Minaj collaboration, Mañana Será Bonito all-female producer album, Medellín Colombia roots, powerful soprano with reggaeton attitude, feminist empowerment themes"},

{name:"Shakira",genre:"Latin",bpm:"90-120",mood:["Latin pop","dance","Barranquilla"],
blueprint:"105 BPM Latin pop and Middle Eastern fusion, Whenever Wherever global debut English crossover, Hips Don't Lie Wyclef Jean collaboration, Barranquilla Colombia Lebanese heritage belly dance moves, raspy uniquely textured soprano, Colombian vallenato and Middle Eastern fusion signature"},

{name:"Maluma",genre:"Latin",bpm:"92-112",mood:["reggaeton","smooth","Medellín"],
blueprint:"100 BPM reggaeton and Latin pop, Hawái heartbreak ballad, Felices los 4 hit, Medellín Colombia luxury lifestyle, smooth tenor reggaeton vocal, romantic and sensual themes"},

{name:"Rosalía",genre:"Latin",bpm:"80-130",mood:["flamenco","avant-garde","Barcelona"],
blueprint:"100 BPM flamenco and experimental pop, El Mal Querer flamenco concept album, Con Altura J Balvin collaboration, MOTOMAMI reggaeton-flamenco-electronic fusion, Barcelona Catalonia roots, traditional flamenco training transformed through modern production, percussive vocal technique"},

{name:"Becky G",genre:"Latin",bpm:"95-118",mood:["reggaeton","pop latina","Los Angeles"],
blueprint:"105 BPM reggaeton and Latin pop, Shower English-language debut, Mayores Bad Bunny collaboration, Sin Pijama Natti Natasha female empowerment, Inglewood California Latinx heritage, code-switching English-Spanish bilingual delivery, youthful confident energy"},

{name:"Lunay",genre:"Latin",bpm:"92-108",mood:["R&B Latino","smooth","Puerto Rico"],
blueprint:"98 BPM R&B-influenced reggaeton, Soltera smooth Latin groove, Multitudes debut album, smooth R&B vocal sensibility applied to Latin urban"},

{name:"Myke Towers",genre:"Latin",bpm:"88-112",mood:["trap latino","versatile","Puerto Rico"],
blueprint:"98 BPM Latin trap and reggaeton, Easy Money Baby debut commercial breakthrough, Patek deep Latin trap, versatile vocal range from trap to romantic, LYKE MIKE album range"},

{name:"Metallica",genre:"Metal",bpm:"138-200",mood:["thrash metal","heavy","San Francisco"],
blueprint:"168 BPM thrash metal, Master of Puppets iconic palm-muted galloping riff, Enter Sandman accessible Black Album, One epic eight-minute suite, Battery aggressive opener, James Hetfield down-picked rhythm guitar and bark vocal, Kirk Hammett melodic lead guitar and wah-wah solos, Lars Ulrich drumming, Bay Area thrash scene founders"},

{name:"Black Sabbath",genre:"Metal",bpm:"70-135",mood:["heavy metal","dark","Birmingham"],
blueprint:"105 BPM heavy metal founders, Black Sabbath tritone devil interval riff, Iron Man iconic riff, War Pigs anti-Vietnam protest, Ozzy Osbourne dark imagery vocal, Tony Iommi missing fingertips slide guitar innovation, Birmingham UK factory town darkness, occult and darkness imagery originators"},

{name:"Tool",genre:"Metal",bpm:"75-150",mood:["progressive metal","complex","Los Angeles"],
blueprint:"110 BPM progressive metal, Schism odd time signatures 5/4 and 7/8, Sober dark emotional, Lateralus Fibonacci sequence concept, Fear Inoculum 10-year comeback, Maynard James Keenan theatrical distant vocal, Adam Jones guitar mastery, Danny Carey polyrhythmic drumming, Jungian psychological themes"},

{name:"Slayer",genre:"Metal",bpm:"165-240",mood:["thrash metal","aggressive","Los Angeles"],
blueprint:"200 BPM thrash metal extremity, Raining Blood iconic intro riff, Reign in Blood 28-minute masterpiece, Tom Araya speed bass and screaming vocal, Kerry King and Jeff Hanneman dual guitar attack, Dave Lombardo double-kick drumming, satanic and war imagery provocation"},

{name:"Iron Maiden",genre:"Metal",bpm:"115-175",mood:["heavy metal","epic","London"],
blueprint:"145 BPM classic heavy metal, The Trooper galloping bass intro, Run to the Hills Native American narrative, Bruce Dickinson operatic tenor power, Steve Harris galloping bass guitar signature, twin guitar harmonies Dave Murray and Adrian Smith, New Wave of British Heavy Metal pioneers, historical literary lyrical themes"},

{name:"Pantera",genre:"Metal",bpm:"120-180",mood:["groove metal","aggressive","Dallas"],
blueprint:"148 BPM groove metal, Walk groove riff powerhouse, Cowboys from Hell crossover breakthrough, Dimebag Darrell guitar virtuosity, Philip Anselmo aggressive southern bark, Vinnie Paul drumming brother, Dallas Texas, Far Beyond Driven brutal experimentation"},

{name:"Mastodon",genre:"Metal",bpm:"105-165",mood:["progressive metal","Atlanta","concept"],
blueprint:"130 BPM progressive sludge metal, Leviathan Moby Dick concept album, Blood Mountain mythology, Crack the Skye astral projection concept, Emperor of Sand cancer concept album, Troy Sanders Brent Hinds dual vocal, Brann Dailor technical drumming"},

{name:"Ghost",genre:"Metal",bpm:"100-140",mood:["theatrical heavy metal","Swedish","catchy"],
blueprint:"115 BPM theatrical heavy metal and rock, Cirice single stage breakthrough, Rats Black Plague narrative, Square Hammer catchy hard rock, Dance Macabre 80s synth influence, Tobias Forge Papa Emeritus masked identity, accessible melodic heavy metal, Catholic church imagery satire"},

{name:"Judas Priest",genre:"Metal",bpm:"110-175",mood:["heavy metal","leather","Birmingham"],
blueprint:"140 BPM classic heavy metal, Breaking the Law iconic riff, Living After Midnight rock anthem, You've Got Another Thing Coming accessible crossover, Painkiller speed metal peak, Rob Halford leather biker imagery, Glenn Tipton and KK Downing twin guitar harmony"},

{name:"Miles Davis",genre:"Jazz",bpm:"85-240",mood:["jazz","innovation","Missouri"],
blueprint:"160 BPM bebop to cool jazz to fusion, Kind of Blue modal jazz masterpiece, All Blues 6/8 groove, Bitches Brew jazz-rock fusion electric period, Birth of the Cool cooler arrangements, muted Harmon mute trumpet tone intimacy, constant musical evolution across five decades, Teo Macero studio production innovation"},

{name:"John Coltrane",genre:"Jazz",bpm:"130-300",mood:["jazz","spiritual","North Carolina"],
blueprint:"200 BPM bebop to free jazz, A Love Supreme devotional four-part suite, My Favorite Things soprano saxophone transformation, Giant Steps rapid chord changes, Impressions modal meditation, spiritual and mystical themes in later work, Elvin Jones and McCoy Tyner quartet chemistry"},

{name:"Kamasi Washington",genre:"Jazz",bpm:"75-145",mood:["contemporary jazz","spiritual","Los Angeles"],
blueprint:"105 BPM contemporary jazz and spiritual jazz, The Epic triple album debut massive scope, Kendrick Lamar and Flying Lotus collaboration, Los Angeles California band scene, Thundercat and Terrace Martin connections, sweeping ensemble arrangements with hip-hop production values, social justice themes"},

{name:"Thelonious Monk",genre:"Jazz",bpm:"120-220",mood:["bebop","angular","New York"],
blueprint:"175 BPM bebop and jazz, Straight No Chaser angular melody, Round Midnight jazz standard beauty, Blue Monk blues-jazz piano, completely idiosyncratic piano style with unusual note choices and rhythmic displacement, iconic porkpie hat"},

{name:"Bill Evans",genre:"Jazz",bpm:"65-170",mood:["jazz piano","lyrical","New Jersey"],
blueprint:"100 BPM lyrical jazz piano, Waltz for Debby intimate trio, Peace Piece meditative left hand, Blue in Green Miles Davis Kind of Blue contributor, impressionistic harmonic voicings, interplay between piano and bass as conversation, Scott LaFaro and Eddie Gomez bass chemistry, introspective melancholy beauty"},

{name:"Herbie Hancock",genre:"Jazz",bpm:"80-155",mood:["jazz","funk","Chicago"],
blueprint:"105 BPM jazz and jazz-funk, Head Hunters electric funk jazz fusion, Watermelon Man blues-funk original, Maiden Voyage acoustic jazz beauty, Chicago Illinois roots, Miles Davis Second Great Quintet member, Rockit hip-hop inspired Grammy, synthesizer and electronic innovation in jazz"},

{name:"Ella Fitzgerald",genre:"Jazz",bpm:"88-200",mood:["jazz vocals","scat","New York"],
blueprint:"140 BPM jazz vocal and swing, Summertime Gershwin Songbook interpretation, How High the Moon scat improvisation, A-Tisket A-Tasket swing hit, three-octave soprano range, perfect pitch and rhythmic precision, First Lady of Song, Chick Webb Orchestra discovery"},

{name:"B.B. King",genre:"Blues",bpm:"88-126",mood:["electric blues","guitar","Mississippi"],
blueprint:"105 BPM electric blues, The Thrill Is Gone minor key signature, Lucille personified guitar, fluid single-note lead lines with signature vibrato, no slide but finger vibrato technique, smooth sophisticated vocal phrasing, Itta Bena Mississippi roots"},

{name:"Robert Johnson",genre:"Blues",bpm:"90-160",mood:["Delta blues","raw","Mississippi"],
blueprint:"118 BPM Delta blues, Cross Road Blues supernatural mythology, Sweet Home Chicago classic, Hellhound on My Trail pursued by darkness, Hazlehurst Mississippi roots, open guitar tuning and bottleneck slide, hypnotic walking bass thumb and melody finger independence, mysterious crossroads mythology"},

{name:"Muddy Waters",genre:"Blues",bpm:"92-120",mood:["Chicago blues","electric","Mississippi"],
blueprint:"104 BPM Chicago electric blues, Hoochie Coochie Man Willie Dixon written, Got My Mojo Working crowd call, Mannish Boy masculine bravado, Clarksdale Mississippi Delta roots, electric slide guitar amplified Chicago style, Chess Records electric urban blues"},

{name:"Stevie Ray Vaughan",genre:"Blues",bpm:"100-145",mood:["Texas blues","guitar","Austin"],
blueprint:"118 BPM Texas blues rock, Pride and Joy swaggering shuffle, Texas Flood emotional depth, Voodoo Child Jimi Hendrix tribute, Dallas Texas Oak Cliff neighborhood, heavy .013 guitar strings for thick tone, Dumble amp and Tube Screamer signature setup"},

{name:"Gary Clark Jr.",genre:"Blues",bpm:"95-140",mood:["modern blues","Austin","rock-influenced"],
blueprint:"115 BPM modern blues rock, Bright Lights Austin Texas debut, Numb Boogie grinding groove, Pearl Cadillac epic retro blues, This Land political protest, Austin Texas sixth street music scene, Gibson ES-335 semi-hollow body tone"},

{name:"Etta James",genre:"Blues",bpm:"75-120",mood:["soul blues","powerful","Los Angeles"],
blueprint:"95 BPM soul blues, At Last romantic standard, I'd Rather Go Blind devastating heartbreak, Tell Mama deep soul plea, powerful contralto with gospel ornamentation, Chess Records Atlantic Records career, civil rights era Black music history"},

{name:"Stevie Wonder",genre:"Soul",bpm:"85-120",mood:["Motown","funk-soul","Michigan"],
blueprint:"100 BPM Motown and funk-soul, Superstition synth-funk groove, Isn't She Lovely celebration, Higher Ground funk urgency, Songs in the Key of Life double album masterpiece, Saginaw Michigan Motown child prodigy roots, harmonica chromatic playing, early synthesizer adoption"},

{name:"Otis Redding",genre:"Soul",bpm:"92-125",mood:["Memphis soul","raw","Georgia"],
blueprint:"106 BPM Memphis soul and gospel, Try a Little Tenderness slow build to explosive peak, Respect later made famous by a soul legend, Sitting on the Dock of the Bay posthumous hit, Dawson Georgia roots, raw gospel-trained raspy tenor, Stax Records classic soul backing band"},

{name:"Ray Charles",genre:"Soul",bpm:"90-125",mood:["soul","gospel-fusion","Georgia"],
blueprint:"105 BPM soul and gospel fusion, Georgia on My Mind state anthem, Hit the Road Jack call-and-response, What'd I Say electric piano invented soul music, Albany Georgia roots, piano and organ foundation, Raelettes backing choir, jazz and country and gospel synthesis"},

{name:"Sam Cooke",genre:"Soul",bpm:"88-118",mood:["soul","silky","Mississippi"],
blueprint:"100 BPM soul and gospel-pop, A Change Is Gonna Come civil rights anthem with orchestral strings, You Send Me romantic debut hit, Chain Gang social commentary, Clarksdale Mississippi Chicago roots, perfectly controlled smooth lyric tenor, founded modern soul vocal style, SAR Records label owner"},

{name:"Marvin Gaye",genre:"Soul",bpm:"78-118",mood:["soul","sensual","Washington DC"],
blueprint:"96 BPM soul and funk, What's Going On political concept album orchestral, Let's Get It On sensual groove, Sexual Healing electronic R&B late period, Washington DC roots, silky romantic baritone to falsetto, Motown background with Tammi Terrell duets"},

{name:"Curtis Mayfield",genre:"Soul",bpm:"85-118",mood:["soul","funk","Chicago"],
blueprint:"100 BPM Chicago soul and funk, Superfly blaxploitation soundtrack wah-wah funk, Move On Up euphoric groove, People Get Ready gospel-folk hymn, Chicago North Side roots, falsetto tenor over wah-wah guitar, Impressions gospel vocal group background, social justice consciousness"},

{name:"Bob Marley",genre:"Reggae",bpm:"75-90",mood:["roots reggae","Rastafari","Jamaica"],
blueprint:"80 BPM roots reggae, No Woman No Cry live one-drop groove, Redemption Song solo acoustic, Three Little Birds positive vibration, Trenchtown Kingston Jamaica Nine Mile roots, classic one-drop drum pattern, offbeat guitar skank, organ bubble, Rastafari spiritual and political consciousness"},

{name:"Sean Paul",genre:"Reggae",bpm:"95-112",mood:["dancehall","global","Jamaica"],
blueprint:"104 BPM dancehall, Temperature global anthem, Get Busy club floor filler, Kingston Jamaica roots, rapid-fire patois dancehall deejaying, crossover pop accessibility, Dutty Rock debut global breakthrough, Grammy-winning mainstream reggae-pop bridge"},

{name:"Peter Tosh",genre:"Reggae",bpm:"76-92",mood:["roots reggae","militant","Jamaica"],
blueprint:"82 BPM roots reggae, Legalize It cannabis decriminalization demand, Equal Rights militant political album, Westmoreland Jamaica rural roots, tougher more militant tone than Marley, equal rights and justice themes, Wailers founding member"},

{name:"Damian Marley",genre:"Reggae",bpm:"80-100",mood:["contemporary reggae","rap-reggae","Jamaica"],
blueprint:"90 BPM contemporary reggae and hip-hop crossover, Welcome to Jamrock Kingston reality, Road to Zion Nas collaboration, Kingston Jamaica roots, Junior Gong nickname, rapid-fire deejay flow over reggae rhythms, Distant Relatives album with Nas"},

{name:"Chronixx",genre:"Reggae",bpm:"78-96",mood:["roots reggae","revival","Jamaica"],
blueprint:"86 BPM roots reggae revival, Capture Land roots anthem, Smile Jamaica feel-good roots, Kingston Jamaica roots reggae revival movement, clear tenor vocal with roots one-drop rhythms, reggae revival movement with Protoje"},

{name:"James Brown",genre:"Funk",bpm:"96-130",mood:["funk","soul","Georgia"],
blueprint:"112 BPM funk, Sex Machine on-the-one groove, I Got You I Feel Good energy, Papa's Got a Brand New Bag soul pivot, Augusta Georgia roots, Godfather of Soul Hardest Working Man titles, JBs backing band, the one emphasis revolutionary"},

{name:"Prince",genre:"Funk",bpm:"92-128",mood:["funk","Minneapolis Sound","genius"],
blueprint:"108 BPM Minneapolis Sound funk, Purple Rain rock ballad guitar solo peak, When Doves Cry no bass unique production, Kiss funk minimalism, Minneapolis Minnesota roots, multi-instrumentalist played all instruments, Paisley Park studio, sexual liberation and spirituality themes, gender-fluid fashion pioneer"},

{name:"Parliament-Funkadelic",genre:"Funk",bpm:"95-120",mood:["P-Funk","cosmic","Detroit"],
blueprint:"108 BPM P-Funk, Flash Light bass synth riff, One Nation Under a Groove, Mothership Connection George Clinton cosmic mythology, Detroit and New Jersey roots, Bootsy Collins Maceo Parker Bernie Worrell massive collective, Afrofuturist mythology and humor"},

{name:"Sly & The Family Stone",genre:"Funk",bpm:"92-118",mood:["funk-rock","San Francisco","integrated"],
blueprint:"104 BPM funk-rock, Everyday People integration anthem, Thank You Falettinme Be Mice Elf Agin bass groove, There's a Riot Goin On dark deconstruction, Sly Stone leader multi-instrumentalist, racially integrated mixed-gender band, San Francisco Bay Area psychedelic soul"},

{name:"Bootsy Collins",genre:"Funk",bpm:"88-115",mood:["funk bass","cosmic","Cincinnati"],
blueprint:"100 BPM funk bass, Bootzilla character, Stretchin Out in Bootsy's Rubber Band debut, Cincinnati Ohio roots, star-shaped bass guitar signature, James Brown JBs bassist before Parliament, rhinestone star-shaped glasses theatrical aesthetic"},

{name:"Aretha Franklin",genre:"Gospel",bpm:"88-120",mood:["soul-gospel","powerful","Detroit"],
blueprint:"100 BPM soul and gospel, Respect feminist anthem definitive recording, Amazing Grace live gospel album, Think freedom demand, Natural Woman Carole King song made definitive, Detroit Michigan New Bethel Baptist Church piano prodigy, mezzo-soprano to full contralto power, Queen of Soul title"},

{name:"Kirk Franklin",genre:"Gospel",bpm:"95-125",mood:["contemporary gospel","hip-hop influenced","Fort Worth"],
blueprint:"110 BPM contemporary gospel with hip-hop production, Stomp God's Property featuring Salt-N-Pepa, Brighter Day anthemic choir, I Smile celebration of life, Fort Worth Texas foster care upbringing, choir conductor and producer, urban contemporary gospel fusion"},

{name:"CeCe Winans",genre:"Gospel",bpm:"82-108",mood:["gospel","traditional","Detroit"],
blueprint:"94 BPM traditional gospel and contemporary gospel, Alabaster Box tender devotion, Throne Room intimate worship, Detroit Michigan Winans gospel family dynasty, warm mezzo-soprano with gospel ornament runs, traditional to contemporary gospel balance"},

{name:"Tasha Cobbs Leonard",genre:"Gospel",bpm:"82-112",mood:["gospel","worship","Georgia"],
blueprint:"96 BPM contemporary worship and gospel, Break Every Chain powerful declaration, For Your Glory vulnerable surrender, You Know My Name intimate trust, Jesup Georgia small town roots, powerful soprano that grows into full belting, Grammy winning worship leader"},

{name:"Maverick City Music",genre:"Gospel",bpm:"70-108",mood:["contemporary worship","diverse","Atlanta"],
blueprint:"88 BPM contemporary worship collective, Jireh Elevation Worship collaboration massive, Man of Your Word devotion, Promises featuring Joe L Barnes, Atlanta Georgia collective of diverse songwriters, rotating lead vocalists approach, multicultural inclusive worship aesthetic"},

{name:"BTS",genre:"K-Pop",bpm:"90-140",mood:["K-pop","global","Big Hit"],
blueprint:"115 BPM polished K-pop, Dynamite English-language disco-pop, Butter smooth funk-pop, DNA synth-pop, Boy With Luv Halsey collaboration, ARMY fandom co-creation, HYBE label, seven-member group distinct vocal rapper dancer roles, Love Yourself thematic series, social messaging and mental health themes"},

{name:"BLACKPINK",genre:"K-Pop",bpm:"108-138",mood:["K-pop","girl crush","YG"],
blueprint:"122 BPM K-pop girl group, How You Like That powerful comeback, Kill This Love intense drop, Boombayah debut explosive energy, DDU-DU DDU-DU record-breaking, YG Entertainment, Jennie Lisa Jisoo Rosé four distinct personas, Coachella headliners, girl crush fierce aesthetic"},

{name:"NewJeans",genre:"K-Pop",bpm:"98-130",mood:["K-pop","Y2K","ADOR"],
blueprint:"112 BPM Y2K-influenced K-pop, Hype Boy driving debut, Attention cool understated, OMG bubblegum acceleration, Super Shy bright summery pop, ADOR label Min Hee-jin creative director, retro Y2K early 2000s aesthetic reinvention, minimalist authentic styling"},

{name:"TWICE",genre:"K-Pop",bpm:"105-135",mood:["K-pop","cheerful","JYP"],
blueprint:"118 BPM upbeat K-pop, TT iconic point choreography, Fancy more mature concept, Cheer Up debut cheerful energy, JYP Entertainment, nine-member group with three Japanese members, Feel Special emotional maturity"},

{name:"aespa",genre:"K-Pop",bpm:"105-145",mood:["K-pop","metaverse","SM"],
blueprint:"125 BPM futuristic K-pop, Black Mamba debut intense conceptual, Next Level speed acceleration drop, Savage confident girl crush, SM Entertainment metaverse concept, four-member group with digital avatar ae-counterparts, Navis AI character lore, kwangya fictional universe world-building"},

{name:"EXO",genre:"K-Pop",bpm:"108-138",mood:["K-pop","vocal","SM"],
blueprint:"122 BPM polished K-pop, Growl smooth R&B-influenced, Overdose intense concept, Power disco-influenced celebration, SM Entertainment, twelve-member group split Korea China, Chen powerful tenor, universe mythology concept"},

{name:"Monsta X",genre:"K-Pop",bpm:"105-145",mood:["K-pop","powerful","Starship"],
blueprint:"128 BPM powerful K-pop, Dramarama intense electro-pop, Hero anthemic debut, Love Killa dark concept, Starship Entertainment, seven to six member group, powerful performance-focused reputation, heavy electronic production"},

{name:"Stray Kids",genre:"K-Pop",bpm:"108-155",mood:["K-pop","self-produced","JYP"],
blueprint:"135 BPM intense K-pop, God's Menu bold debut, Thunderous epic orchestral, MIROH confident, JYP Entertainment self-produced group, Bang Chan Han Changbin 3RACHA production unit writes and produces own music, noisy intense concept"},

{name:"IVE",genre:"K-Pop",bpm:"105-135",mood:["K-pop","concept","Starship"],
blueprint:"118 BPM concept K-pop, ELEVEN debut explosive impact, Love Dive narcissism concept, After Like Carly Rae Jepsen sample, I Am confident self-love, Starship Entertainment, six-member group Jang Wonyoung, high concept storytelling each comeback"},

{name:"Burna Boy",genre:"Afrobeats",bpm:"88-112",mood:["afro-fusion","Nigerian","global"],
blueprint:"98 BPM afro-fusion, Last Last Toni Braxton sample, Anybody danceable groove, Ye afropop anthem, Love Damini autobiographical album, Twice as Tall Grammy album, Port Harcourt Nigeria roots, Grammy-winning African Giant self-title, afrobeats to reggae to R&B genre fusion"},

{name:"Wizkid",genre:"Afrobeats",bpm:"90-112",mood:["afrobeats","Lagos","Starboy"],
blueprint:"100 BPM afrobeats, Essence Tems collaboration global crossover, Come Closer Drake feature, Ojuelegba tender Lagos prayer, Made in Lagos album peak, Surulere Lagos Nigeria roots, Starboy Records label, falsetto-inflected smooth tenor"},

{name:"Tems",genre:"Afrobeats",bpm:"78-100",mood:["afro-soul","soulful","Lagos"],
blueprint:"88 BPM afro-soul, Free Mind debut EP breakthrough, Higher Future Wizkid collaboration, Essence Wizkid feature global crossover, Lagos Nigeria Lekki roots, powerful smoky contralto unusual in afrobeats, neo-soul influence, Grammy-winning"},

{name:"Davido",genre:"Afrobeats",bpm:"92-115",mood:["afrobeats","Lagos","DMW"],
blueprint:"102 BPM afrobeats, Fall longest charting Nigerian song US Billboard, Blow My Mind Chris Brown collaboration, If massive pan-African hit, OBO nickname, Atlanta Georgia born Lagos raised, DMW Davido Music Worldwide label"},

{name:"Rema",genre:"Afrobeats",bpm:"95-115",mood:["afropop","Calm Down","Benin City"],
blueprint:"105 BPM afropop, Calm Down Selena Gomez remix global smash, Dumebi debut playful afropop, Benin City Edo State Nigeria roots, Mavin Records Don Jazzy signing, melodic light tenor over bouncy afropop rhythms, Rave and Roses album"},

{name:"Asake",genre:"Afrobeats",bpm:"92-112",mood:["amapiano-afrobeats","Fuji","Lagos"],
blueprint:"100 BPM amapiano-influenced afrobeats, Sungba Burna Boy feature, Joha fuji afrobeats fusion, Terminator danceable hit, Lagos Ojo roots, Yoruba fuji music influence on afrobeats delivery, YBNL Nation Olamide signing"},

{name:"Tiwa Savage",genre:"Afrobeats",bpm:"90-112",mood:["afropop","Queen","Lagos"],
blueprint:"100 BPM afropop, All Over dancehall-afrobeats, Somebody's Son SZA collaboration, Koroba political commentary, Lagos Isale Eko roots, London Berklee College of Music training, Mavin Records and Atlantic Records, Queen of African Pop title"},

{name:"Brian Eno",genre:"Ambient",bpm:"55-80",mood:["ambient","generative","British"],
blueprint:"65 BPM generative ambient, Music for Airports floating planes metaphor, Another Green World art rock transitional, Discreet Music system-based composition, Roxy Music glam rock keyboard origins, oblique strategies card deck compositional tool, generative systems and chance procedures, Bowie Berlin trilogy producer"},

{name:"Ólafur Arnalds",genre:"Ambient",bpm:"60-92",mood:["neo-classical","Iceland","emotional"],
blueprint:"76 BPM neo-classical ambient, re:member generative piano and strings, some kind of peace pandemic intimacy, Island Songs Iceland location recordings, Reykjavik Iceland roots, generative STRATUS software piano system, string quartet arrangements, emotional cinematic scope"},

{name:"William Basinski",genre:"Ambient",bpm:"45-70",mood:["tape loops","decay","New York"],
blueprint:"55 BPM tape loop disintegration music, Disintegration Loops 9/11 decay composition, analog tape loop deterioration as composition, watching recorded material die in real time concept, slow decay as emotional metaphor, New York Brooklyn loft studio"},

{name:"Nils Frahm",genre:"Ambient",bpm:"55-95",mood:["neo-classical","piano","Berlin"],
blueprint:"75 BPM neo-classical and electronic, All Melody Steinway and preparations, Spaces live album intimacy, Says repetitive hypnotic piano, Felt album piano felt-damped quiet, Berlin Germany roots, prepared piano technique, late-night recording sessions aesthetic"},

{name:"Aphex Twin",genre:"Ambient",bpm:"60-200",mood:["IDM","Cornwall","experimental"],
blueprint:"130 BPM IDM and ambient techno, Selected Ambient Works Volume II pure atmosphere, Come to Daddy disturbing video, Drukqs prepared piano and IDM, Richard D James Cornwall rural England roots, multiple aliases Polygon Window AFX, advanced synthesis and drum programming"},

{name:"Max Richter",genre:"Ambient",bpm:"55-88",mood:["neo-classical","SLEEP","British-German"],
blueprint:"70 BPM neo-classical, SLEEP eight-hour lullaby concert, On the Nature of Daylight cinematic standard, Recomposed Vivaldi Four Seasons deconstruction, British-German dual heritage, studying with Luciano Berio, string quartet foundation, meditation and sleep science research"},

{name:"Radiohead",genre:"Alternative",bpm:"88-145",mood:["art rock","experimental","Oxford"],
blueprint:"108 BPM art rock and experimental, Creep early alternative, OK Computer paranoid millennial anxiety, Kid A electronic deconstruction, Pyramid Song rising piano chords, Paranoid Android six-minute suite, Thom Yorke falsetto and baritone range, Jonny Greenwood guitar and orchestration, Oxford England Abingdon School"},

{name:"Portishead",genre:"Alternative",bpm:"65-100",mood:["trip-hop","cinematic","Bristol"],
blueprint:"80 BPM trip-hop, Glory Box haunting sample groove, Sour Times spy film sample, The Rip acoustic devastation, Beth Gibbons haunted noir vocal, Geoff Barrow hip-hop sampling and turntablism, Bristol trip-hop scene, orchestral James Bond score samples, dark cinematic paranoia"},

{name:"Massive Attack",genre:"Alternative",bpm:"68-108",mood:["trip-hop","Bristol","dark"],
blueprint:"85 BPM trip-hop, Teardrop Elizabeth Fraser vocal, Unfinished Sympathy orchestral soul sample, Safe from Harm debut menace, Angel slow-burning dread, Mezzanine darker third album, Blue Lines debut trip-hop foundation, Bristol Wild Bunch sound system roots"},

{name:"The Cure",genre:"Alternative",bpm:"88-140",mood:["post-punk","goth","Crawley"],
blueprint:"108 BPM post-punk and gothic rock, Boys Don't Cry new wave jangly, Lovesong tender ballad, Friday I'm in Love joyful indie, Disintegration dark synthesizer masterpiece, Robert Smith disheveled hair and lipstick iconic, Crawley West Sussex England roots, gothic rock genre definition"},

{name:"Lana Del Rey",genre:"Alternative",bpm:"60-95",mood:["baroque pop","cinematic","New York"],
blueprint:"78 BPM cinematic baroque pop, Video Games debut acoustic sadness, Born to Die orchestral melancholy, Norman Fucking Rockwell peak songwriting Jack Antonoff production, old Hollywood and Americana tragic romanticism, honey voice vintage tragedy aesthetic, Venice Beach California mythology"},

{name:"Beck",genre:"Alternative",bpm:"80-120",mood:["genre-hopping","Los Angeles","eclectic"],
blueprint:"100 BPM eclectic alternative, Loser slacker anthem lo-fi rap-folk, Where It's At two turntables and a microphone, Sea Change heartbreak acoustic folk, Morning Phase Grammy quiet beauty, Los Angeles Los Feliz roots, folk and hip-hop and country and rock genre fluid"},

{name:"Portugal. The Man",genre:"Alternative",bpm:"90-125",mood:["art rock","Alaska","psychedelic"],
blueprint:"108 BPM psychedelic art rock, Feel It Still vintage Motown groove, Purple Yellow Red and Blue melodic, Wasilla Alaska origins, prolific early career, psychedelic rock to pop crossover"},

{name:"Pop Smoke",genre:"Drill",bpm:"138-148",mood:["Brooklyn drill","deep","New York"],
blueprint:"142 BPM Brooklyn NY drill, Welcome to the Party debut infectious energy, Dior massive posthumous hit, Mood Swings deep baritone hook, Brooklyn Canarsie New York roots, gravelly deep baritone over UK drill-influenced production, 808 Melo and Rico Beats UK drill producers, posthumous Shoot for the Stars Aim for the Moon album"},

{name:"Chief Keef",genre:"Drill",bpm:"138-148",mood:["Chicago drill","pioneer","Englewood"],
blueprint:"142 BPM Chicago drill originator, I Don't Like debut viral moment, Love Sosa Englewood anthem, Finally Rich debut album, Englewood Chicago South Side roots, completely emotionless flat delivery, sparse eerie dark minor production, influenced entire generation of drill and trap artists"},

{name:"Fivio Foreign",genre:"Drill",bpm:"138-148",mood:["Brooklyn drill","energetic","Brooklyn"],
blueprint:"142 BPM Brooklyn drill, Wetty drill energy, Big Drip debut breakthrough, Brooklyn Flatbush New York roots, rapid-fire Brooklyn drill flow, dark minor key 808 Melo production"},

{name:"Lil Durk",genre:"Drill",bpm:"130-145",mood:["Chicago drill","melodic","OTF"],
blueprint:"138 BPM melodic Chicago drill, The Voice album concept, India Drake collaboration massive, Almost Healed grief processing album, Only the Family OTF label founder, Englewood Chicago roots, melodic sung hooks over drill beats, emotional vulnerability in hard drill context"},

{name:"Central Cee",genre:"Drill",bpm:"138-148",mood:["UK drill","London","global"],
blueprint:"142 BPM UK drill and afro drill, Doja viral TikTok UK drill moment, Loading debut mixtape, 23 melodic drill collaboration Dave, Shepherd's Bush West London roots, smooth flow with UK slang and road terminology, afro-drill fusion influence"},

{name:"Green Day",genre:"Punk",bpm:"155-190",mood:["pop-punk","Berkeley","arena punk"],
blueprint:"172 BPM pop-punk, Basket Case anxiety anthem, Good Riddance Time of Your Life acoustic tender, American Idiot political rock opera, Billie Joe Armstrong three-chord guitar and nasal delivery, Tré Cool drumming, Mike Dirnt bass, Berkeley California East Bay punk scene, 924 Gilman Street roots"},

{name:"Blink-182",genre:"Punk",bpm:"155-185",mood:["pop-punk","San Diego","humor"],
blueprint:"172 BPM pop-punk, All the Small Things MTV anthem, I Miss You dark piano-pop, What's My Age Again immature humor, Tom DeLonge Mark Hoppus Matt Skiba lineup changes, San Diego Poway California roots, juvenile humor and genuine emotion balance, Enema of the State peak commercial moment"},

{name:"The Clash",genre:"Punk",bpm:"130-180",mood:["punk","political","London"],
blueprint:"155 BPM British punk and reggae fusion, London Calling double album masterpiece, Should I Stay or Should I Go rockabilly swagger, Rock the Casbah danceable, Joe Strummer passionate political vocal, Mick Jones guitar melody, Paul Simonon bass reggae influence, Notting Hill London multicultural influence"},

{name:"Ramones",genre:"Punk",bpm:"160-200",mood:["punk","New York","minimalist"],
blueprint:"178 BPM proto-punk and punk rock, Blitzkrieg Bop hey ho lets go, I Wanna Be Sedated nervous breakdown, Forest Hills Queens New York roots, two-minute song format discipline, downstroke guitar only approach, leather jackets jeans sneakers uniform aesthetic, CBGB club founders"},

{name:"NOFX",genre:"Punk",bpm:"155-200",mood:["punk","skate-punk","Los Angeles"],
blueprint:"180 BPM skate punk and melodic hardcore, Linoleum skate punk energy, The Decline 18-minute punk suite, Punk in Drublic defining album, Fat Mike Fat Wreck Chords label founder, El Hefe guitar and trumpet, Los Angeles punk scene, satirical political lyrics"},

{name:"Billie Joe Armstrong",genre:"Punk",bpm:"150-185",mood:["pop-punk","Berkeley","songwriter"],
blueprint:"168 BPM pop-punk, Green Day leader songwriter, Basket Case anxiety written at 924 Gilman Street, American Idiot rock opera writer, three-chord melodic punk songwriting mastery, political and personal lyricism balance"}
];

// Sort artists alphabetically by name
ARTISTS.sort((a, b) => a.name.localeCompare(b.name));

// APP STATE
// ============================================================
let currentTab = 'artists';
let activeGenre = 'All';
let activeMood = 'All';
let favorites = new Set();
let favoritesNotes = {};     // key -> string note
let favoritesOrder = [];     // ordered array of keys (for custom sort)
let favFilterType = 'all';   // 'all' | 'artists' | 'blueprints'
let favSortMode = 'recent';  // 'recent' | 'alpha' | 'genre'
let editingNoteKey = null;
let copyCount = 0;
let generatedSongs = [];
let _sessionNonce = 0;
let selectedCount = 5;
let apiKey = '';
let openaiApiKey = '';
let geminiApiKey = '';
let selectedLLM = 'builtin';
let selectedLang = 'en';
let expandedCards = new Set();
const sessionCopyHistory = [];

// ============================================================
// INIT
// ============================================================
document.addEventListener('DOMContentLoaded', async () => {
  // Load persistent opener history so we never repeat a first line
  _sessionNonce = await loadOpenersFromStorage();

  {
    const data = {};
    try { if (localStorage.getItem("favorites")) data.favorites = JSON.parse(localStorage.getItem("favorites")); } catch(e) {}
    try { if (localStorage.getItem("copyCount")) data.copyCount = JSON.parse(localStorage.getItem("copyCount")); } catch(e) {}
    try { if (localStorage.getItem("apiKey")) data.apiKey = JSON.parse(localStorage.getItem("apiKey")); } catch(e) {}
    try { if (localStorage.getItem("openaiApiKey")) data.openaiApiKey = JSON.parse(localStorage.getItem("openaiApiKey")); } catch(e) {}
    try { if (localStorage.getItem("geminiApiKey")) data.geminiApiKey = JSON.parse(localStorage.getItem("geminiApiKey")); } catch(e) {}
    try { if (localStorage.getItem("selectedLLM")) data.selectedLLM = JSON.parse(localStorage.getItem("selectedLLM")); } catch(e) {}
    try { if (localStorage.getItem("favoritesNotes")) data.favoritesNotes = JSON.parse(localStorage.getItem("favoritesNotes")); } catch(e) {}
    try { if (localStorage.getItem("favoritesOrder")) data.favoritesOrder = JSON.parse(localStorage.getItem("favoritesOrder")); } catch(e) {}
    if (data.favorites) favorites = new Set(data.favorites);
    if (data.copyCount) { copyCount = data.copyCount; updateCopyDisplay(); }
    if (data.favoritesNotes) favoritesNotes = data.favoritesNotes;
    if (data.favoritesOrder) favoritesOrder = data.favoritesOrder;
    if (data.apiKey) apiKey = data.apiKey;
    if (data.openaiApiKey) openaiApiKey = data.openaiApiKey;
    if (data.geminiApiKey) geminiApiKey = data.geminiApiKey;
    if (data.selectedLLM) selectedLLM = data.selectedLLM;
    setupLLMSelector();
    setupLanguageSelector();
  }
  
  buildGenreSidebar();
  renderArtists();
  buildGenreBlueprints();
  setupEventListeners();
  setupRemixPanel();
  setupAnalyse();
  renderCopyHistory();
});

// ============================================================
// GENRE SIDEBAR
// ============================================================
function buildGenreSidebar() {
  rebuildGenreSidebar();
}

function rebuildGenreSidebar() {
  const isBP = currentTab === 'genres';

  // Build combined genre list (union of artist genres + bp genres)
  const artistGenres = Object.keys(GENRE_COLORS).sort();
  const bpGenres = Object.keys(GENRE_BPS).sort();
  const allGenres = isBP
    ? ['All', 'Favorites', ...bpGenres]
    : ['All', 'Favorites', ...artistGenres];

  const artistCounts = {};
  ARTISTS.forEach(a => { artistCounts[a.genre] = (artistCounts[a.genre] || 0) + 1; });

  const bpCounts = {};
  Object.entries(GENRE_BPS).forEach(([g, bps]) => { bpCounts[g] = bps.length; });

  const list = document.getElementById('genre-list');
  list.innerHTML = allGenres.map(g => {
    const color = isBP ? (GENRE_COLORS_BP[g] || '#888') : (GENRE_COLORS[g] || '#888');
    let count;
    if (g === 'All') count = isBP ? getAllBlueprints().length : ARTISTS.length;
    else if (g === 'Favorites') count = isBP
      ? [...favorites].filter(k => k.startsWith('bp:')).length
      : [...favorites].filter(k => k.startsWith('artist:')).length;
    else count = isBP ? (bpCounts[g] || 0) : (artistCounts[g] || 0);

    return `<div class="genre-pill ${g === activeGenre ? 'active' : ''}" data-genre="${g}">
      <div class="genre-dot" style="background:${color}"></div>
      <div class="genre-pill-name">${g}</div>
      <div class="genre-count">${count}</div>
    </div>`;
  }).join('');

  list.querySelectorAll('.genre-pill').forEach(pill => {
    pill.addEventListener('click', () => {
      list.querySelectorAll('.genre-pill').forEach(p => p.classList.remove('active'));
      pill.classList.add('active');
      activeGenre = pill.dataset.genre;
      if (currentTab === 'genres') renderBlueprintContent();
      else renderArtists();
    });
  });
}

// ============================================================
// RENDER ARTISTS
// ============================================================
function renderArtists() {
  const query = document.getElementById('search-input').value.toLowerCase().trim();
  let list = ARTISTS;
  
  if (activeGenre === 'Favorites') {
    list = list.filter(a => favorites.has('artist:' + a.name));
  } else if (activeGenre !== 'All') {
    list = list.filter(a => a.genre === activeGenre);
  }
  
  // Mood/vibe filter
  if (activeMood !== 'All') {
    const moodMap = {
      energetic:  ['energetic','upbeat','hype','anthemic','driving','intense','stadium','festival','power','banger','dance','electric','vibrant','explosive','fast','high energy'],
      dark:       ['dark','sinister','menacing','cold','brooding','gothic','noir','ominous','shadowy','heavy','moody','gloomy','bleak','grim'],
      romantic:   ['romantic','love','sensual','intimate','tender','lush','passionate','seductive','devotion','heartfelt','warm','soft','vulnerable'],
      spiritual:  ['spiritual','gospel','worship','faith','holy','sacred','conscious','roots','jah','god','prayer','soul','grace','divine','reverent'],
      aggressive: ['aggressive','brutal','fierce','raw','intense','rage','furious','angry','hard','thrash','mosh','breakdown','metal','hardcore','punk'],
      chill:      ['chill','lo-fi','mellow','smooth','relaxed','laid-back','ambient','dreamy','soft','slow','late night','gentle','soothing','calm','easy'],
      melancholy: ['melancholy','sad','heartbreak','lonely','longing','wistful','bittersweet','grief','loss','blue','nostalgic','aching','yearning','sorrow'],
      conscious:  ['conscious','political','activist','social','awareness','justice','truth','protest','real','introspective','storytelling','message','commentary'],
      nostalgic:  ['nostalgic','retro','vintage','throwback','classic','old school','80s','90s','2000s','golden age','era','reminiscent','timeless','tape','analog'],
      euphoric:   ['euphoric','euphoria','ecstatic','bliss','transcendent','release','festival','rave','peak','soaring','exhilarating','rush','high','elated','lifted'],
      jazzy:      ['jazz','jazzy','blues','soul','swing','bebop','improvisation','sophisticated','smoky','late night','lounge','trumpet','saxophone','piano','groove'],
      raw:        ['raw','gritty','unpolished','garage','lo-fi','diy','rough','unfiltered','live','organic','real','stripped','minimal','honest','punk','grunge'],
      triumphant: ['triumphant','victory','overcome','rise','champion','winning','achievement','proud','earned','perseverance','comeback','power','glory','conquer'],
      hype:       ['hype','hype up','turnt','lit','popping','banging','banger','crowd','energy','bounce','flex','turn up','club','party','anthem','peak energy'],
      latenight:  ['late night','midnight','2am','3am','after hours','nocturnal','night drive','insomnia','dark hours','quiet','atmospheric','introspective','moody'],
      epic:       ['epic','cinematic','orchestral','grand','sweeping','score','dramatic','film','trailer','massive','cinematic','anthem','huge','monumental','powerful'],
    };
    const keywords = moodMap[activeMood] || [];
    list = list.filter(a => {
      const searchStr = (a.mood.join(' ') + ' ' + a.blueprint + ' ' + a.genre).toLowerCase();
      return keywords.some(kw => searchStr.includes(kw));
    });
  }
  
  if (query) {
    list = list.filter(a =>
      a.name.toLowerCase().includes(query) ||
      a.genre.toLowerCase().includes(query) ||
      a.mood.some(m => m.toLowerCase().includes(query)) ||
      a.blueprint.toLowerCase().includes(query)
    );
  }
  
  const grid = document.getElementById('artist-grid');
  const empty = document.getElementById('empty-state');
  document.getElementById('artist-count-display').textContent = list.length;
  
  if (list.length === 0) {
    grid.innerHTML = '';
    empty.classList.add('visible');
    return;
  }
  empty.classList.remove('visible');
  
  grid.innerHTML = list.map((a, idx) => {
    const color = GENRE_COLORS[a.genre] || '#888';
    const initials = a.name.split(' ').map(w => w[0]).join('').substring(0, 2).toUpperCase();
    const isFav = favorites.has('artist:' + a.name);
    const isExpanded = expandedCards.has(a.name);
    const globalIdx = ARTISTS.indexOf(a);
    
    return `<div class="artist-card ${isExpanded ? 'expanded' : ''}" data-name="${a.name.replace(/'/g, '&#39;')}">
      <div class="card-header">
        <div class="card-avatar" style="background:linear-gradient(135deg,${color}44,${color}22)">${initials}</div>
        <div class="card-info">
          <div class="card-name">${a.name}</div>
          <div class="card-meta">
            <span class="card-genre" style="color:${color}">${a.genre}</span>
            <span class="card-bpm">${a.bpm} BPM</span>
          </div>
        </div>
        <div class="card-actions">
          <button class="star-btn ${isFav ? 'active' : ''}" data-idx="${globalIdx}" title="Favorite">★</button>
          <button class="expand-btn ${isExpanded ? 'open' : ''}" data-idx="${globalIdx}" title="Expand">▼</button>
        </div>
      </div>
      <div class="card-moods">${a.mood.map(m => `<span class="mood-tag">${m}</span>`).join('')}</div>
      <div class="card-peek">${a.blueprint.substring(0, 120)}${a.blueprint.length > 120 ? '…' : ''}</div>
      <button class="copy-btn" data-idx="${globalIdx}">📋 Copy Style Prompt</button>
      <button class="copy-btn artist-batch-btn" data-idx="${globalIdx}" style="background:var(--bg3);color:var(--cyan);border-color:var(--cyan)33;margin-top:4px">⚡ Batch</button>
      <div class="blueprint-wrap ${isExpanded ? 'open' : ''}">
        <div class="blueprint-label">Suno Style Blueprint</div>
        <div class="blueprint-text">${a.blueprint}</div>
      </div>
    </div>`;
  }).join('');
  
  // Event delegation for cards
  grid.querySelectorAll('.copy-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const a = ARTISTS[parseInt(btn.dataset.idx)];
      const color = GENRE_COLORS[a.genre] || '#888';
      copyToClipboard(a.blueprint, btn, `Copied style for ${a.name}`, {
        name: a.name,
        type: `${a.genre} · ${a.bpm} BPM`,
        color
      });
    });
  });
  grid.querySelectorAll('.star-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const a = ARTISTS[parseInt(btn.dataset.idx)];
      toggleFavorite(a.name, btn);
    });
  });
  grid.querySelectorAll('.artist-batch-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const a = ARTISTS[parseInt(btn.dataset.idx)];
      document.getElementById('style-prompt').value = a.blueprint;
      switchTab('batch');
      const orig = btn.textContent;
      btn.textContent = '✓ Sent!';
      btn.classList.add('copied');
      setTimeout(() => { btn.textContent = orig; btn.classList.remove('copied'); }, 1200);
    });
  });
  grid.querySelectorAll('.expand-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const a = ARTISTS[parseInt(btn.dataset.idx)];
      toggleExpand(a.name, btn);
    });
  });
}

function toggleFavorite(name, btn) {
  const key = 'artist:' + name;
  if (favorites.has(key)) { favorites.delete(key); btn.classList.remove('active'); }
  else { favorites.add(key); btn.classList.add('active'); }
  localStorage.setItem("favorites", JSON.stringify([...favorites]));
}

function toggleExpand(name, btn) {
  const card = btn.closest('.artist-card');
  const wrap = card.querySelector('.blueprint-wrap');
  if (expandedCards.has(name)) {
    expandedCards.delete(name);
    btn.classList.remove('open');
    wrap.classList.remove('open');
  } else {
    expandedCards.add(name);
    btn.classList.add('open');
    wrap.classList.add('open');
  }
}

// ============================================================
// GENRE BLUEPRINTS
// ============================================================
const GENRE_TAGLINES = {
  'Hip-Hop':    "Rhythm, wordplay, and street culture",
  'Pop':        "Hooks, polish, and emotional accessibility",
  'R&B':        "Groove, soul, and sensuality from Motown to today",
  'Electronic': "Sound design as music — Berlin to Chicago to the future",
  'Rock':       "Guitar-driven energy from garage to stadium",
  'Country':    "Fiddles, steel guitars, and honest American storytelling",
  'Latin':      "Caribbean and Latin American rhythms — passion and dance",
  'Metal':      "Maximum heaviness — doom riffs to blast beats",
  'Jazz':       "Improvisation, sophistication, and timeless feeling",
  'Indie':      "DIY spirit, emotional depth, bedroom to stage",
  'Soul':       "Black American music from the sacred to the secular",
  'Afrobeats':  "Lagos to London — rhythm, joy, and global reach",
  'Folk':       "Voice and guitar, truth and simplicity",
  'Reggae':     "Kingston Jamaica to the world — rhythm and resistance",
  'Blues':      "Call and response, human truth, the root of it all",
  'Punk':       "Fast, loud, honest — rebellion against complexity",
  'Ambient':    "Sound as environment — texture over rhythm",
  'Gospel':     "Praise, fire, and spiritual uplift",
  'K-Pop':      "Polished Korean pop — choreography meets emotion",
  'Drill':      "Cold, dark, street-level intensity",
  'Phonk':      "Memphis haunted tape culture meets modern trap",
};

function extractBPM(prompt) {
  const m = prompt.match(/(\d{2,3})\s*BPM/i);
  return m ? parseInt(m[1]) : null;
}

// Blueprint state
let activeBpMood = 'All';
let activeBpGenre = 'All';
let bpExpandedCards = new Set();
let bpSearchQuery = '';

const BP_MOOD_MAP = {
  energetic:  ['energetic','upbeat','hype','anthemic','driving','intense','stadium','festival','power','banger','dance','electric','vibrant','explosive','fast','high energy'],
  dark:       ['dark','sinister','menacing','cold','brooding','gothic','noir','ominous','shadowy','heavy','moody','gloomy','bleak','grim'],
  romantic:   ['romantic','love','sensual','intimate','tender','lush','passionate','seductive','devotion','heartfelt','warm','soft','vulnerable'],
  spiritual:  ['spiritual','gospel','worship','faith','holy','sacred','conscious','roots','jah','god','prayer','soul','grace','divine','reverent'],
  aggressive: ['aggressive','brutal','fierce','raw','intense','rage','furious','angry','hard','thrash','mosh','breakdown','metal','hardcore','punk'],
  chill:      ['chill','lo-fi','mellow','smooth','relaxed','laid-back','ambient','dreamy','soft','slow','late night','gentle','soothing','calm','easy'],
  melancholy: ['melancholy','sad','heartbreak','lonely','longing','wistful','bittersweet','grief','loss','blue','nostalgic','aching','yearning','sorrow'],
  conscious:  ['conscious','political','activist','social','awareness','justice','truth','protest','real','introspective','storytelling','message','commentary'],
  nostalgic:  ['nostalgic','retro','vintage','throwback','classic','old school','80s','90s','2000s','golden age','era','reminiscent','timeless','tape','analog'],
  euphoric:   ['euphoric','euphoria','ecstatic','bliss','transcendent','release','festival','rave','peak','soaring','exhilarating','rush','elated','lifted'],
  jazzy:      ['jazz','jazzy','blues','soul','swing','bebop','improvisation','sophisticated','smoky','late night','lounge','trumpet','saxophone','piano','groove'],
  raw:        ['raw','gritty','unpolished','garage','lo-fi','diy','rough','unfiltered','live','organic','stripped','honest','punk','grunge','tape hiss'],
  triumphant: ['triumphant','victory','overcome','rise','champion','winning','achievement','proud','earned','perseverance','comeback','power','glory','conquer'],
  hype:       ['hype','turnt','lit','popping','banging','banger','crowd','bounce','flex','turn up','club','party','anthem','peak energy','hype man'],
  latenight:  ['late night','midnight','2am','3am','after hours','nocturnal','night drive','insomnia','dark hours','quiet','atmospheric','introspective','nocturne'],
  epic:       ['epic','cinematic','orchestral','grand','sweeping','score','dramatic','film','trailer','massive','anthem','monumental','powerful','operatic'],
};

// Build a flat list of all blueprints with genre info for filtering
function getAllBlueprints() {
  const all = [];
  Object.entries(GENRE_BPS).forEach(([genre, bps]) => {
    bps.forEach((bp, idx) => {
      all.push({ ...bp, genre, origIdx: idx });
    });
  });
  return all;
}

function buildGenreBlueprints() {
  // Build sidebar genre list for blueprints (reuse artist sidebar)
  const genreList = document.getElementById('genre-list');
  const bpGenres = ['All', ...Object.keys(GENRE_BPS)];
  const allCount = getAllBlueprints().length;

  // Wire up bp mood chips (removed from UI — genre sidebar handles filtering)

  renderBlueprintContent();
}

function renderBlueprintContent() {
  const grid = document.getElementById('bp-grid');
  const empty = document.getElementById('bp-empty-state');
  const query = document.getElementById('search-input')?.value?.toLowerCase().trim() || '';

  let list = getAllBlueprints();

  // Genre filter (reuse activeGenre from artist sidebar when on bp tab)
  if (currentTab === 'genres' && activeGenre !== 'All' && activeGenre !== 'Favorites') {
    list = list.filter(bp => bp.genre === activeGenre);
  }
  if (currentTab === 'genres' && activeGenre === 'Favorites') {
    list = list.filter(bp => favorites.has(`bp:${bp.genre}:${bp.origIdx}`));
  }

  // Mood filter
  if (activeBpMood !== 'All') {
    const keywords = BP_MOOD_MAP[activeBpMood] || [];
    list = list.filter(bp => {
      const searchStr = (bp.prompt + ' ' + bp.desc + ' ' + bp.genre + ' ' + bp.name).toLowerCase();
      return keywords.some(kw => searchStr.includes(kw));
    });
  }

  // Search filter
  if (query) {
    list = list.filter(bp =>
      bp.name.toLowerCase().includes(query) ||
      bp.genre.toLowerCase().includes(query) ||
      bp.desc.toLowerCase().includes(query) ||
      bp.prompt.toLowerCase().includes(query)
    );
  }

  // Update count in header
  document.getElementById('artist-count-display').textContent = list.length;

  if (list.length === 0) {
    grid.innerHTML = '';
    empty.classList.add('visible');
    return;
  }
  empty.classList.remove('visible');

  grid.innerHTML = list.map(bp => {
    const color = GENRE_COLORS_BP[bp.genre] || '#888';
    const initials = bp.name.split(' ').map(w => w[0]).join('').substring(0, 2).toUpperCase();
    const bpm = extractBPM(bp.prompt);
    const favKey = `bp:${bp.genre}:${bp.origIdx}`;
    const isFav = favorites.has(favKey);
    const isExpanded = bpExpandedCards.has(favKey);

    return `<div class="artist-card ${isExpanded ? 'expanded' : ''}" data-bp-key="${favKey}">
      <div class="card-header">
        <div class="card-avatar" style="background:linear-gradient(135deg,${color}44,${color}22)">${initials}</div>
        <div class="card-info">
          <div class="card-name">${bp.name}</div>
          <div class="card-meta">
            <span class="card-genre" style="color:${color}">${bp.genre}</span>
            <span class="card-bpm">${bpm ? bpm + ' BPM' : '∿ BPM'}</span>
          </div>
        </div>
        <div class="card-actions">
          <button class="star-btn ${isFav ? 'active' : ''}" data-bp-key="${favKey}" title="Favorite">★</button>
          <button class="expand-btn ${isExpanded ? 'open' : ''}" data-bp-key="${favKey}" title="Expand">▼</button>
        </div>
      </div>
      <div class="card-moods"><span class="mood-tag">${bp.desc}</span></div>
      <div class="card-peek">${bp.prompt.substring(0, 120)}${bp.prompt.length > 120 ? '…' : ''}</div>
      <div class="card-actions-row">
        <button class="copy-btn bp-copy-btn" data-bp-key="${favKey}">📋 Copy Prompt</button>
        <button class="copy-btn bp-batch-btn" data-bp-key="${favKey}" style="background:var(--bg3);color:var(--cyan);border-color:var(--cyan)33">⚡ Batch</button>
      </div>
      <div class="blueprint-wrap ${isExpanded ? 'open' : ''}">
        <div class="blueprint-label">Suno Style Blueprint</div>
        <div class="blueprint-text">${bp.prompt}</div>
      </div>
    </div>`;
  }).join('');

  // Wire events
  grid.querySelectorAll('.star-btn[data-bp-key]').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const key = btn.dataset.bpKey;
      if (favorites.has(key)) { favorites.delete(key); btn.classList.remove('active'); }
      else { favorites.add(key); btn.classList.add('active'); }
      localStorage.setItem("favorites", JSON.stringify([...favorites]));
      toggleFavoriteItem(key, btn);
    });
  });

  grid.querySelectorAll('.expand-btn[data-bp-key]').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const key = btn.dataset.bpKey;
      const card = btn.closest('.artist-card');
      const wrap = card.querySelector('.blueprint-wrap');
      if (bpExpandedCards.has(key)) {
        bpExpandedCards.delete(key);
        btn.classList.remove('open');
        card.classList.remove('expanded');
        wrap.classList.remove('open');
      } else {
        bpExpandedCards.add(key);
        btn.classList.add('open');
        card.classList.add('expanded');
        wrap.classList.add('open');
      }
    });
  });

  grid.querySelectorAll('.bp-copy-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const [, genre, idx] = btn.dataset.bpKey.split(':');
      const bp = GENRE_BPS[genre][+idx];
      const color = GENRE_COLORS_BP[genre] || '#888';
      copyToClipboard(bp.prompt, btn, `Copied: ${bp.name}`, {
        name: bp.name,
        type: `Blueprint · ${genre}`,
        color
      });
    });
  });

  grid.querySelectorAll('.bp-batch-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const [, genre, idx] = btn.dataset.bpKey.split(':');
      const bp = GENRE_BPS[genre][+idx];
      document.getElementById('style-prompt').value = bp.prompt;
      switchTab('batch');
      const orig = btn.textContent;
      btn.textContent = '✓ Sent!';
      btn.classList.add('copied');
      setTimeout(() => { btn.textContent = orig; btn.classList.remove('copied'); }, 1200);
    });
  });
}

// ============================================================
// COPY UTILITY
// ============================================================
function copyToClipboard(text, btn, statusMsg, historyEntry = null) {
  // Try modern clipboard API first, fall back to execCommand
  const doCopy = () => {
    if (navigator.clipboard && navigator.clipboard.writeText && window.isSecureContext) {
      return navigator.clipboard.writeText(text);
    }
    // Fallback for HTTP or older browsers
    return new Promise((resolve, reject) => {
      try {
        const ta = document.createElement('textarea');
        ta.value = text;
        ta.style.position = 'fixed';
        ta.style.left = '-9999px';
        ta.style.top = '-9999px';
        document.body.appendChild(ta);
        ta.focus();
        ta.select();
        const ok = document.execCommand('copy');
        document.body.removeChild(ta);
        ok ? resolve() : reject(new Error('execCommand failed'));
      } catch(e) { reject(e); }
    });
  };

  doCopy().then(() => {
    const original = btn.textContent;
    btn.textContent = '✓ Copied!';
    btn.classList.add('copied');
    setTimeout(() => {
      btn.textContent = original;
      btn.classList.remove('copied');
    }, 1500);
    
    copyCount++;
    updateCopyDisplay();
    localStorage.setItem("copyCount", JSON.stringify(copyCount));
    
    // Add to session copy history
    if (historyEntry) {
      const existingIdx = sessionCopyHistory.findIndex(h => h.name === historyEntry.name);
      if (existingIdx >= 0) sessionCopyHistory.splice(existingIdx, 1);
      sessionCopyHistory.unshift({ ...historyEntry, prompt: text });
      if (sessionCopyHistory.length > 20) sessionCopyHistory.pop();
      renderCopyHistory();
    }
    
    const statusEl = document.getElementById('status-text');
    statusEl.textContent = statusMsg;
    statusEl.className = 'success';
    setTimeout(() => {
      statusEl.textContent = 'Ready';
      statusEl.className = '';
    }, 3000);
  }).catch(() => {
    // Last resort: show text for manual copy
    const original = btn.textContent;
    btn.textContent = '⚠ Select & copy below';
    setTimeout(() => { btn.textContent = original; }, 2000);
    prompt('Copy this text:', text);
  });
}

// Simple clipboard write with fallback
function clipCopy(text) {
  if (navigator.clipboard && navigator.clipboard.writeText && window.isSecureContext) {
    return navigator.clipboard.writeText(text);
  }
  return new Promise((resolve, reject) => {
    try {
      const ta = document.createElement('textarea');
      ta.value = text;
      ta.style.position = 'fixed';
      ta.style.left = '-9999px';
      document.body.appendChild(ta);
      ta.focus(); ta.select();
      const ok = document.execCommand('copy');
      document.body.removeChild(ta);
      ok ? resolve() : reject();
    } catch(e) { reject(e); }
  });
}

// Simple clipboard read with fallback
function clipRead() {
  if (navigator.clipboard && navigator.clipboard.readText && window.isSecureContext) {
    return navigator.clipboard.readText();
  }
  return Promise.reject(new Error('Clipboard read not available'));
}

function renderCopyHistory() {
  const list = document.getElementById('copy-history-list');
  if (!list) return;
  if (sessionCopyHistory.length === 0) {
    list.innerHTML = '<div class="copy-history-empty">No copies yet this session</div>';
    return;
  }
  list.innerHTML = sessionCopyHistory.map((item, idx) => `
    <div class="copy-history-item" data-idx="${idx}" title="${item.prompt}">
      <div class="copy-history-dot" style="background:${item.color || '#888'}"></div>
      <div style="flex:1;min-width:0">
        <div class="copy-history-name">${item.name}</div>
        <div class="copy-history-type">${item.type || ''}</div>
      </div>
      <button class="copy-history-recopy" data-idx="${idx}" title="Copy again">↩</button>
    </div>
  `).join('');
  
  list.querySelectorAll('.copy-history-recopy').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const item = sessionCopyHistory[parseInt(btn.dataset.idx)];
      if (item) {
        clipCopy(item.prompt);
        btn.textContent = '✓';
        setTimeout(() => { btn.textContent = '↩'; }, 1200);
      }
    });
  });
}

function updateCopyDisplay() {
  document.getElementById('total-copies').textContent = copyCount;
  document.getElementById('copy-count-display').textContent = `${copyCount} total copies`;
}

// ============================================================
// TAB SWITCHING
// ============================================================
function switchTab(tab) {
  currentTab = tab;
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelector(`.tab[data-tab="${tab}"]`).classList.add('active');
  
  const isArtists   = tab === 'artists';
  const isGenres    = tab === 'genres';
  const isBatch     = tab === 'batch';
  const isFavorites = tab === 'favorites';
  const isGuide     = tab === 'guide';
  const isAnalyse   = tab === 'analyse';
  const isRelease   = tab === 'release';
  
  // Search bar visible for both artists and blueprints tabs
  document.getElementById('search-bar').classList.toggle('visible', isArtists || isGenres);
  const searchInput = document.getElementById('search-input');
  if (isArtists) searchInput.placeholder = 'Search 259 artists by name, genre, mood...';
  if (isGenres)  searchInput.placeholder = 'Search blueprints by name, genre, style...';

  document.getElementById('sidebar').classList.toggle('visible', isArtists || isGenres);
  document.getElementById('artists-panel').style.display = isArtists ? '' : 'none';
  document.getElementById('genres-panel').classList.toggle('visible', isGenres);
  document.getElementById('batch-panel').classList.toggle('visible', isBatch);
  document.getElementById('favorites-panel').classList.toggle('visible', isFavorites);
  document.getElementById('guide-panel').classList.toggle('visible', isGuide);
  document.getElementById('analyse-panel').classList.toggle('visible', isAnalyse);
  document.getElementById('release-panel').classList.toggle('visible', isRelease);

  if (isAnalyse) checkAnalyseKey();
  if (isRelease) rpRefresh();

  // Reset genre filter and rebuild sidebar for the new tab
  activeGenre = 'All';
  rebuildGenreSidebar();

  if (isFavorites) renderFavorites();
  if (isGenres) renderBlueprintContent();
  if (isArtists) renderArtists();
}

// ============================================================
// BATCH GENERATOR
// ============================================================
// ============================================================
// STYLE PROMPT VARIATION ENGINE
// Generates subtly varied versions of a base prompt per song
// so each song in a batch feels distinct
// ============================================================
const BPM_MODIFIERS = {
  slow:     ['slow and brooding', 'late night', 'minimal', 'sparse', 'subdued'],
  mid:      ['mid-tempo', 'laid-back', 'groove-heavy', 'pocket-focused', 'warm'],
  fast:     ['driving', 'high-energy', 'relentless', 'intense', 'propulsive'],
};
// Genre-aware style variations — each array stays within the same sonic world
const GENRE_VARIATIONS = {
  trap:        ['hard-hitting 808 sub', 'rolling triplet hi-hats', 'melodic synth layer', 'dark minor key atmosphere', 'sparse percussion pockets', 'heavy reverb snare', 'sliding 808 bass'],
  drill:       ['eerie piano stabs', 'sliding 808 bass', 'ominous string samples', 'cold mechanical hi-hats', 'dark cinematic pads', 'punishing low end', 'menacing synth texture'],
  hiphop:      ['dusty vinyl sample', 'boom-bap snare crack', 'jazz chord loops', 'chopped soul vocal', 'live drum feel', 'warm bass guitar', 'Rhodes piano melody'],
  pop:         ['bright synth lead', 'layered vocal harmonies', 'punchy four-on-floor kick', 'euphoric chord lift', 'pre-chorus build tension', 'polished reverb tail', 'catchy melodic hook'],
  rnb:         ['warm Rhodes piano', 'smooth bass groove', 'lush vocal harmonies', 'intimate close-mic feel', 'sensual synth pad', 'live-feel drumming', 'neo-soul chord voicing'],
  rock:        ['crunchy power chords', 'driving snare backbeat', 'gritty bass guitar', 'aggressive guitar riff', 'dynamic verse drop', 'crashing cymbal swell', 'raw analog tone'],
  metal:       ['down-tuned guitar chug', 'blast beat percussion', 'wall of distortion', 'palm-muted riff', 'double bass drum pattern', 'harmonic minor riff', 'crushing low-end mix'],
  country:     ['fingerpicked acoustic guitar', 'pedal steel guitar', 'warm fiddle melody', 'shuffled drum feel', 'walking bass line', 'twangy electric guitar', 'honky-tonk piano'],
  folk:        ['fingerpicked acoustic', 'intimate close-mic vocal', 'simple brushed drums', 'warm upright bass', 'gentle harmonica', 'open-tuned guitar', 'banjo texture'],
  electronic:  ['pulsing synth arpeggio', 'four-on-floor kick', 'filtered synth sweep', 'driving bass line', 'layered synth pads', 'gated reverb effect', 'sidechain compression pulse'],
  jazz:        ['walking upright bass', 'brushed snare groove', 'Rhodes chord voicing', 'muted trumpet melody', 'bebop chord changes', 'swing hi-hat pattern', 'saxophone melody line'],
  gospel:      ['Hammond organ swell', 'powerful choir harmonies', 'tambourine groove', 'piano-led worship feel', 'call and response hook', 'building outro praise', 'soulful vocal runs'],
  reggae:      ['one-drop drum pattern', 'skank guitar rhythm', 'deep roots bass line', 'organ bubble rhythm', 'conscious lyrical tone', 'dub echo texture', 'nyahbinghi percussion'],
  soul:        ['Motown bass groove', 'horns stab arrangement', 'live drum feel', 'warm vocal layering', 'call and response', 'gospel-influenced chord', 'organ chord stabs'],
  punk:        ['down-strummed power chords', 'fast snare blast', 'shouted gang vocal', 'lo-fi recording aesthetic', 'two-minute song energy', 'distorted bass guitar', 'raw aggression'],
  kpop:        ['synchronized dance break', 'key change before final chorus', 'rap verse switch', 'layered vocal harmony stack', 'bright synth hook', 'EDM drop section', 'whisper pre-chorus'],
  latin:       ['dembow percussion pattern', 'reggaeton rhythm', 'brass section stab', 'nylon guitar flourish', 'bilingual flow switch', 'tropical synth texture', 'conga accent groove'],
  indie:       ['lo-fi tape warmth', 'reverb-drenched guitar wash', 'intimate close-mic vocal', 'ambient room tone', 'detuned synth texture', 'minimalist drum machine', 'dreamy pedal effect'],
  blues:       ['twelve-bar progression', 'bent guitar note', 'shuffle drum groove', 'harmonica fill', 'call and response vocal', 'walking bass line', 'raw emotional vocal'],
  ambient:     ['slowly evolving pad', 'granular texture layer', 'field recording sample', 'long reverb tail', 'generative melody pattern', 'sub-bass drone', 'spectral processing'],
  phonk:       ['distorted cowbell hit', 'pitched-down vocal sample', 'heavy 808 distortion', 'lo-fi tape hiss', 'dark reverb atmosphere', 'Memphis sample chop', 'slurred production feel'],
  drill:       ['eerie piano stabs', 'sliding 808 bass', 'ominous string samples', 'cold mechanical hi-hats', 'dark cinematic pads', 'punishing low end', 'menacing synth texture'],
};

const ENERGY_TWEAKS = [
  'verse pulled way back, chorus exploding forward',
  'consistent pressure throughout, no drop in energy',
  'building tension that never fully releases',
  'explosive intro that settles into a groove',
  'restrained verses, massive anthemic hook',
  'sparse intro that fills out over time',
];

const MIX_TWEAKS = [
  'dry and upfront mix', 'wide spacious stereo field', 'mono punchy low end focus',
  'heavy reverb atmosphere', 'close intimate recording feel', 'room sound and natural ambience',
];

function detectGenre(prompt) {
  const p = prompt.toLowerCase();
  if (/drill/.test(p)) return 'drill';
  if (/phonk/.test(p)) return 'phonk';
  if (/trap|808|atlanta/.test(p)) return 'trap';
  if (/hip.?hop|boom.?bap|rap|rhyme/.test(p)) return 'hiphop';
  if (/r&b|rnb|neo.?soul|rhythm and blues/.test(p)) return 'rnb';
  if (/k.?pop|kpop/.test(p)) return 'kpop';
  if (/gospel|worship|praise|church/.test(p)) return 'gospel';
  if (/reggaeton|bachata|salsa|cumbia|bolero|flamenco|latin trap/.test(p)) return 'latin';
  if (/reggae|dancehall|roots|rastafari/.test(p)) return 'reggae';
  if (/blues/.test(p)) return 'blues';
  if (/jazz|bebop|swing/.test(p)) return 'jazz';
  if (/soul|motown|funk/.test(p)) return 'soul';
  if (/punk|hardcore punk/.test(p)) return 'punk';
  if (/metal|thrash|death|doom|hardcore(?! punk)|heavy/.test(p)) return 'metal';
  if (/indie|bedroom pop|chamber pop|shoegaze/.test(p)) return 'indie';
  if (/rock|grunge|alternative/.test(p)) return 'rock';
  if (/country|honky.?tonk|americana|bluegrass/.test(p)) return 'country';
  if (/folk|acoustic|singer.?songwriter/.test(p)) return 'folk';
  if (/ambient|drone|generative/.test(p)) return 'ambient';
  if (/electronic|edm|techno|house|trance|dnb|drum.?and.?bass/.test(p)) return 'electronic';
  if (/pop/.test(p)) return 'pop';
  return null;
}

// Accurate BPM ranges per genre based on music research
const GENRE_BPM_RANGES = {
  trap:          [120, 160],  // hi-hats at 140+ but felt at half-time 70-80
  drill:         [130, 150],
  hiphop:        [70,  110],
  lofi:          [70,   90],
  rnb:           [60,   90],
  soul:          [70,  110],
  gospel:        [70,  120],
  pop:           [100, 130],
  dancepop:      [115, 132],
  indie:         [90,  130],
  rock:          [110, 160],
  punk:          [150, 220],
  metal:         [120, 220],
  country:       [80,  130],
  folk:          [70,  120],
  jazz:          [60,  200],
  blues:         [60,  120],
  funk:          [90,  120],
  reggae:        [60,   90],
  dancehall:     [95,  110],
  house:         [120, 130],
  deephouse:     [120, 125],
  techhouse:     [124, 132],
  techno:        [130, 150],
  trance:        [130, 145],
  dnb:           [165, 185],
  jungle:        [155, 180],
  dubstep:       [135, 145],
  garage:        [130, 135],
  ambient:       [60,  100],
  classical:     [60,  180],
  kpop:          [100, 135],
  electronic:    [100, 160],
  phonk:         [120, 140],
  latin:         [72,  138],
};

function getGenreBPMRange(prompt) {
  const p = prompt.toLowerCase();
  if (/lo.?fi/.test(p)) return GENRE_BPM_RANGES.lofi;
  if (/phonk/.test(p)) return GENRE_BPM_RANGES.phonk;
  if (/drill/.test(p)) return GENRE_BPM_RANGES.drill;
  if (/trap/.test(p)) return GENRE_BPM_RANGES.trap;
  if (/hip.?hop|boom.?bap|rap/.test(p)) return GENRE_BPM_RANGES.hiphop;
  if (/drum.?and.?bass|dnb|drum & bass/.test(p)) return GENRE_BPM_RANGES.dnb;
  if (/jungle/.test(p)) return GENRE_BPM_RANGES.jungle;
  if (/dubstep/.test(p)) return GENRE_BPM_RANGES.dubstep;
  if (/uk garage|garage/.test(p)) return GENRE_BPM_RANGES.garage;
  if (/deep house/.test(p)) return GENRE_BPM_RANGES.deephouse;
  if (/tech house/.test(p)) return GENRE_BPM_RANGES.techhouse;
  if (/house/.test(p)) return GENRE_BPM_RANGES.house;
  if (/techno/.test(p)) return GENRE_BPM_RANGES.techno;
  if (/trance/.test(p)) return GENRE_BPM_RANGES.trance;
  if (/ambient/.test(p)) return GENRE_BPM_RANGES.ambient;
  if (/punk|hardcore/.test(p)) return GENRE_BPM_RANGES.punk;
  if (/metal|thrash|death/.test(p)) return GENRE_BPM_RANGES.metal;
  if (/rock|grunge|alternative/.test(p)) return GENRE_BPM_RANGES.rock;
  if (/r&b|rnb/.test(p)) return GENRE_BPM_RANGES.rnb;
  if (/neo.?soul/.test(p)) return GENRE_BPM_RANGES.rnb;
  if (/gospel|worship/.test(p)) return GENRE_BPM_RANGES.gospel;
  if (/soul/.test(p)) return GENRE_BPM_RANGES.soul;
  if (/funk/.test(p)) return GENRE_BPM_RANGES.funk;
  if (/reggaeton|bachata|salsa|cumbia|latin trap/.test(p)) return GENRE_BPM_RANGES.latin;
  if (/dancehall/.test(p)) return GENRE_BPM_RANGES.dancehall;
  if (/reggae/.test(p)) return GENRE_BPM_RANGES.reggae;
  if (/country|honky.?tonk|americana/.test(p)) return GENRE_BPM_RANGES.country;
  if (/folk|singer.?songwriter/.test(p)) return GENRE_BPM_RANGES.folk;
  if (/jazz/.test(p)) return GENRE_BPM_RANGES.jazz;
  if (/blues/.test(p)) return GENRE_BPM_RANGES.blues;
  if (/k.?pop/.test(p)) return GENRE_BPM_RANGES.kpop;
  if (/dance pop|electropop/.test(p)) return GENRE_BPM_RANGES.dancepop;
  if (/pop/.test(p)) return GENRE_BPM_RANGES.pop;
  if (/indie|bedroom pop|chamber pop/.test(p)) return GENRE_BPM_RANGES.indie;
  if (/electronic|edm|synth/.test(p)) return GENRE_BPM_RANGES.electronic;
  if (/classical|orchestra/.test(p)) return GENRE_BPM_RANGES.classical;
  return null; // no range found — shift freely
}

// Batch-level entropy seed: changes every time generateBatch() is called
let _bpmEntropySeed = Date.now();

function refreshBPMEntropy() {
  _bpmEntropySeed = Date.now() ^ (Math.random() * 0xFFFFFF | 0);
}

function varyBPM(prompt, songIndex) {
  const bpmMode = document.querySelector('input[name="bpmMode"]:checked')?.value || 'vary';
  if (bpmMode !== 'vary' || songIndex === 0) return prompt;

  const genreRange = getGenreBPMRange(prompt);

  return prompt.replace(/\b(\d{2,3})\s*BPM\b/gi, (match, bpm) => {
    const base = parseInt(bpm);

    // Determine effective range: if the original BPM is well below the genre
    // floor (e.g. half-time trap at 76 BPM vs trap range [120,160]), use a
    // ±15 window around the original BPM instead of the genre range.
    let range = genreRange;
    if (range && base < range[0] - 10) {
      // Original BPM is significantly below genre range — half-time feel
      range = [Math.max(40, base - 15), base + 15];
    } else if (range && base > range[1] + 10) {
      // Original BPM is significantly above genre range — double-time feel
      range = [base - 15, Math.min(300, base + 15)];
    }

    // Mix session entropy + songIndex so each regeneration AND each song
    // within a batch both get unique shifts
    const entropy = (_bpmEntropySeed ^ (songIndex * 0x9e3779b9)) >>> 0;
    const shiftAbs = 3 + (entropy % 12);           // 3–14 BPM shift (tighter)
    const direction = (entropy & 1) ? 1 : -1;
    let newBpm = base + shiftAbs * direction;

    // Clamp to effective range if known, otherwise 40–300
    if (range) {
      newBpm = Math.max(range[0], Math.min(range[1], newBpm));
    } else {
      newBpm = Math.max(40, Math.min(300, newBpm));
    }
    return `${newBpm} BPM`;
  });
}

function varyStylePrompt(basePrompt, songIndex, totalSongs) {
  const bpmMode = document.querySelector('input[name="bpmMode"]:checked')?.value || 'vary';
  
  // Apply BPM shift first
  let varied = varyBPM(basePrompt, songIndex);
  
  if (bpmMode !== 'vary' || songIndex === 0) return varied;

  // Detect genre and pick same-genre style modifiers
  const genre = detectGenre(basePrompt);
  const genrePool = genre ? GENRE_VARIATIONS[genre] : null;

  const additions = [];

  // Add 1 genre-specific instrument/production tweak
  if (genrePool) {
    // Use entropy seed so each regeneration picks a different pool item
    const entropyIdx = ((_bpmEntropySeed >>> 0) ^ (songIndex * 0x6c62272e)) % genrePool.length;
    additions.push(genrePool[entropyIdx]);
  }

  // Add 1 energy or mix tweak — entropy-driven so it varies per batch
  const tweakSeed = ((_bpmEntropySeed >>> 4) ^ (songIndex * 0x811c9dc5)) >>> 0;
  if (tweakSeed & 1) {
    additions.push(ENERGY_TWEAKS[tweakSeed % ENERGY_TWEAKS.length]);
  } else {
    additions.push(MIX_TWEAKS[tweakSeed % MIX_TWEAKS.length]);
  }

  return varied + ', ' + additions.join(', ');
}

async function generateBatch(append = false) {
  // Refresh entropy so every regeneration produces different BPM/style variations
  refreshBPMEntropy();

  const prompt = document.getElementById('style-prompt').value.trim();
  if (!prompt) {
    alert('Please enter a style prompt first.');
    return;
  }
  
  const btn = document.getElementById('generate-btn');
  const addBtn = document.getElementById('add-more-btn');
  btn.disabled = true;
  addBtn.disabled = true;
  btn.textContent = '⏳ Generating...';
  if (append) addBtn.textContent = '⏳ Adding...';
  
  const progressWrap = document.getElementById('progress-wrap');
  const progressFill = document.getElementById('progress-fill');
  const progressText = document.getElementById('progress-text');
  progressWrap.classList.add('visible');
  progressFill.style.width = '10%';
  progressText.textContent = append ? 'Adding more songs...' : 'Starting generation...';
  
  // Seed used titles from existing batch to prevent duplicates
  const usedTitles = append
    ? new Set(generatedSongs.map(s => s.title))
    : new Set();
  const usedOpeners = new Set();
  
  let songs = [];
  
  if (selectedLLM !== 'builtin') {
    const key = selectedLLM === 'gemini' ? geminiApiKey
              : selectedLLM === 'claude'  ? apiKey
              : openaiApiKey;

    if (!key) {
      progressText.textContent = '⚠ No API key saved — using built-in engine';
      await new Promise(r => setTimeout(r, 800));
    } else {
      const llmLabel = selectedLLM === 'gemini' ? 'Gemini AI' : selectedLLM === 'claude' ? 'Claude AI' : 'ChatGPT';
      progressText.textContent = `Calling ${llmLabel}...`;
      progressFill.style.width = '30%';

      try {
        const result = await handleGenerate({
                  apiKey: selectedLLM === 'claude' ? key : null,
                  openaiApiKey: selectedLLM === 'openai' ? key : null,
                  geminiApiKey: selectedLLM === 'gemini' ? key : null,
                  llm: selectedLLM,
                  langInstruction: getLanguageInstruction(),
                  stylePrompt: prompt, count: selectedCount, existingTitles: [...usedTitles]
        });

        if (result && result.songs && result.songs.length > 0) {
          // Apply BPM variation to each song's style prompt post-generation
          songs = result.songs.map((s, i) => ({
            ...s,
            // Always use original prompt as base — never trust what LLM returns for style
            style: varyStylePrompt(prompt, i, result.songs.length)
          }));
          progressFill.style.width = '90%';
          progressText.textContent = `Generated ${songs.length} songs with ${llmLabel}`;
        } else if (result && result.error) {
          progressText.textContent = `⚠ ${result.error} — falling back to built-in engine`;
          await new Promise(r => setTimeout(r, 1500));
          songs = generateSongsV2(prompt, selectedCount, usedTitles, _sessionNonce); _sessionNonce += selectedCount;
        } else {
          progressText.textContent = 'Falling back to built-in engine...';
          songs = generateSongsV2(prompt, selectedCount, usedTitles, _sessionNonce); _sessionNonce += selectedCount;
        }
      } catch(err) {
        progressText.textContent = `⚠ ${err.message} — falling back to built-in engine`;
        await new Promise(r => setTimeout(r, 1500));
        songs = generateSongsV2(prompt, selectedCount, usedTitles, _sessionNonce); _sessionNonce += selectedCount;
      }
    }
  }

  if (!songs.length) {
    progressFill.style.width = '40%';
    progressText.textContent = 'Writing songs...';
    // Small delay for UX
    await new Promise(r => setTimeout(r, 300));
    // Generate songs with style variation — each song gets a subtly different prompt
    songs = [];
    for (let i = 0; i < selectedCount; i++) {
      const variedPrompt = varyStylePrompt(prompt, i, selectedCount);
      const batchSongs = generateSongsV2(variedPrompt, 1, usedTitles, _sessionNonce + i);
      if (batchSongs.length > 0) {
        batchSongs[0].style = variedPrompt;
        songs.push(batchSongs[0]);
        usedTitles.add(batchSongs[0].title);
      }
    }
    _sessionNonce += selectedCount;
    progressFill.style.width = '90%';
    progressText.textContent = `Generated ${songs.length} songs`;
  }
  
  if (append) {
    generatedSongs = [...generatedSongs, ...songs];
  } else {
    generatedSongs = songs;
  }

  // Persist openers permanently — these can never be used as first lines again
  const newOpeners = songs.map(s => extractOpener(s.lyrics)).filter(Boolean);
  await saveOpenersToStorage(newOpeners, _sessionNonce);
  
  progressFill.style.width = '100%';
  progressText.textContent = append
    ? `✓ Added ${songs.length} songs — ${generatedSongs.length} total`
    : `✓ ${songs.length} songs ready`;
  
  setTimeout(() => {
    progressWrap.classList.remove('visible');
    progressFill.style.width = '0%';
  }, 1500);
  
  renderSongs();
  
  btn.disabled = false;
  btn.textContent = '⚡ GENERATE BATCH';
  addBtn.disabled = false;
  addBtn.textContent = '＋ Add More Songs';
}

function renderSongs() {
  const empty = document.getElementById('songs-empty');
  const wrap = document.getElementById('songs-wrap');
  const list = document.getElementById('songs-list');
  const addBtn = document.getElementById('add-more-btn');
  
  // Show add-more only when there are already songs
  addBtn.style.display = generatedSongs.length > 0 ? 'block' : 'none';

  if (generatedSongs.length === 0) {
    empty.style.display = 'flex';
    wrap.style.display = 'none';
    return;
  }
  
  empty.style.display = 'none';
  wrap.style.display = 'block';
  document.getElementById('results-count').textContent = `${generatedSongs.length} songs generated`;
  
  list.innerHTML = generatedSongs.map((song, i) => {
    const themeBadge = song.theme ? `<span class="song-badge theme">${song.theme}</span>` : '';
    const registerBadge = song.register ? `<span class="song-badge register">${song.register}</span>` : '';
    // Build structure summary from lyrics section tags
    const sections = (song.lyrics.match(/\[[^\]]+\]/g) || []);
    const uniqueSections = [...new Set(sections)];
    const structureSummary = uniqueSections.length > 0 
      ? uniqueSections.map(s => `<span class="song-section-tag">${s.replace(/[\[\]]/g,'')}</span>`).join('')
      : '';
    const lineCount = song.lyrics.split('\n').filter(l => l.trim() && !l.startsWith('[')).length;
    return `
    <div class="song-card" data-idx="${i}">
      <div class="song-card-header">
        <div class="song-num">${String(i+1).padStart(2,'0')}</div>
        <div class="song-title">${song.title}</div>
        <div class="song-header-badges">${themeBadge}${registerBadge}</div>
        <div class="song-chevron">▼</div>
      </div>
      ${structureSummary ? `<div class="song-structure-row">${structureSummary}<span class="song-line-count">${lineCount} lines</span></div>` : ''}
      <div class="song-card-body">
        <div class="song-body-label">Style Prompt</div>
        <textarea class="song-style-box" data-idx="${i}">${song.style}</textarea>
        <div class="song-body-label">Lyrics <span class="lyrics-edited-badge" id="lyrics-edited-${i}" style="display:none;font-size:9px;color:var(--cyan);font-weight:600;margin-left:6px;letter-spacing:0.5px;">✎ EDITED</span></div>
        <textarea class="song-lyrics-box" data-idx="${i}">${song.lyrics}</textarea>
        <div class="song-action-row">
          <button class="song-action-btn copy-style" data-idx="${i}">📋 Style</button>
          <button class="song-action-btn copy-lyrics" data-idx="${i}">📝 Lyrics</button>
          <button class="song-action-btn copy-all" data-idx="${i}">⚡ All</button>
          <button class="song-action-btn remix-song" data-idx="${i}" title="Remix this song">🎛</button>
          <button class="song-action-btn regen-song" data-idx="${i}" title="Regenerate this song">🔄</button>
          <button class="song-action-btn remove-song" data-idx="${i}" title="Remove">✕</button>
        </div>
      </div>
    </div>`;
  }).join('');
  
  // Toggle expand
  list.querySelectorAll('.song-card-header').forEach(header => {
    header.addEventListener('click', () => {
      header.closest('.song-card').classList.toggle('open');
    });
  });
  
  // Copy style
  list.querySelectorAll('.copy-style').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const ta = list.querySelector(`.song-style-box[data-idx="${btn.dataset.idx}"]`);
      clipCopy(ta ? ta.value : generatedSongs[+btn.dataset.idx].style);
      flashBtn(btn, '✓');
    });
  });
  // Copy lyrics
  list.querySelectorAll('.copy-lyrics').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const ta = list.querySelector(`.song-lyrics-box[data-idx="${btn.dataset.idx}"]`);
      clipCopy(ta ? ta.value : generatedSongs[+btn.dataset.idx].lyrics);
      flashBtn(btn, '✓');
    });
  });
  // Copy all (single song)
  list.querySelectorAll('.copy-all').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const s = generatedSongs[+btn.dataset.idx];
      const ta = list.querySelector(`.song-lyrics-box[data-idx="${btn.dataset.idx}"]`);
      const lyrics = ta ? ta.value : s.lyrics;
      clipCopy(`TITLE: ${s.title}\n\nSTYLE: ${s.style}\n\nLYRICS:\n${lyrics}`);
      flashBtn(btn, '✓');
    });
  });
  // Sync lyric edits back to generatedSongs so exports stay up to date
  list.querySelectorAll('.song-lyrics-box').forEach(ta => {
    ta.addEventListener('input', () => {
      const idx = +ta.dataset.idx;
      generatedSongs[idx].lyrics = ta.value;
      const badge = document.getElementById(`lyrics-edited-${idx}`);
      if (badge) badge.style.display = ta.value !== ta.defaultValue ? 'inline' : 'none';
    });
  });
  // Sync style edits back to generatedSongs
  list.querySelectorAll('.song-style-box').forEach(ta => {
    ta.addEventListener('input', () => {
      generatedSongs[+ta.dataset.idx].style = ta.value;
    });
  });
  // Remix single song
  list.querySelectorAll('.remix-song').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const idx = +btn.dataset.idx;
      openRemixPanel(idx);
    });
  });
  // Regenerate single song
  list.querySelectorAll('.regen-song').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const idx = +btn.dataset.idx;
      const style = generatedSongs[idx].style;
      btn.textContent = '⏳';
      btn.disabled = true;
      const usedTitles = new Set(generatedSongs.map(s => s.title));
      const newSongs = generateSongsV2(style, 1, usedTitles, _sessionNonce++);
      if (newSongs.length > 0) {
        generatedSongs[idx] = newSongs[0];
        renderSongs();
        // Re-open the card that was regenerated
        const cards = document.querySelectorAll('.song-card');
        if (cards[idx]) cards[idx].classList.add('open');
      }
    });
  });
  // Remove
  list.querySelectorAll('.remove-song').forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      generatedSongs.splice(+btn.dataset.idx, 1);
      renderSongs();
    });
  });
}

function flashBtn(btn, msg) {
  const orig = btn.textContent;
  btn.textContent = msg;
  btn.classList.add('copied');
  setTimeout(() => { btn.textContent = orig; btn.classList.remove('copied'); }, 1200);
}

// ============================================================
// REMIX PANEL
// ============================================================
let remixTargetIdx = -1;

function openRemixPanel(songIdx) {
  remixTargetIdx = songIdx;
  const song = generatedSongs[songIdx];
  if (!song) return;
  
  document.getElementById('remix-song-name').textContent = `"${song.title}"`;
  document.getElementById('remix-style-input').value = song.style;
  
  // Reset chip selections
  document.querySelectorAll('.remix-chip[data-remix-mood]').forEach(c => c.classList.toggle('active', c.dataset.remixMood === ''));
  document.querySelectorAll('.remix-chip[data-remix-theme]').forEach(c => c.classList.toggle('active', c.dataset.remixTheme === ''));
  
  document.getElementById('remix-overlay').classList.add('visible');
}

function closeRemixPanel() {
  document.getElementById('remix-overlay').classList.remove('visible');
  remixTargetIdx = -1;
}

function setupRemixPanel() {
  // Mood chips
  document.getElementById('remix-mood-chips').addEventListener('click', (e) => {
    const chip = e.target.closest('.remix-chip');
    if (!chip) return;
    document.querySelectorAll('#remix-mood-chips .remix-chip').forEach(c => c.classList.remove('active'));
    chip.classList.add('active');
  });
  
  // Theme chips
  document.getElementById('remix-theme-chips').addEventListener('click', (e) => {
    const chip = e.target.closest('.remix-chip');
    if (!chip) return;
    document.querySelectorAll('#remix-theme-chips .remix-chip').forEach(c => c.classList.remove('active'));
    chip.classList.add('active');
  });
  
  // Close
  document.getElementById('remix-close').addEventListener('click', closeRemixPanel);
  document.getElementById('remix-cancel-btn').addEventListener('click', closeRemixPanel);
  document.getElementById('remix-overlay').addEventListener('click', (e) => {
    if (e.target === document.getElementById('remix-overlay')) closeRemixPanel();
  });
  
  // Generate
  document.getElementById('remix-generate-btn').addEventListener('click', async () => {
    if (remixTargetIdx < 0) return;
    
    const moodMod = document.querySelector('#remix-mood-chips .remix-chip.active')?.dataset.remixMood || '';
    const themeMod = document.querySelector('#remix-theme-chips .remix-chip.active')?.dataset.remixTheme || '';
    const baseStyle = document.getElementById('remix-style-input').value.trim();
    
    let remixStyle = baseStyle;
    if (moodMod) remixStyle += ', ' + moodMod;
    if (themeMod) remixStyle += ', ' + themeMod;
    
    const btn = document.getElementById('remix-generate-btn');
    btn.textContent = '⏳ Remixing...';
    btn.disabled = true;
    
    const usedTitles = new Set(generatedSongs.map(s => s.title));
    const newSongs = generateSongsV2(remixStyle, 1, usedTitles, _sessionNonce++);
    
    if (newSongs.length > 0) {
      newSongs[0].style = remixStyle;
      generatedSongs[remixTargetIdx] = newSongs[0];
      closeRemixPanel();
      renderSongs();
      // Re-open the remixed card
      setTimeout(() => {
        const cards = document.querySelectorAll('.song-card');
        if (cards[remixTargetIdx]) cards[remixTargetIdx].classList.add('open');
      }, 50);
    }
    
    btn.textContent = '⚡ Regenerate with Remix';
    btn.disabled = false;
  });
}



function exportJSON() {
  const data = generatedSongs.map(s => ({
    title: s.title,
    lyrics: s.lyrics,
    style: s.style,
    instrumental: s.instrumental
  }));
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url;
  a.download = `suno_songs_${Date.now()}.json`;
  a.click(); URL.revokeObjectURL(url);
}

function exportTXT() {
  const text = generatedSongs.map((s, i) =>
    `═══════════════════════════════════\nSONG ${i+1}: ${s.title}\n═══════════════════════════════════\n\nSTYLE PROMPT:\n${s.style}\n\nLYRICS:\n${s.lyrics}\n`
  ).join('\n\n');
  const blob = new Blob([text], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url;
  a.download = `suno_songs_${Date.now()}.txt`;
  a.click(); URL.revokeObjectURL(url);
}

// ============================================================
// LLM SELECTOR
// ============================================================
function setupLLMSelector() {
  const keyRow   = document.getElementById('llm-key-row');
  const keyInput = document.getElementById('llm-key-input');
  const saveBtn  = document.getElementById('llm-save-key');
  const status   = document.getElementById('llm-status');
  const selected = document.getElementById('llm-dropdown-selected');
  const menu     = document.getElementById('llm-dropdown-menu');

  const LLM_META = {
    builtin:  { dot: 'builtin',   label: 'Built-in Engine',    sub: 'Free · No API key needed',      placeholder: '',           storageKey: null },
    gemini:   { dot: 'gemini',    label: 'Google Gemini',       sub: 'Free API · Higher quality',     placeholder: 'AIza...',    storageKey: 'geminiApiKey' },
    claude:   { dot: 'anthropic', label: 'Claude (Anthropic)',  sub: 'Paid API · Best quality',       placeholder: 'sk-ant-...', storageKey: 'apiKey' },
    openai:   { dot: 'openai',    label: 'ChatGPT (OpenAI)',    sub: 'Paid API · Best quality',       placeholder: 'sk-...',     storageKey: 'openaiApiKey' },
  };

  function updateSelectedDisplay() {
    const m = LLM_META[selectedLLM];
    selected.innerHTML = `
      <div class="llm-dot ${m.dot}"></div>
      <span class="llm-dropdown-label">${m.label}${selectedLLM === 'gemini' ? ' <span class="llm-free-badge">FREE</span>' : ''}</span>
      <span class="llm-dropdown-sub">${m.sub}</span>
      <span class="llm-dropdown-arrow">▾</span>`;
  }

  function refreshUI() {
    updateSelectedDisplay();
    document.querySelectorAll('.llm-dropdown-item').forEach(item => {
      item.classList.toggle('active', item.dataset.llm === selectedLLM);
    });

    const m = LLM_META[selectedLLM];
    if (selectedLLM === 'builtin') {
      keyRow.style.display = 'none';
      status.textContent = 'Built-in engine active — free, no key needed';
      status.className = 'llm-status';
    } else {
      keyRow.style.display = 'flex';
      keyInput.placeholder = m.placeholder;
      const currentKey = selectedLLM === 'gemini' ? geminiApiKey
                       : selectedLLM === 'claude'  ? apiKey
                       : openaiApiKey;
      if (currentKey) {
        keyInput.value = '••••••••••••••••';
        status.textContent = `✓ Key saved — ${m.label} enabled`;
        status.className = 'llm-status ok';
      } else {
        keyInput.value = '';
        status.textContent = `No key saved — paste your key below`;
        status.className = 'llm-status warn';
      }
    }
  }

  // Toggle dropdown open/close
  selected.addEventListener('click', (e) => {
    const isOpen = menu.style.display !== 'none';
    menu.style.display = isOpen ? 'none' : 'block';
    selected.classList.toggle('open', !isOpen);
  });

  // Close on outside click
  document.addEventListener('click', (e) => {
    if (!e.target.closest('#llm-dropdown')) {
      menu.style.display = 'none';
      selected.classList.remove('open');
    }
  });

  // Item selection
  document.querySelectorAll('.llm-dropdown-item').forEach(item => {
    item.addEventListener('click', (e) => {
      e.stopPropagation();
      selectedLLM = item.dataset.llm;
      localStorage.setItem("selectedLLM", JSON.stringify(selectedLLM));
      menu.style.display = 'none';
      selected.classList.remove('open');
      refreshUI();
      // Update language note
      const langNote = document.getElementById('lang-note');
      if (langNote) langNote.style.display = (selectedLang !== 'en' && selectedLLM === 'builtin') ? 'block' : 'none';
    });
  });

  // Clear masked dots on focus
  keyInput.addEventListener('focus', function() {
    if (this.value.includes('•')) this.value = '';
  });

  // Save key
  saveBtn.addEventListener('click', () => {
    const val = keyInput.value.trim();
    if (!val || val.includes('•')) return;
    const m = LLM_META[selectedLLM];
    if (!m.storageKey) return;

    if (selectedLLM === 'gemini')  geminiApiKey = val;
    if (selectedLLM === 'claude')  apiKey = val;
    if (selectedLLM === 'openai')  openaiApiKey = val;
    localStorage.setItem(m.storageKey, JSON.stringify(val));

    keyInput.value = '••••••••••••••••';
    status.textContent = `✓ Key saved — ${m.label} enabled`;
    status.className = 'llm-status ok';
    const orig = saveBtn.textContent;
    saveBtn.textContent = '✓ Saved';
    setTimeout(() => saveBtn.textContent = orig, 1800);
  });

  refreshUI();
}

// ============================================================
// LANGUAGE SELECTOR
// ============================================================
const LANG_NAMES = {
  en: 'English', es: 'Spanish', pt: 'Portuguese', fr: 'French',
  ko: 'Korean', ja: 'Japanese', zh: 'Chinese (Mandarin)', hi: 'Hindi',
  ar: 'Arabic', de: 'German', it: 'Italian', tr: 'Turkish',
  ru: 'Russian', sw: 'Swahili', tl: 'Tagalog', yo: 'Yoruba'
};

function setupLanguageSelector() {
  const langNote = document.getElementById('lang-note');

  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      selectedLang = btn.dataset.lang;
      localStorage.setItem("selectedLang", JSON.stringify(selectedLang));

      // Show warning if non-English + built-in engine
      if (selectedLang !== 'en' && selectedLLM === 'builtin') {
        langNote.style.display = 'block';
      } else {
        langNote.style.display = 'none';
      }
    });
  });

  // Restore saved language
  {
    const data = {};
    try { if (localStorage.getItem("selectedLang")) data.selectedLang = JSON.parse(localStorage.getItem("selectedLang")); } catch(e) {}
    if (data.selectedLang) {
      selectedLang = data.selectedLang;
      document.querySelectorAll('.lang-btn').forEach(b => {
        b.classList.toggle('active', b.dataset.lang === selectedLang);
      });
      if (selectedLang !== 'en' && selectedLLM === 'builtin') {
        langNote.style.display = 'block';
      }
    }
  }
}

function getLanguageInstruction() {
  if (selectedLang === 'en') return '';
  const name = LANG_NAMES[selectedLang] || selectedLang;
  return `\n\nCRITICAL LANGUAGE INSTRUCTION: Write ALL lyrics in ${name}. Use native ${name} songwriting conventions — natural phrasing, culturally authentic expressions, proper poetic structure for ${name} music. Do NOT translate English lyrics — write as a native ${name} songwriter would. Song titles should also be in ${name}.`;
}

// ============================================================
// ANALYSE SONG
// ============================================================
let analyseFile = null;

function checkAnalyseKey() {
  const input = document.getElementById('analyse-key-input');
  const status = document.getElementById('analyse-key-status');
  const help = document.getElementById('analyse-key-help');
  if (geminiApiKey) {
    input.value = '••••••••••••••••';
    status.textContent = '✓ Key saved';
    status.style.color = '#00c851';
    help.style.display = 'none';
  } else {
    input.value = '';
    status.textContent = 'No key saved';
    status.style.color = 'var(--dim)';
    help.style.display = '';
  }
}

function setupAnalyse() {
  const dropzone = document.getElementById('analyse-dropzone');
  const fileInput = document.getElementById('analyse-file-input');
  const fileInfo = document.getElementById('analyse-file-info');
  const goBtn = document.getElementById('analyse-go-btn');

  // Key input - clear dots on focus
  const keyInput = document.getElementById('analyse-key-input');
  keyInput.addEventListener('focus', function() {
    if (this.value.includes('•')) this.value = '';
  });
  // Save key
  document.getElementById('analyse-key-save').addEventListener('click', () => {
    const val = keyInput.value.trim();
    if (!val || val.includes('•')) return;
    geminiApiKey = val;
    localStorage.setItem("geminiApiKey", JSON.stringify(val));
      keyInput.value = '••••••••••••••••';
      const status = document.getElementById('analyse-key-status');
      status.textContent = '✓ Key saved';
      status.style.color = '#00c851';
      document.getElementById('analyse-key-help').style.display = 'none';
      const saveBtn = document.getElementById('analyse-key-save');
      saveBtn.textContent = '✓ Saved';
      setTimeout(() => saveBtn.textContent = 'Save', 1500);
  });

  // Click to browse
  dropzone.addEventListener('click', () => fileInput.click());

  // Drag events
  dropzone.addEventListener('dragover', (e) => { e.preventDefault(); dropzone.classList.add('dragover'); });
  dropzone.addEventListener('dragleave', () => dropzone.classList.remove('dragover'));
  dropzone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropzone.classList.remove('dragover');
    if (e.dataTransfer.files.length) handleAnalyseFile(e.dataTransfer.files[0]);
  });

  // File input change
  fileInput.addEventListener('change', () => {
    if (fileInput.files.length) handleAnalyseFile(fileInput.files[0]);
  });

  // Remove file
  document.getElementById('analyse-file-remove').addEventListener('click', () => {
    analyseFile = null;
    fileInfo.classList.remove('visible');
    dropzone.style.display = '';
    goBtn.disabled = true;
    document.getElementById('analyse-results').classList.remove('visible');
  });

  // Go button
  goBtn.addEventListener('click', runAnalysis);

  // Copy buttons
  document.getElementById('copy-voice-prompt').addEventListener('click', () => {
    clipCopy(document.getElementById('analyse-voice-text').textContent);
    const btn = document.getElementById('copy-voice-prompt');
    btn.textContent = '✓ Copied';
    setTimeout(() => btn.textContent = '📋 Copy', 1500);
  });
  document.getElementById('copy-style-prompt').addEventListener('click', () => {
    clipCopy(document.getElementById('analyse-style-text').textContent);
    const btn = document.getElementById('copy-style-prompt');
    btn.textContent = '✓ Copied';
    setTimeout(() => btn.textContent = '📋 Copy', 1500);
  });
}

function handleAnalyseFile(file) {
  const ext = file.name.split('.').pop().toLowerCase();
  const validExts = ['mp3', 'wav', 'ogg', 'flac', 'm4a', 'aac', 'wma', 'webm', 'opus', 'aiff', 'aif'];

  if (!file.type.startsWith('audio/') && !validExts.includes(ext)) {
    alert('Unsupported format. Use MP3, WAV, M4A, OGG, or FLAC.');
    return;
  }

  analyseFile = file;
  document.getElementById('analyse-file-name').textContent = file.name;
  document.getElementById('analyse-file-size').textContent = (file.size / (1024 * 1024)).toFixed(1) + ' MB';
  document.getElementById('analyse-file-info').classList.add('visible');
  document.getElementById('analyse-dropzone').style.display = 'none';
  document.getElementById('analyse-go-btn').disabled = false;
  document.getElementById('analyse-results').classList.remove('visible');
}

async function runAnalysis() {
  if (!analyseFile) return;
  if (!geminiApiKey) {
    document.getElementById('analyse-key-input').focus();
    const status = document.getElementById('analyse-key-status');
    status.textContent = '⚠ Enter your Gemini key first';
    status.style.color = '#fb923c';
    document.getElementById('analyse-key-help').style.display = '';
    return;
  }

  const goBtn = document.getElementById('analyse-go-btn');
  const progress = document.getElementById('analyse-progress');
  const results = document.getElementById('analyse-results');

  goBtn.disabled = true;
  goBtn.textContent = '⏳ Analysing...';
  progress.classList.add('visible');
  results.classList.remove('visible');

  try {
    const ext = analyseFile.name.split('.').pop().toLowerCase();
    const mimeMap = {
      mp3: 'audio/mpeg', wav: 'audio/wav', m4a: 'audio/mp4',
      ogg: 'audio/ogg', flac: 'audio/flac', aac: 'audio/aac',
      webm: 'audio/webm', wma: 'audio/x-ms-wma', opus: 'audio/opus',
      aiff: 'audio/aiff', aif: 'audio/aiff'
    };
    const mimeType = mimeMap[ext] || analyseFile.type || 'audio/mpeg';

    // Step 1: Start resumable upload to Gemini File API
    document.getElementById('analyse-progress-msg').textContent = 'Starting upload...';

    const startResp = await fetch(
      `https://generativelanguage.googleapis.com/upload/v1beta/files?key=${geminiApiKey}`,
      {
        method: 'POST',
        headers: {
          'X-Goog-Upload-Protocol': 'resumable',
          'X-Goog-Upload-Command': 'start',
          'X-Goog-Upload-Header-Content-Length': analyseFile.size,
          'X-Goog-Upload-Header-Content-Type': mimeType,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ file: { display_name: analyseFile.name } })
      }
    );

    if (!startResp.ok) {
      const err = await startResp.json().catch(() => ({}));
      throw new Error(err.error?.message || `Upload init failed: ${startResp.status}`);
    }

    const uploadUrl = startResp.headers.get('X-Goog-Upload-URL');
    if (!uploadUrl) throw new Error('No upload URL returned from Gemini');

    // Step 2: Upload the raw file bytes directly — no base64, no size limit
    document.getElementById('analyse-progress-msg').textContent = `Uploading ${(analyseFile.size / (1024*1024)).toFixed(1)}MB to Gemini...`;

    const uploadResp = await fetch(uploadUrl, {
      method: 'POST',
      headers: {
        'Content-Length': analyseFile.size,
        'X-Goog-Upload-Offset': '0',
        'X-Goog-Upload-Command': 'upload, finalize'
      },
      body: analyseFile
    });

    if (!uploadResp.ok) {
      const err = await uploadResp.json().catch(() => ({}));
      throw new Error(err.error?.message || `Upload failed: ${uploadResp.status}`);
    }

    const fileData = await uploadResp.json();
    const fileUri = fileData.file?.uri;
    if (!fileUri) throw new Error('No file URI returned after upload');

    // Step 3: Wait for Gemini to process the audio
    document.getElementById('analyse-progress-msg').textContent = 'Processing audio...';
    let fileState = fileData.file?.state;
    let attempts = 0;
    while (fileState === 'PROCESSING' && attempts < 120) {
      await new Promise(r => setTimeout(r, 2000));
      const checkResp = await fetch(
        `https://generativelanguage.googleapis.com/v1beta/${fileData.file.name}?key=${geminiApiKey}`
      );
      const checkInfo = await checkResp.json();
      fileState = checkInfo.state;
      attempts++;
      if (attempts % 5 === 0) {
        document.getElementById('analyse-progress-msg').textContent = `Processing audio... (${attempts * 2}s)`;
      }
    }
    if (fileState !== 'ACTIVE') throw new Error('File processing failed. Try a different format or shorter clip.');

    // Step 4: Send analysis request — only a file_uri reference, tiny request
    document.getElementById('analyse-progress-msg').textContent = 'Analysing vocal and instrumental DNA...';

    const analysePrompt = `You are an expert music producer, vocal coach, and audio engineer. Analyze this audio track and produce two separate, copy-ready prompts for Suno AI music generation.

OUTPUT FORMAT — respond with EXACTLY this structure and nothing else:

VOICE PROMPT:
[A single comma-separated prompt string describing: vocal tone, vocal texture, delivery style, cadence/flow, vocal effects (reverb, autotune, distortion, etc.), mic style (close/room/lo-fi), era feel, gender, approximate vocal range, breath control, emotional quality, any signature vocal techniques like falsetto, growl, whisper, ad-libs, vocal layering]

SONG STYLE PROMPT:
[A single comma-separated prompt string describing: estimated BPM, key feel (major/minor/modal), primary genre and sub-genre blend, main instruments, arrangement structure (sparse vs dense, build patterns), production texture (clean/gritty/lo-fi/polished), mix character (wide/mono/compressed/dynamic), drum style, bass character, any notable production techniques like sidechain, filtering, sampling, specific effects]

RULES:
- Each prompt must be a SINGLE LINE of comma-separated descriptors
- Be SPECIFIC not generic
- Include BPM estimate in the style prompt
- These prompts will be pasted directly into Suno, so make them production-ready
- Focus on what makes this track UNIQUE and IDENTIFIABLE`;

    const modelsToTry = ['gemini-2.5-flash', 'gemini-2.0-flash', 'gemini-1.5-flash-001', 'gemini-1.5-pro-001'];
    let lastError = '';
    let resultText = '';

    for (const model of modelsToTry) {
      try {
        const genResp = await fetch(
          `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${geminiApiKey}`,
          {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              contents: [{
                parts: [
                  { file_data: { mime_type: mimeType, file_uri: fileUri } },
                  { text: analysePrompt }
                ]
              }],
              generationConfig: { maxOutputTokens: 2048, temperature: 0.4 }
            })
          }
        );
        const genData = await genResp.json();
        if (!genResp.ok) { lastError = genData.error?.message || `HTTP ${genResp.status}`; continue; }
        resultText = genData.candidates?.[0]?.content?.parts?.[0]?.text;
        if (resultText) break;
        lastError = 'Empty response';
      } catch(e) { lastError = e.message; continue; }
    }

    if (!resultText) throw new Error(`Analysis failed: ${lastError}`);

    // Step 5: Parse results
    document.getElementById('analyse-progress-msg').textContent = 'Parsing results...';
    let voicePrompt = '';
    let stylePrompt = '';

    const voiceMatch = resultText.match(/(?:VOICE PROMPT|Voice Prompt|vocal prompt)[:\s]*\n?([\s\S]*?)(?=(?:SONG STYLE PROMPT|Song Style Prompt|Style Prompt|STYLE PROMPT|\n\n\d\.|\n\n##|$))/i);
    const styleMatch = resultText.match(/(?:SONG STYLE PROMPT|Song Style Prompt|Style Prompt|STYLE PROMPT)[:\s]*\n?([\s\S]*?)$/i);

    if (voiceMatch) voicePrompt = voiceMatch[1].trim();
    if (styleMatch) stylePrompt = styleMatch[1].trim();

    if (!voicePrompt && !stylePrompt) {
      const parts = resultText.split(/\n\n+/);
      if (parts.length >= 2) {
        voicePrompt = parts[0].replace(/^[\d.)\-*#\s]+/, '').trim();
        stylePrompt = parts.slice(1).join('\n\n').replace(/^[\d.)\-*#\s]+/, '').trim();
      } else { voicePrompt = resultText; stylePrompt = resultText; }
    }

    voicePrompt = voicePrompt.replace(/^[*\-#]+\s*/gm, '').replace(/\*\*/g, '').trim();
    stylePrompt = stylePrompt.replace(/^[*\-#]+\s*/gm, '').replace(/\*\*/g, '').trim();

    document.getElementById('analyse-voice-text').textContent = voicePrompt;
    document.getElementById('analyse-style-text').textContent = stylePrompt;
    results.classList.add('visible');

    // Cleanup: delete uploaded file from Gemini
    try { await fetch(`https://generativelanguage.googleapis.com/v1beta/${fileData.file.name}?key=${geminiApiKey}`, { method: 'DELETE' }); } catch(e) {}

  } catch (err) {
    alert('Analysis failed: ' + err.message);
  } finally {
    goBtn.disabled = false;
    goBtn.textContent = '🔬 Analyse Song';
    progress.classList.remove('visible');
  }
}

// ============================================================
// EVENT LISTENERS
// ============================================================
function setupEventListeners() {
  // Theme toggle
  const themeBtn = document.getElementById('theme-toggle');
  {
    const data = {};
    try { if (localStorage.getItem("theme")) data.theme = JSON.parse(localStorage.getItem("theme")); } catch(e) {}
    if (data.theme === 'light') {
      document.documentElement.classList.add('light');
      themeBtn.textContent = '☀️';
    }
  }
  themeBtn.addEventListener('click', () => {
    const isLight = document.documentElement.classList.toggle('light');
    themeBtn.textContent = isLight ? '☀️' : '🌙';
    localStorage.setItem("theme", JSON.stringify(isLight ? 'light' : 'dark'));
  });

  // Tabs
  document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => switchTab(tab.dataset.tab));
  });
  
  // Search
  document.getElementById('search-input').addEventListener('input', () => {
    if (currentTab === 'genres') renderBlueprintContent();
    else renderArtists();
  });
  
  // Mood filter chips
  document.getElementById('mood-chips').addEventListener('click', (e) => {
    const chip = e.target.closest('.mood-chip');
    if (!chip) return;
    document.querySelectorAll('.mood-chip').forEach(c => c.classList.remove('active'));
    chip.classList.add('active');
    activeMood = chip.dataset.mood;
    renderArtists();
  });
  
  // Random
  document.getElementById('randomBtn').addEventListener('click', () => {
    const a = ARTISTS[Math.floor(Math.random() * ARTISTS.length)];
    copyToClipboard(a.blueprint, document.getElementById('randomBtn'), `Random: ${a.name}`);
    document.getElementById('search-input').value = a.name;
    activeGenre = 'All';
    document.querySelectorAll('.genre-pill').forEach(p => p.classList.toggle('active', p.dataset.genre === 'All'));
    renderArtists();
  });
  
  // Batch count
  document.querySelectorAll('.count-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.count-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      selectedCount = parseInt(btn.dataset.count);
      document.getElementById('custom-count').value = selectedCount;
    });
  });
  document.getElementById('custom-count').addEventListener('change', (e) => {
    selectedCount = Math.min(50, Math.max(1, parseInt(e.target.value) || 5));
    e.target.value = selectedCount;
    document.querySelectorAll('.count-btn').forEach(b => b.classList.toggle('active', parseInt(b.dataset.count) === selectedCount));
  });
  
  // Paste prompt
  document.getElementById('pastePromptBtn').addEventListener('click', async () => {
    const input = document.getElementById('style-prompt');
    input.focus();
    try {
      // This will trigger browser permission prompt on first use
      const text = await navigator.clipboard.readText();
      if (text) {
        input.value = text;
        input.focus();
        return;
      }
    } catch(e) {
      // Permission denied or not available — show hint
      input.placeholder = '⌨ Press Ctrl+V (or Cmd+V) to paste...';
      setTimeout(() => { input.placeholder = 'Paste a style prompt — or choose an artist above'; }, 3000);
    }
  });
  
  // Generate
  document.getElementById('generate-btn').addEventListener('click', () => generateBatch(false));
  document.getElementById('add-more-btn').addEventListener('click', () => generateBatch(true));
  
  // Copy All Songs
  document.getElementById('copy-all-songs').addEventListener('click', () => {
    if (!generatedSongs.length) return;
    const text = generatedSongs.map((s, i) =>
      `── SONG ${i+1}: ${s.title} ──\nSTYLE: ${s.style}\n\nLYRICS:\n${s.lyrics}`
    ).join('\n\n' + '═'.repeat(50) + '\n\n');
    clipCopy(text);
    flashBtn(document.getElementById('copy-all-songs'), '✓ Copied!');
  });

  // Open in Suno — copies first uncoped style prompt then opens suno.com/create
  document.getElementById('open-in-suno').addEventListener('click', () => {
    if (!generatedSongs.length) return;
    const btn = document.getElementById('open-in-suno');

    // Find first song that hasn't been copied yet, fallback to first song
    const targetSong = generatedSongs.find(s => !s._copied) || generatedSongs[0];
    const promptToCopy = targetSong.style || '';

    if (promptToCopy) {
      clipCopy(promptToCopy).then(() => {
        btn.textContent = '✓ Style copied — opening Suno…';
        btn.classList.add('copied');
        // Mark as copied
        targetSong._copied = true;
        setTimeout(() => {
          btn.textContent = '🎵 Open in Suno';
          btn.classList.remove('copied');
        }, 2500);
      }).catch(() => {});
    }

    // Open Suno in new tab regardless of clipboard success
    window.open('', '_blank');
  });

  // Example prompt chips
  document.getElementById('example-chips').addEventListener('click', (e) => {
    const chip = e.target.closest('.example-chip');
    if (!chip) return;
    document.getElementById('style-prompt').value = chip.dataset.prompt;
    document.getElementById('style-prompt').focus();
  });
  
  // Export
  document.getElementById('export-json').addEventListener('click', exportJSON);
  document.getElementById('export-txt').addEventListener('click', exportTXT);

}

// ============================================================
// FAVORITES
// ============================================================
function saveFavorites() {
  // Sync favoritesOrder with current favorites set
  // Keep existing order, append any new keys, remove deleted ones
  const currentKeys = [...favorites];
  favoritesOrder = favoritesOrder.filter(k => favorites.has(k));
  currentKeys.forEach(k => { if (!favoritesOrder.includes(k)) favoritesOrder.push(k); });
  localStorage.setItem("favorites", JSON.stringify([...favorites])); localStorage.setItem("favoritesNotes", JSON.stringify(favoritesNotes)); localStorage.setItem("favoritesOrder", JSON.stringify(favoritesOrder));
}

function toggleFavoriteItem(key, type) {
  if (favorites.has(key)) {
    favorites.delete(key);
  } else {
    favorites.add(key);
    favoritesOrder.push(key);
  }
  saveFavorites();
}

// ============================================================
// FAVORITES PANEL — with sort, filter by type, notes/edit
// ============================================================
function renderFavorites() {
  const container = document.getElementById('fav-content');

  // Gather all favorites
  const favArtists = ARTISTS.filter(a => favorites.has('artist:' + a.name));
  const favBPs = [];
  favorites.forEach(key => {
    if (key.startsWith('bp:')) {
      const parts = key.split(':');
      const genre = parts[1];
      const idx = parseInt(parts[2]);
      if (GENRE_BPS[genre] && GENRE_BPS[genre][idx]) {
        favBPs.push({ key, genre, idx, bp: GENRE_BPS[genre][idx] });
      }
    }
  });

  const total = favArtists.length + favBPs.length;

  if (total === 0) {
    container.innerHTML = `<div class="fav-empty">
      <div class="fav-empty-icon">★</div>
      <div class="fav-empty-text">No favorites yet</div>
      <div class="fav-empty-hint">Star any artist on the Artists tab, or any blueprint on the Blueprints tab to save them here.</div>
    </div>`;
    return;
  }

  // Build unified item list for sorting
  let allItems = [];
  favArtists.forEach(a => allItems.push({
    key: 'artist:' + a.name,
    type: 'artist',
    name: a.name,
    genre: a.genre,
    color: GENRE_COLORS[a.genre] || '#888',
    prompt: a.blueprint,
    sub: `${a.genre} · ${a.bpm} BPM`,
    initials: a.name.split(' ').map(w => w[0]).join('').substring(0,2).toUpperCase(),
    orderIdx: favoritesOrder.indexOf('artist:' + a.name),
  }));
  favBPs.forEach(({ key, genre, idx, bp }) => allItems.push({
    key,
    type: 'blueprint',
    name: bp.name,
    genre,
    color: GENRE_COLORS_BP[genre] || '#888',
    prompt: bp.prompt,
    sub: genre + (extractBPM(bp.prompt) ? ` · ${extractBPM(bp.prompt)} BPM` : ''),
    initials: genre.substring(0,2).toUpperCase(),
    orderIdx: favoritesOrder.indexOf(key),
  }));

  // Apply type filter
  let filtered = allItems;
  if (favFilterType === 'artists') filtered = allItems.filter(i => i.type === 'artist');
  if (favFilterType === 'blueprints') filtered = allItems.filter(i => i.type === 'blueprint');

  // Apply sort
  if (favSortMode === 'recent') {
    filtered.sort((a, b) => {
      const ai = a.orderIdx < 0 ? Infinity : a.orderIdx;
      const bi = b.orderIdx < 0 ? Infinity : b.orderIdx;
      return bi - ai; // Most recently added first
    });
  } else if (favSortMode === 'alpha') {
    filtered.sort((a, b) => a.name.localeCompare(b.name));
  } else if (favSortMode === 'genre') {
    filtered.sort((a, b) => a.genre.localeCompare(b.genre) || a.name.localeCompare(b.name));
  }

  // Toolbar
  const toolbar = `<div class="fav-toolbar">
    <div class="fav-filter-tabs">
      <div class="fav-filter-tab ${favFilterType==='all'?'active':''}" data-filter="all">All (${total})</div>
      <div class="fav-filter-tab ${favFilterType==='artists'?'active':''}" data-filter="artists">Artists (${favArtists.length})</div>
      <div class="fav-filter-tab ${favFilterType==='blueprints'?'active':''}" data-filter="blueprints">Blueprints (${favBPs.length})</div>
    </div>
    <div class="fav-sort-row">
      <span class="fav-sort-label">Sort:</span>
      <div class="fav-sort-btn ${favSortMode==='recent'?'active':''}" data-sort="recent">Recent</div>
      <div class="fav-sort-btn ${favSortMode==='alpha'?'active':''}" data-sort="alpha">A–Z</div>
      <div class="fav-sort-btn ${favSortMode==='genre'?'active':''}" data-sort="genre">Genre</div>
    </div>
  </div>`;

  // Cards
  const cards = filtered.map(item => {
    const note = favoritesNotes[item.key] || '';
    const isEditingNote = editingNoteKey === item.key;
    const typeBadge = item.type === 'blueprint'
      ? `<span class="fav-type-pill" style="background:${item.color}22;color:${item.color};border-color:${item.color}44">Blueprint</span>`
      : `<span class="fav-type-pill artist-pill">Artist</span>`;

    return `<div class="fav-card" data-key="${item.key}">
      <div class="fav-card-top">
        <div class="fav-card-avatar" style="background:${item.color}33;color:${item.color}">${item.initials}</div>
        <div class="fav-card-info">
          <div class="fav-card-name">${item.name}</div>
          <div class="fav-card-sub">${typeBadge}<span style="color:var(--dim);font-size:10px">${item.sub}</span></div>
        </div>
        <div class="fav-card-btns">
          <button class="fav-note-btn ${note ? 'has-note' : ''}" data-key="${item.key}" title="${note ? 'Edit note' : 'Add note'}">📝</button>
          <button class="fav-card-unstar" data-key="${item.key}" title="Remove from favorites">★</button>
        </div>
      </div>
      ${note && !isEditingNote ? `<div class="fav-note-display" data-key="${item.key}">${note}</div>` : ''}
      ${isEditingNote ? `<div class="fav-note-editor">
        <textarea class="fav-note-input" data-key="${item.key}" placeholder="Add a note, tag, or reminder...">${note}</textarea>
        <div class="fav-note-actions">
          <button class="fav-note-save" data-key="${item.key}">Save</button>
          <button class="fav-note-cancel" data-key="${item.key}">Cancel</button>
          ${note ? `<button class="fav-note-delete" data-key="${item.key}">Delete note</button>` : ''}
        </div>
      </div>` : ''}
      <div class="fav-card-preview">${item.prompt.substring(0, 140)}${item.prompt.length > 140 ? '…' : ''}</div>
      <div class="fav-card-actions">
        <button class="fav-action-btn copy" data-prompt="${encodeURIComponent(item.prompt)}" data-name="${item.name}" data-color="${item.color}" data-sub="${item.sub}">📋 Copy</button>
        <button class="fav-action-btn send" data-prompt="${encodeURIComponent(item.prompt)}">⚡ Batch</button>
      </div>
    </div>`;
  }).join('');

  container.innerHTML = toolbar + `<div class="fav-grid">${cards}</div>`;

  // Filter tabs
  container.querySelectorAll('.fav-filter-tab').forEach(tab => {
    tab.addEventListener('click', () => { favFilterType = tab.dataset.filter; renderFavorites(); });
  });

  // Sort buttons
  container.querySelectorAll('.fav-sort-btn').forEach(btn => {
    btn.addEventListener('click', () => { favSortMode = btn.dataset.sort; renderFavorites(); });
  });

  // Unstar
  container.querySelectorAll('.fav-card-unstar').forEach(btn => {
    btn.addEventListener('click', () => {
      favorites.delete(btn.dataset.key);
      delete favoritesNotes[btn.dataset.key];
      saveFavorites();
      renderFavorites();
    });
  });

  // Note button — toggle editor
  container.querySelectorAll('.fav-note-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      editingNoteKey = editingNoteKey === btn.dataset.key ? null : btn.dataset.key;
      renderFavorites();
    });
  });

  // Note display click — open editor
  container.querySelectorAll('.fav-note-display').forEach(el => {
    el.addEventListener('click', () => { editingNoteKey = el.dataset.key; renderFavorites(); });
  });

  // Note save
  container.querySelectorAll('.fav-note-save').forEach(btn => {
    btn.addEventListener('click', () => {
      const textarea = container.querySelector(`.fav-note-input[data-key="${btn.dataset.key}"]`);
      if (textarea) {
        const val = textarea.value.trim();
        if (val) favoritesNotes[btn.dataset.key] = val;
        else delete favoritesNotes[btn.dataset.key];
        saveFavorites();
      }
      editingNoteKey = null;
      renderFavorites();
    });
  });

  // Note cancel
  container.querySelectorAll('.fav-note-cancel').forEach(btn => {
    btn.addEventListener('click', () => { editingNoteKey = null; renderFavorites(); });
  });

  // Note delete
  container.querySelectorAll('.fav-note-delete').forEach(btn => {
    btn.addEventListener('click', () => {
      delete favoritesNotes[btn.dataset.key];
      saveFavorites();
      editingNoteKey = null;
      renderFavorites();
    });
  });

  // Copy
  container.querySelectorAll('.fav-action-btn.copy').forEach(btn => {
    btn.addEventListener('click', () => {
      const text = decodeURIComponent(btn.dataset.prompt);
      const color = btn.dataset.color || '#888';
      copyToClipboard(text, btn, `Copied: ${btn.dataset.name}`, {
        name: btn.dataset.name,
        type: `Favorite · ${btn.dataset.sub || ''}`,
        color
      });
    });
  });

  // Send to batch
  container.querySelectorAll('.fav-action-btn.send').forEach(btn => {
    btn.addEventListener('click', () => {
      document.getElementById('style-prompt').value = decodeURIComponent(btn.dataset.prompt);
      switchTab('batch');
    });
  });
}



// ============================================================
// LLM API FUNCTIONS (merged from background.js)
// ============================================================
// ── SHARED PROMPTS ──
function buildSystemPrompt() {
  return `You are one of the world's greatest songwriters — a Grammy-winning, chart-topping composer fluent in every genre. You write complete, professional song lyrics that sound like they were written by a human hitmaker who deeply understands the specific style requested.

CRITICAL RULE: You must write lyrics that authentically match the SPECIFIC genre, mood, and style in the prompt. Read every descriptor and reflect it in the lyrics:
- "trap" / "808" / "drill" → street imagery, flex, bars with internal rhyme
- "folk" / "singer-songwriter" / "acoustic" → intimate story-driven verses, plain honest language
- "metal" / "thrash" / "death metal" → aggressive, powerful, mythological or raw anger imagery
- "jazz" / "late night" / "saxophone" → sophisticated, atmospheric, bittersweet, city at night
- "gospel" / "worship" / "praise" → faith-based, devotional, victory through grace
- "reggae" / "roots" / "one-drop" → conscious, Rastafari positive, roots and culture
- "K-pop" / "idol" / "kpop" → energetic, romantic, highly melodic, emotional hooks
- "punk" / "hardcore" / "pop-punk" → short punchy fast lines, anti-establishment attitude
- "country" / "honky-tonk" / "Americana" → storytelling, plain truths, Southern imagery
- "R&B" / "soul" / "neo-soul" → sensual, intimate, emotional vulnerability
- "pop" → catchy, universal emotional themes, radio polish
- Artist references (e.g. "Drake style") → mirror that artist's themes, voice, and imagery

Song requirements:
- REAL rhyme schemes varying by genre (ABAB, AABB, ABCB)
- NARRATIVE ARC: opening situation, development, turn, resolution
- AUTHENTIC genre-specific imagery and phrasing throughout
- MEMORABLE hooks that could be sung back
- Natural syllable rhythm that fits the BPM context
- Genre-appropriate section structure

Output format — valid JSON only:
{
  "title": "Song Title",
  "style": "MUST be copied EXACTLY from the input style prompt — do not change a single word",
  "lyrics": "full lyrics with appropriate Suno section tags",
  "instrumental": false
}

Section tag guide by genre:
- Pop/R&B: [Verse 1], [Pre-Chorus], [Chorus], [Verse 2], [Bridge], [Outro]
- Hip-Hop: [Verse 1], [Hook], [Verse 2], [Bridge] or [Verse 3]
- Metal/Rock: [Verse 1], [Chorus], [Bridge], [Guitar Solo], [Outro]
- Folk/Country: [Verse 1], [Chorus], [Verse 2], [Bridge], [Outro]
- Gospel: [Verse 1], [Chorus], [Bridge], [Tag], [Outro]
- Jazz: [Verse 1], [Chorus], [Bridge], [Instrumental], [Outro]
- Punk: [Verse 1], [Chorus], [Verse 2], [Bridge], [Outro]
- K-pop: [Verse 1], [Pre-Chorus], [Chorus], [Verse 2], [Bridge], [Outro]

IMPORTANT: Return ONLY a raw JSON array. No markdown fences, no explanation, no preamble.`;
}

function buildUserPrompt(stylePrompt, count, existingTitles) {
  return `Style prompt: "${stylePrompt}"

Write ${count} completely unique, professional songs that authentically capture this exact style. Every lyric should feel like it belongs specifically in this genre and mood.

Rules:
- Each song has a different emotional theme or narrative
- Every opening line is unique — never repeat first lines
- Vary the song structure across the batch
- Make each song feel genuinely distinct, not a template swap

Avoid these already-used titles: ${existingTitles.length ? existingTitles.join(', ') : 'none'}
Uniqueness seed: ${Date.now()}-${Math.random()}

Return a JSON array of exactly ${count} song objects.
CRITICAL: The "style" field in every song object must be copied EXACTLY from the style prompt given above. Do not paraphrase, shorten, or change it in any way.`;
}

function parseResponse(text) {
  const clean = text.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
  return JSON.parse(clean);
}

// ── ROUTER ──
async function handleGenerate({ llm, apiKey, openaiApiKey, geminiApiKey, langInstruction, stylePrompt, count, existingTitles }) {
  if (llm === 'gemini' && geminiApiKey) {
    return generateWithGemini(geminiApiKey, stylePrompt, count, existingTitles, langInstruction);
  }
  if (llm === 'openai' && openaiApiKey) {
    return generateWithOpenAI(openaiApiKey, stylePrompt, count, existingTitles, langInstruction);
  }
  if (llm === 'claude' && apiKey) {
    return generateWithClaude(apiKey, stylePrompt, count, existingTitles, langInstruction);
  }
  return { error: 'NO_KEY' };
}

// ── CLAUDE ──
async function generateWithClaude(apiKey, stylePrompt, count, existingTitles, langInstruction) {
  const response = await fetch('https://api.anthropic.com/v1/messages', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'x-api-key': apiKey,
      'anthropic-version': '2023-06-01'
    },
    body: JSON.stringify({
      model: 'claude-sonnet-4-6',
      max_tokens: 12000,
      system: buildSystemPrompt() + (langInstruction || ''),
      messages: [{ role: 'user', content: buildUserPrompt(stylePrompt, count, existingTitles) }]
    })
  });
  if (!response.ok) {
    const e = await response.json();
    throw new Error(`Claude: ${e.error?.message || response.status}`);
  }
  const data = await response.json();
  return { songs: parseResponse(data.content[0].text) };
}

// ── OPENAI ──
async function generateWithOpenAI(apiKey, stylePrompt, count, existingTitles, langInstruction) {
  const response = await fetch('https://api.openai.com/v1/chat/completions', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${apiKey}`
    },
    body: JSON.stringify({
      model: 'gpt-4o',
      max_tokens: 12000,
      messages: [
        { role: 'system', content: buildSystemPrompt() + (langInstruction || '') },
        { role: 'user',   content: buildUserPrompt(stylePrompt, count, existingTitles) }
      ]
    })
  });
  if (!response.ok) {
    const e = await response.json();
    throw new Error(`OpenAI: ${e.error?.message || response.status}`);
  }
  const data = await response.json();
  return { songs: parseResponse(data.choices[0].message.content) };
}

// ── GEMINI ──
async function generateWithGemini(apiKey, stylePrompt, count, existingTitles, langInstruction) {
  const prompt = buildSystemPrompt() + (langInstruction || '') + '\n\n' + buildUserPrompt(stylePrompt, count, existingTitles);

  // First, discover which models are actually available for this key
  let availableModels = [];
  try {
    const listResp = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`,
      { method: 'GET', headers: { 'Content-Type': 'application/json' } }
    );
    const listData = await listResp.json();
    if (listData.models) {
      availableModels = listData.models
        .filter(m => m.supportedGenerationMethods?.includes('generateContent'))
        .map(m => m.name.replace('models/', ''))
        // Prefer flash models (free/fast), skip embedding/vision-only models
        .filter(m => m.includes('flash') || m.includes('pro'))
        .sort((a, b) => {
          // Prefer gemini-2 over gemini-1, flash over pro
          const score = m => (m.includes('2.0') ? 10 : m.includes('1.5') ? 5 : 1) + (m.includes('flash') ? 2 : 0);
          return score(b) - score(a);
        });
    }
  } catch(e) {
    // Can't list — fall back to hardcoded attempts
  }

  // If discovery worked use those, otherwise try known names
  const modelsToTry = availableModels.length > 0 ? availableModels : [
    'gemini-2.0-flash',
    'gemini-2.0-flash-lite',
    'gemini-1.5-flash-001',
    'gemini-1.5-flash-8b',
    'gemini-pro'
  ];

  let lastError = '';
  for (const model of modelsToTry) {
    try {
      const response = await fetch(
        `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{ parts: [{ text: prompt }] }],
            generationConfig: { maxOutputTokens: 8192, temperature: 0.9 }
          })
        }
      );

      const data = await response.json();
      if (!response.ok) {
        lastError = data.error?.message || `HTTP ${response.status}`;
        continue;
      }

      const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
      if (!text) { lastError = 'Empty response'; continue; }

      return { songs: parseResponse(text) };
    } catch(e) {
      lastError = e.message;
      continue;
    }
  }

  throw new Error(`Gemini: No working model found (tried: ${modelsToTry.slice(0,3).join(', ')}). Last error: ${lastError}`);
}

// ── ANALYSE SONG ──
const ANALYSE_PROMPT = `You are an expert music producer, vocal coach, and audio engineer. Analyze this audio track and produce two separate, copy-ready prompts for Suno AI music generation.

OUTPUT FORMAT — respond with EXACTLY this structure and nothing else:

VOICE PROMPT:
[A single comma-separated prompt string describing: vocal tone, vocal texture, delivery style, cadence/flow, vocal effects (reverb, autotune, distortion, etc.), mic style (close/room/lo-fi), era feel, gender, approximate vocal range, breath control, emotional quality, any signature vocal techniques like falsetto, growl, whisper, ad-libs, vocal layering]

SONG STYLE PROMPT:
[A single comma-separated prompt string describing: estimated BPM, key feel (major/minor/modal), primary genre and sub-genre blend, main instruments, arrangement structure (sparse vs dense, build patterns), production texture (clean/gritty/lo-fi/polished), mix character (wide/mono/compressed/dynamic), drum style, bass character, any notable production techniques like sidechain, filtering, sampling, specific effects]

RULES:
- Each prompt must be a SINGLE LINE of comma-separated descriptors — no bullets, no numbered lists, no paragraphs
- Be SPECIFIC — don't say "good vocals", say "breathy mid-range alto with subtle vibrato and close-mic intimacy"
- Include BPM estimate in the style prompt
- These prompts will be pasted directly into Suno, so make them production-ready
- Focus on what makes this track's sound UNIQUE and IDENTIFIABLE`;

async function handleAnalyseSong({ geminiApiKey, audioBase64, mimeType, fileName }) {
  if (!geminiApiKey) throw new Error('Gemini API key required for analysis');
  if (!audioBase64) throw new Error('No audio data provided');

  // Convert base64 to binary for upload
  const binaryStr = atob(audioBase64);
  const bytes = new Uint8Array(binaryStr.length);
  for (let i = 0; i < binaryStr.length; i++) bytes[i] = binaryStr.charCodeAt(i);

  // Step 1: Start resumable upload
  const startResp = await fetch(
    `https://generativelanguage.googleapis.com/upload/v1beta/files?key=${geminiApiKey}`,
    {
      method: 'POST',
      headers: {
        'X-Goog-Upload-Protocol': 'resumable',
        'X-Goog-Upload-Command': 'start',
        'X-Goog-Upload-Header-Content-Length': bytes.length,
        'X-Goog-Upload-Header-Content-Type': mimeType,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ file: { display_name: fileName } })
    }
  );

  if (!startResp.ok) {
    const err = await startResp.json().catch(() => ({}));
    throw new Error(err.error?.message || `Upload init failed: ${startResp.status}`);
  }

  const uploadUrl = startResp.headers.get('X-Goog-Upload-URL');
  if (!uploadUrl) throw new Error('No upload URL returned from Gemini');

  // Step 2: Upload file bytes
  const uploadResp = await fetch(uploadUrl, {
    method: 'POST',
    headers: {
      'Content-Length': bytes.length,
      'X-Goog-Upload-Offset': '0',
      'X-Goog-Upload-Command': 'upload, finalize'
    },
    body: bytes.buffer
  });

  if (!uploadResp.ok) {
    const err = await uploadResp.json().catch(() => ({}));
    throw new Error(err.error?.message || `Upload failed: ${uploadResp.status}`);
  }

  const fileData = await uploadResp.json();
  const fileUri = fileData.file?.uri;
  if (!fileUri) throw new Error('No file URI returned');

  // Step 3: Wait for processing
  let fileState = fileData.file?.state;
  let attempts = 0;
  while (fileState === 'PROCESSING' && attempts < 60) {
    await new Promise(r => setTimeout(r, 2000));
    const checkResp = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/${fileData.file.name}?key=${geminiApiKey}`
    );
    const checkInfo = await checkResp.json();
    fileState = checkInfo.state;
    attempts++;
  }
  if (fileState !== 'ACTIVE') throw new Error('File processing failed. Try MP3 format or a shorter clip.');

  // Step 4: Analyse with Gemini using file_data reference (tiny request)
  const modelsToTry = [
    'gemini-2.5-flash',
    'gemini-2.0-flash',
    'gemini-2.0-flash-lite',
    'gemini-1.5-flash-001',
    'gemini-pro'
  ];

  let lastError = '';
  for (const model of modelsToTry) {
    try {
      const response = await fetch(
        `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${geminiApiKey}`,
        {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{
              parts: [
                { file_data: { mime_type: mimeType, file_uri: fileUri } },
                { text: ANALYSE_PROMPT }
              ]
            }],
            generationConfig: { maxOutputTokens: 2048, temperature: 0.4 }
          })
        }
      );

      const data = await response.json();
      if (!response.ok) { lastError = data.error?.message || `HTTP ${response.status}`; continue; }

      const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
      if (!text) { lastError = 'Empty response'; continue; }

      // Cleanup: delete uploaded file
      try { await fetch(`https://generativelanguage.googleapis.com/v1beta/${fileData.file.name}?key=${geminiApiKey}`, { method: 'DELETE' }); } catch(e) {}

      return { result: text };
    } catch(e) { lastError = e.message; continue; }
  }

  throw new Error(`Analysis failed — no working Gemini model. Last error: ${lastError}`);
}

// ============================================================
// RELEASE PLANNER TAB
// ============================================================

const RP = {
  tracks: [],
  settings: JSON.parse(localStorage.getItem('rp_settings') || '{}'),

  init() {
    // Load saved data
    this.tracks = JSON.parse(localStorage.getItem('rp_tracks') || '[]');
    this.settings = JSON.parse(localStorage.getItem('rp_settings') || '{}');

    // Populate settings fields
    if (this.settings.artist) document.getElementById('rp-artist').value = this.settings.artist;
    if (this.settings.label) document.getElementById('rp-label').value = this.settings.label;
    if (this.settings.genre) document.getElementById('rp-genre').value = this.settings.genre;
    if (this.settings.language) document.getElementById('rp-language').value = this.settings.language;
    if (this.settings.releaseDate) document.getElementById('rp-release-date').value = this.settings.releaseDate;
    if (this.settings.swFirst) document.getElementById('rp-sw-first').value = this.settings.swFirst;
    if (this.settings.swMiddle) document.getElementById('rp-sw-middle').value = this.settings.swMiddle;
    if (this.settings.swLast) document.getElementById('rp-sw-last').value = this.settings.swLast;
    if (this.settings.swRole) document.getElementById('rp-sw-role').value = this.settings.swRole;
    if (this.settings.albumTitle) document.getElementById('rp-album-title').value = this.settings.albumTitle;

    // Set default release date to next Friday
    if (!this.settings.releaseDate) {
      const d = new Date();
      d.setDate(d.getDate() + ((5 - d.getDay() + 7) % 7 || 7) + 7); // next-next Friday
      document.getElementById('rp-release-date').value = d.toISOString().split('T')[0];
    }

    // Bind events
    this.bindEvents();
    this.render();
  },

  bindEvents() {
    // Settings auto-save
    ['rp-artist','rp-label','rp-genre','rp-language','rp-release-date','rp-sw-first','rp-sw-middle','rp-sw-last','rp-sw-role','rp-album-title'].forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.addEventListener('input', () => this.saveSettings());
        el.addEventListener('change', () => this.saveSettings());
      }
    });

    // Upload files
    document.getElementById('rp-add-files').addEventListener('click', () => {
      document.getElementById('rp-file-input').click();
    });
    document.getElementById('rp-file-input').addEventListener('change', (e) => {
      this.addFiles(Array.from(e.target.files));
      e.target.value = '';
    });

    // Add from batch
    document.getElementById('rp-add-from-batch').addEventListener('click', () => {
      this.addFromBatch();
    });

    // Clear all
    document.getElementById('rp-clear-all').addEventListener('click', () => {
      if (this.tracks.length === 0) return;
      if (confirm('Remove all tracks from the release?')) {
        this.tracks = [];
        this.save();
        this.render();
      }
    });

    // Release type toggle
    document.querySelectorAll('.rp-toggle-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.rp-toggle-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
      });
    });

    // Export buttons
    document.getElementById('rp-export-dk').addEventListener('click', () => this.exportForDistroKid());
    document.getElementById('rp-copy-meta').addEventListener('click', () => this.copyMetadata());
    document.getElementById('rp-download-lyrics').addEventListener('click', () => this.downloadLyrics());
    document.getElementById('rp-download-json').addEventListener('click', () => this.downloadJSON());
  },

  saveSettings() {
    this.settings = {
      artist: document.getElementById('rp-artist').value,
      label: document.getElementById('rp-label').value,
      genre: document.getElementById('rp-genre').value,
      language: document.getElementById('rp-language').value,
      releaseDate: document.getElementById('rp-release-date').value,
      swFirst: document.getElementById('rp-sw-first').value,
      swMiddle: document.getElementById('rp-sw-middle').value,
      swLast: document.getElementById('rp-sw-last').value,
      swRole: document.getElementById('rp-sw-role').value,
      albumTitle: document.getElementById('rp-album-title').value,
    };
    localStorage.setItem('rp_settings', JSON.stringify(this.settings));
    this.updateAutoFields();
    this.updateTopBar();
  },

  save() {
    // Save tracks (without audio file blobs — those are in memory only)
    const saveable = this.tracks.map(t => ({
      title: t.title, genre: t.genre, bpm: t.bpm, explicit: t.explicit,
      lyrics: t.lyrics, duration: t.duration, audioFileName: t.audioFileName,
      audioFileSize: t.audioFileSize, audioFileType: t.audioFileType, source: t.source
    }));
    localStorage.setItem('rp_tracks', JSON.stringify(saveable));
  },

  addTrack(track) {
    this.tracks.push(track);
    this.save();
    this.render();
  },

  removeTrack(index) {
    this.tracks.splice(index, 1);
    this.save();
    this.render();
  },

  addFiles(files) {
    files.forEach(file => {
      const ext = file.name.split('.').pop().toUpperCase();
      const name = file.name.replace(/\.[^/.]+$/, '').replace(/[-_]/g, ' ');
      const sizeMB = (file.size / 1024 / 1024).toFixed(1);

      const track = {
        title: name,
        genre: '',
        bpm: null,
        explicit: false,
        lyrics: '',
        duration: null,
        audioFileName: file.name,
        audioFileSize: sizeMB + ' MB',
        audioFileType: ext.toLowerCase(),
        audioFile: file, // Keep reference in memory
        source: 'upload'
      };

      // Get duration
      const audio = new Audio();
      audio.src = URL.createObjectURL(file);
      audio.addEventListener('loadedmetadata', () => {
        const min = Math.floor(audio.duration / 60);
        const sec = Math.floor(audio.duration % 60);
        track.duration = min + ':' + String(sec).padStart(2, '0');
        URL.revokeObjectURL(audio.src);
        this.save();
        this.render();
      });

      this.tracks.push(track);
    });
    this.save();
    this.render();
    this.showToast('✓ ' + files.length + ' file(s) added');
  },

  addFromBatch() {
    // Pull the last generated songs from batch state
    const batchOutput = document.getElementById('batch-output');
    if (!batchOutput) { this.showToast('⚠ Generate songs in Batch tab first'); return; }

    const songCards = batchOutput.querySelectorAll('.song-card');
    if (!songCards.length) { this.showToast('⚠ No songs in Batch tab — generate some first'); return; }

    let added = 0;
    songCards.forEach(card => {
      const titleEl = card.querySelector('.song-title, h3, strong');
      const title = titleEl ? titleEl.textContent.trim() : 'Untitled';

      // Check if already added
      if (this.tracks.some(t => t.title === title)) return;

      // Try to extract genre and BPM from the card
      const cardText = card.textContent;
      const bpmMatch = cardText.match(/(\d{2,3})\s*bpm/i);
      const bpm = bpmMatch ? parseInt(bpmMatch[1]) : null;

      // Get lyrics if available
      let lyrics = '';
      const lyricsEl = card.querySelector('.song-lyrics, pre, .lyrics-text');
      if (lyricsEl) lyrics = lyricsEl.textContent.trim();

      // Get style prompt for genre
      let genre = '';
      const styleEl = card.querySelector('.song-style, .style-prompt');
      if (styleEl) genre = styleEl.textContent.trim().substring(0, 40);

      this.tracks.push({
        title, genre, bpm, explicit: false, lyrics, duration: null,
        audioFileName: null, audioFileSize: null, audioFileType: null,
        audioFile: null, source: 'batch'
      });
      added++;
    });

    this.save();
    this.render();
    this.showToast(added > 0 ? '✓ ' + added + ' songs added from Batch' : '⚠ Songs already in tracklist');
  },

  render() {
    const list = document.getElementById('rp-tracklist');
    const empty = document.getElementById('rp-empty');

    if (this.tracks.length === 0) {
      list.innerHTML = '';
      list.appendChild(empty);
      empty.style.display = 'block';
    } else {
      if (empty) empty.style.display = 'none';
      list.innerHTML = this.tracks.map((t, i) => {
        const num = String(i + 1).padStart(2, '0');
        const hasFile = !!t.audioFileName;
        const borderStyle = hasFile ? (t.audioFileType === 'wav' ? 'border-left:2px solid #f472b6' : 'border-left:2px solid #0088ff') : '';
        const hasLyrics = !!(t.lyrics && t.lyrics.trim());
        return `<div class="rp-track-card" style="${borderStyle}" data-idx="${i}">
          <span class="rp-track-num">${num}</span>
          <button class="rp-track-remove" data-idx="${i}" title="Remove">✕</button>
          <input class="rp-track-title-input" data-idx="${i}" value="${(t.title || '').replace(/"/g, '&quot;')}" placeholder="Track title...">
          <div class="rp-track-meta">
            ${t.bpm ? `<span class="rp-track-bpm">${t.bpm} BPM</span>` : ''}
            <button class="rp-track-explicit-toggle ${t.explicit ? 'on' : ''}" data-idx="${i}" title="Toggle explicit">${t.explicit ? '🔞 EXPLICIT' : '✅ CLEAN'}</button>
            <button class="rp-track-lyrics-toggle ${hasLyrics ? 'has' : ''}" data-idx="${i}" title="${hasLyrics ? 'Edit lyrics' : 'Add lyrics'}">${hasLyrics ? '📝 Lyrics ✓' : '📝 + Lyrics'}</button>
          </div>
          <div class="rp-track-lyrics-area" data-idx="${i}" style="display:none">
            <textarea class="rp-track-lyrics-input" data-idx="${i}" placeholder="Paste lyrics here...">${t.lyrics || ''}</textarea>
          </div>
          ${hasFile ? `<div class="rp-track-file-info">
            <span class="rp-track-file-badge ${t.audioFileType}">${t.audioFileType.toUpperCase()}</span>
            <span class="rp-track-file-size">${t.audioFileSize}</span>
            ${t.duration ? `<span class="rp-track-file-size">${t.duration}</span>` : ''}
          </div>` : ''}
        </div>`;
      }).join('');

      // Bind remove buttons
      list.querySelectorAll('.rp-track-remove').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const idx = parseInt(btn.dataset.idx);
          this.removeTrack(idx);
        });
      });

      // Bind title edits
      list.querySelectorAll('.rp-track-title-input').forEach(inp => {
        inp.addEventListener('change', () => {
          const idx = parseInt(inp.dataset.idx);
          this.tracks[idx].title = inp.value;
          this.save();
        });
      });

      // Bind explicit toggles
      list.querySelectorAll('.rp-track-explicit-toggle').forEach(btn => {
        btn.addEventListener('click', () => {
          const idx = parseInt(btn.dataset.idx);
          this.tracks[idx].explicit = !this.tracks[idx].explicit;
          this.save();
          this.render();
        });
      });

      // Bind lyrics toggle (expand/collapse textarea)
      list.querySelectorAll('.rp-track-lyrics-toggle').forEach(btn => {
        btn.addEventListener('click', () => {
          const idx = btn.dataset.idx;
          const area = list.querySelector(`.rp-track-lyrics-area[data-idx="${idx}"]`);
          area.style.display = area.style.display === 'none' ? 'block' : 'none';
          if (area.style.display === 'block') {
            area.querySelector('textarea').focus();
          }
        });
      });

      // Bind lyrics edits
      list.querySelectorAll('.rp-track-lyrics-input').forEach(ta => {
        ta.addEventListener('change', () => {
          const idx = parseInt(ta.dataset.idx);
          this.tracks[idx].lyrics = ta.value;
          this.save();
        });
      });
    }

    this.updateTopBar();
    this.updateAutoFields();
    this.updateCompleteness();
  },

  updateTopBar() {
    const count = this.tracks.length;
    const type = count === 0 ? '—' : count === 1 ? 'Single' : count <= 6 ? 'EP · ' + count + ' Tracks' : 'Album · ' + count + ' Tracks';
    document.getElementById('rp-type-badge').textContent = type;
    document.getElementById('rp-track-count').textContent = count;
    document.getElementById('rp-artist-display').textContent = this.settings.artist || '—';
    const d = this.settings.releaseDate;
    document.getElementById('rp-release-date-display').textContent = d ? new Date(d + 'T12:00:00').toLocaleDateString('en-US', { weekday:'short', month:'short', day:'numeric', year:'numeric' }) : '—';
  },

  updateAutoFields() {
    const artist = this.settings.artist || '—';
    const year = new Date().getFullYear();
    const explicitCount = this.tracks.filter(t => t.explicit).length;
    const durations = this.tracks.map(t => t.duration).filter(Boolean);
    const totalFields = this.completenessScore();

    document.getElementById('rp-auto-copyright').textContent = artist !== '—' ? `\u00A9 ${year} ${artist}` : '—';
    document.getElementById('rp-auto-explicit').textContent = this.tracks.length ?
      (explicitCount > 0 ? `${explicitCount} of ${this.tracks.length} explicit` : 'All clean') : '—';
    document.getElementById('rp-auto-duration').textContent = durations.length ? durations.join(', ') : '—';
    document.getElementById('rp-auto-completeness').textContent = totalFields.pct + '% ready';
    document.getElementById('rp-auto-completeness').style.color = totalFields.pct >= 80 ? '#00c851' : totalFields.pct >= 50 ? '#ffc947' : '#ff4d6d';
  },

  completenessScore() {
    let score = 0, total = 0;
    const check = (val) => { total++; if (val) score++; };
    check(this.settings.artist);
    check(this.settings.albumTitle);
    check(this.settings.genre);
    check(this.settings.releaseDate);
    check(this.settings.swFirst);
    check(this.settings.swLast);
    check(this.tracks.length > 0);
    this.tracks.forEach(t => {
      check(t.title);
      check(t.audioFileName);
    });
    const pct = total > 0 ? Math.round((score / total) * 100) : 0;
    return { score, total, pct };
  },

  updateCompleteness() {
    const c = this.completenessScore();
    document.getElementById('rp-completeness-fill').style.width = c.pct + '%';
    document.getElementById('rp-completeness-pct').textContent = c.pct + '%';
  },

  // ── Build payload for companion extension ──
  buildPayload() {
    const s = this.settings;
    const year = new Date().getFullYear();
    const songwriter = [s.swFirst, s.swMiddle, s.swLast].filter(Boolean).join(' ');
    return {
      artist: s.artist || '',
      albumTitle: s.albumTitle || '',
      label: s.label || 'Independent',
      genre: s.genre || '',
      language: s.language || 'English',
      releaseDate: s.releaseDate || '',
      songwriter: songwriter,
      songwriterFirst: s.swFirst || '',
      songwriterMiddle: s.swMiddle || '',
      songwriterLast: s.swLast || '',
      songwriterRole: s.swRole || 'Music and lyrics',
      copyright: `\u00A9 ${year} ${s.artist || ''}`,
      soundRecording: `\u2117 ${year} ${s.artist || ''}`,
      tracks: this.tracks.map((t, i) => ({
        trackNumber: i + 1,
        title: t.title || '',
        explicit: !!t.explicit,
        lyrics: t.lyrics || '',
        genre: t.genre || s.genre || '',
        bpm: t.bpm || null,
        duration: t.duration || null,
        audioFileName: t.audioFileName || null,
        songwriter: songwriter,
        isrc: null
      })),
      exportedAt: new Date().toISOString(),
      source: 'Sound Cloner v1.3',
      trackCount: this.tracks.length
    };
  },

  // ── EXPORTS ──
  async exportForDistroKid() {
    const btn = document.getElementById('rp-export-dk');
    const json = JSON.stringify(this.buildPayload(), null, 2);
    try {
      await navigator.clipboard.writeText(json);
      btn.textContent = '✓ Copied to Clipboard!';
      btn.style.background = '#00c851';
      this.showToast('✓ Release data copied — paste into companion extension on DistroKid');
    } catch(e) {
      const ta = document.createElement('textarea');
      ta.value = json; ta.style.position='fixed'; ta.style.left='-9999px';
      document.body.appendChild(ta); ta.select(); document.execCommand('copy');
      document.body.removeChild(ta);
      btn.textContent = '✓ Copied!';
      this.showToast('✓ Copied to clipboard');
    }
    setTimeout(() => { btn.textContent = '📦 Export for DistroKid'; btn.style.background = ''; }, 3000);
  },

  async copyMetadata() {
    const btn = document.getElementById('rp-copy-meta');
    const p = this.buildPayload();
    let text = `═══ ${p.albumTitle.toUpperCase()} ═══\nArtist: ${p.artist}\nLabel: ${p.label}\nGenre: ${p.genre}\nLanguage: ${p.language}\nRelease: ${p.releaseDate}\n${p.copyright}\nTracks: ${p.trackCount}\n\n`;
    p.tracks.forEach(t => {
      text += `${String(t.trackNumber).padStart(2,'0')}. ${t.title} [${t.genre}]${t.bpm ? ' '+t.bpm+'BPM' : ''} ${t.explicit?'[EXPLICIT]':'[CLEAN]'}${t.duration?' ('+t.duration+')':''}\n`;
    });
    try { await navigator.clipboard.writeText(text); } catch(e) {
      const ta = document.createElement('textarea'); ta.value=text; ta.style.position='fixed'; ta.style.left='-9999px';
      document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
    }
    btn.textContent = '✓ Copied!';
    this.showToast('✓ Metadata copied');
    setTimeout(() => { btn.textContent = '📋 Copy Metadata'; }, 2000);
  },

  downloadLyrics() {
    const btn = document.getElementById('rp-download-lyrics');
    const p = this.buildPayload();
    let text = `${p.albumTitle} — Lyrics\nArtist: ${p.artist}\n${'═'.repeat(40)}\n\n`;
    p.tracks.forEach(t => {
      text += `── Track ${String(t.trackNumber).padStart(2,'0')}: ${t.title} ──\n`;
      text += (t.lyrics || '[No lyrics yet]') + '\n\n';
    });
    const blob = new Blob([text], { type: 'text/plain' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = (p.albumTitle || 'release').replace(/[^a-zA-Z0-9 ]/g, '') + '-Lyrics.txt';
    a.click(); URL.revokeObjectURL(a.href);
    btn.textContent = '✓ Downloaded!';
    this.showToast('✓ Lyrics file downloaded');
    setTimeout(() => { btn.textContent = '📄 Lyrics (.txt)'; }, 2000);
  },

  downloadJSON() {
    const btn = document.getElementById('rp-download-json');
    const json = JSON.stringify(this.buildPayload(), null, 2);
    const blob = new Blob([json], { type: 'application/json' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = (this.settings.albumTitle || 'release').replace(/[^a-zA-Z0-9 ]/g, '') + '-distrokid.json';
    a.click(); URL.revokeObjectURL(a.href);
    btn.textContent = '✓ Downloaded!';
    this.showToast('✓ JSON file saved — import into companion extension');
    setTimeout(() => { btn.textContent = '💾 JSON File'; }, 2000);
  },

  showToast(text) {
    const t = document.getElementById('rp-toast');
    t.textContent = text;
    t.style.opacity = '1';
    t.style.transform = 'translateX(-50%) translateY(0)';
    setTimeout(() => { t.style.opacity = '0'; t.style.transform = 'translateX(-50%) translateY(20px)'; }, 2500);
  }
};

function rpRefresh() { RP.render(); }

// Init Release Planner when DOM ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => RP.init());
} else {
  RP.init();
}
